<interface_config>
  <root id="interface"
        x="0"
        y="0"
        w="800"
        h="600"
        active="true" />
  <lua file="inventory.lua" />
  <!-- ************* -->
  <!-- * INVENTORY * -->
  <!-- ************* -->
  <!-- ******** -->
  <!-- * Data * -->
  <!-- ******** -->
  <variable entry="UI:TEMP_INV:ALL_EMPTY"
            type="sint32"
            value="1" />
  <variable entry="UI:PHRASE:SELECT_MEMORY"
            type="sint32"
            value="0" />
  <!-- ************** -->
  <!-- * Management * -->
  <!-- ************** -->
  <!-- left click on a slot of the armor or jewelry or hands -->
  <proc id="inv_left_click_on_slot">
    <action handler="enter_modal"
            params="group=ui:interface:bag_choose" />
  </proc>
  <!-- left click on a slot of the hotbar -->
  <proc id="hotbar_left_click_on_slot">
    <action handler="enter_modal"
            params="group=ui:interface:hotbar_choose" />
  </proc>
  <proc id="select_special_items">
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:iil:active|value=0" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:webitems:active|value=1" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:money:active|value=0" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:elyps:active|value=1" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:artefact_content:active|value=0" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:artefact_bottom:active|value=0" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:artefact_tab:active|value=0" />
      <action handler="lua" params="artefact:restorePact()" />
      <action handler="browse_home" params="name=ui:interface:inventory:content:bag:webitems:html" />
  </proc>
  <proc id="select_bag_items">
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:iil:active|value=1" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:money:active|value=1" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:elyps:active|value=0" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:webitems:active|value=0" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:artefact_content:active|value=0" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:artefact_bottom:active|value=0" />
      <action handler="set" params="target_property=ui:interface:inventory:content:bag:artefact_tab:active|value=0" />
      <action handler="lua" params="artefact:restorePact()" />
  </proc>
  <!-- ************* -->
  <!-- * EQUIPMENT * -->
  <!-- ************* -->
  <style style="armor_jewelry_item"
         type="sheet"
         menu_r="%self_item_modal_menu"
         selection_group="inventory_selection"
         dragable="true"
         ondrag="inv_drag"
         params_drag="from_slot"
         oncandrop="inv_can_drop"
         oncannotdrop="inv_cannot_drop"
         ondrop="inv_drop"
         col_noitem="true"
         onclick_l="proc"
         params_l="inv_left_click_on_slot"
         auto_grayed="false" />

  <!-- ************* -->
  <!-- * HOTBAR * -->
  <!-- ************* -->
  <style style="hotbar_item"
         type="sheet"
         menu_r="%hotbar_item_modal_menu"
         selection_group="inventory_selection"
         dragable="true"
         ondrag="inv_drag"
         params_drag="from_slot"
         oncandrop="can_drop_to_hotbar"
         oncannotdrop="inv_cannot_drop"
         ondrop="inv_drop"
         col_noitem="true"
         onclick_l="proc"
         params_l="hotbar_left_click_on_slot"
         auto_grayed="false" />

  <template name="img_button"
            id="image_button"
            ok_text="uittOK"
            tx_over="blank.tga"
            cancel_text="uittCancel"
            posparent="parent"
            posref="BM TM"
            onclick_ok=""
            onclick_ok_param=""
            x="0"
            y="0"
            keep="true"
            tooltip_ok=""
            avoid_resize_parent="false">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           child_resize_w="true"
           child_resize_h="true"
           x="#x"
           y="#y"
           avoid_resize_parent="#avoid_resize_parent">
      <ctrl style="button_ok"
            id="bb"
            x="0"
            y="0"
            posref="TL TL"
            text_y="-2"
            onclick_l="#onclick_ok"
            params_l="#onclick_ok_param"
            hardtext="#ok_text"
            tooltip="#tooltip_ok" />
      <ctrl type="button"
            id="button"
            button_type="push_button"
            posref="TL TL"
            x="0"
            y="0"
            scale="false"
            tx_over="#tx_over"
            color="255 255 255 255"
            col_pushed="255 255 255 255"
            col_over="255 255 255 0"
            onclick_l="#onclick_ok"
            params_l="#onclick_ok_param" />
    </group>
  </template>

  <template name="image_button"
      tx_over="blank.tga"
      onclick_l=""
      params_l=""  >
    <group id="#id"
           posref="TL TL"
           x="0"
           y="0"
           sizeref="wh"
           w="0"
           h="0">
      <ctrl type="button"
            id=""
            button_type="push_button"
            posref=""
            posparent=""
            x=""
            y=""
            scale="false"
            tx_over="#tx_over"
            color="255 255 255 255"
            col_pushed="255 255 255 255"
            col_over="255 255 255 0"
            onclick_l="#onclick_l"
            params_l="#params_l" />
    </group>
  </template>

  <template name="itemgroups_item"
            keep="true"
            posparent="parent"
            posref="TL TL"
            h="24"
            id="">
    <group id="#id"
           sizeref="w"
           h="#h"
           max_height="#h"
           posparent="#posparent"
           posref="#posref">
        <view type="bitmap" id="sep1" posref="TL TL" scale="true" sizeref="w" h="2" w="0" texture="W_line_hor.tga" y="1" />
        <view type="bitmap" id="sep2" posref="BL BL" scale="true" sizeref="w" h="2" w="0" texture="W_line_hor.tga" y="-1"/>
        <view type="text"
            id="name"
            x="4"
            y="-5"
            line_maxw="70"
            over_extend_view_text="true"
            posref="TL TL"
            shadow_x="0" 
            shadow_y="0"
            fontsize="10" />
        <ctrl type="button"
              id="delete_button"
              button_type="push_button"
              posref="MR MR"
              x="-4"
              h="16"
              w="16"
              scale="true"
              tx_normal="r2_toolbar_delete.tga"
              tx_pushed="r2_toolbar_delete_pushed.tga"
              tx_over="r2_toolbar_delete_over.tga"
              global_color_normal="false"
              global_color_over="false"
              global_color_pushed="false"
              onclick_l="enter_modal" 
              params_l="group=ui:interface:remove_itemgroup_confirm"
              tooltip="uiRemove" />
        <ctrl type="button"
              id="equip_button"
              button_type="push_button"
              posref="ML MR"
              posparent="delete_button"
              x="-6"
              h="16"
              w="16"
              scale="true"
              tx_normal="ar_helmet.tga"
              tx_pushed="ar_helmet.tga"
              tx_over="W_button_14_over.tga"
              global_color_normal="false"
              global_color_over="false"
              global_color_pushed="false"
              onclick_l="item_group_equip"
              params_l="name=#name"
              tooltip="uimEquip" />
    </group>
  </template>

  <!-- modal box to confirm removal of group -->
  <group type="modal" id="remove_itemgroup_confirm" exit_click_out="true" posref="TL TL" x="-8" y="8" w="100" h="60" options="skin_modal">
      <view type="bitmap" id="b" posref="TL TL" x="4" y="-4" global_color="false" texture="w_warning_2.tga" />
      <view type="text" id="t" posref="TL TL" x="20" y="-5" color="233 197 42 255" fontsize="12" shadow="true" global_color="false" hardtext="uiRemove" />
      <instance template="button_ok_cancel" posref="BR BR" x="-4" y="4" onclick_ok="item_group_delete" onclick_ok_param="" onclick_cancel="leave_modal" onclick_cancel_param="" />
  </group>

  <!-- clear group name input on loss of focus -->
  <proc id="lose_focus_group_create">
      <action handler="set" params="target='ui:interface:inventory:content:equip:midsection:content:itemgroups:itemgroup_create:edit_name:eb:input_string'|value=''" />
      <action handler="set" params="target='ui:interface:inv_equip:content:equip:midsection:content:itemgroups:itemgroup_create:edit_name:eb:input_string'|value=''" />
  </proc>

  <!-- init preview -->
  <proc id="init_3d_preview">
      <!-- give preview idle animation -->
      <action handler="set" params="target_property=ui:interface:inventory:content:equip:midsection:content:visu3d:char3d:char:anim|value=0" />
      <action handler="set" params="target_property=ui:interface:inv_equip:content:equip:midsection:content:visu3d:char3d:char:anim|value=0" />

      <!-- make loading text inactive -->
      <action handler="set" params="target_property=ui:interface:inventory:content:equip:midsection:content:visu3d:loading_text:active|value=0" />
      <action handler="set" params="target_property=ui:interface:inv_equip:content:equip:midsection:content:visu3d:loading_text:active|value=0" />

      <!-- init 3d preview -->
      <action handler="lua" params="game:initEquipPreview()" />

      <!-- give preview race specific background -->
  	<action handler="set" cond="eq(@UI:TEMP:PREVIEWCHAR3D:PEOPLE,0)" params="target_property=ui:interface:inventory:content:equip:midsection:content:visu3d:char3d:env:name|value='outgame_fyros.ig'" />
	<action handler="set" cond="eq(@UI:TEMP:PREVIEWCHAR3D:PEOPLE,1)" params="target_property=ui:interface:inventory:content:equip:midsection:content:visu3d:char3d:env:name|value='outgame_matis.ig'" />
	<action handler="set" cond="eq(@UI:TEMP:PREVIEWCHAR3D:PEOPLE,2)" params="target_property=ui:interface:inventory:content:equip:midsection:content:visu3d:char3d:env:name|value='outgame_tryker.ig'" />
	<action handler="set" cond="eq(@UI:TEMP:PREVIEWCHAR3D:PEOPLE,3)" params="target_property=ui:interface:inventory:content:equip:midsection:content:visu3d:char3d:env:name|value='outgame_zorai.ig'" />
  
      <action handler="set" cond="eq(@UI:TEMP:PREVIEWCHAR3D:PEOPLE,0)" params="target_property=ui:interface:inv_equip:content:equip:midsection:content:visu3d:char3d:env:name|value='outgame_fyros.ig'" />
	<action handler="set" cond="eq(@UI:TEMP:PREVIEWCHAR3D:PEOPLE,1)" params="target_property=ui:interface:inv_equip:content:equip:midsection:content:visu3d:char3d:env:name|value='outgame_matis.ig'" />
	<action handler="set" cond="eq(@UI:TEMP:PREVIEWCHAR3D:PEOPLE,2)" params="target_property=ui:interface:inv_equip:content:equip:midsection:content:visu3d:char3d:env:name|value='outgame_tryker.ig'" />
	<action handler="set" cond="eq(@UI:TEMP:PREVIEWCHAR3D:PEOPLE,3)" params="target_property=ui:interface:inv_equip:content:equip:midsection:content:visu3d:char3d:env:name|value='outgame_zorai.ig'" />
      
      <!-- make preview active -->
      <action handler="set" params="target_property=ui:interface:inventory:content:equip:midsection:content:visu3d:char3d:active|value=1" />
      <action handler="set" params="target_property=ui:interface:inv_equip:content:equip:midsection:content:visu3d:char3d:active|value=1" />
  </proc>

  <template name="tinv_equip">
      <group id="equip"
           posref="MM MM"
           sizeref="w"
           child_resize_h="true"
           child_resize_hmargin="20"
           x="0"
           y="-10">
      <!-- Midsection -->
      <group id="midsection"
             posref="TM TM"
             w="140"
             h="200"
             x="22"
             y="0">
            <group id="tab_group" posref="TL TL" x="0" y="0" sizeref="w" h="24" >
			<group type="tab" id="view_select" posref="TL TL" x="0" y="0" child_resize_w="true" h="24" >
				<ctrl style="tab_button_new" id="tab0" x="0" posref="TL TL"	group="content:equip:midsection:content:visu3d"	hardtext="ui3DView"/>
				<ctrl style="tab_button_new" id="tab1" posparent="tab0" group="content:equip:midsection:content:itemgroups" hardtext="uimGroup" />
			</group>
			<view type="bitmap" id="septab" posparent="view_select" posref="BR BL" sizeparent="parent" sizeref="w" w="0" h="1" scale="true" texture="blank.tga" color="166 166 166 255" />
		</group>
            <group id="content" posref="BL TL" posparent="tab_group" w="140" h="173">      
                  <group id="black" posref="TL TL" sizeref="h" h="0" inherit_gc_alpha="true"/>
                  <instance template="inner_thin_border" posparent="black" inherit_gc_alpha="true"/>
                  <!-- 3d preview -->
                  <group id="visu3d" sizeref="wh" posref="TL TL" w="-3" h="-3" x="3" y="-3">
                        <scene3d id="char3d" x="0" y="0" active="false" sizeref="wh" posref="TL TL" curcam="cam" render_layer="0"
                              user_interaction="true" rotz_factor="0.017"
                              roty_factor="0" roty_limit_min="0" roty_limit_max="0"
                              dist_factor="0.005" dist_limit_min="2" dist_limit_max="3"
                              ambient="20 20 20" sun_ambient="20 20 20" sun_diffuse="80 64 32" sun_specular="0 0 0" sun_direction="0 0 0" >

                              <character3d id="char" dblink="player" pos="0.0 26.5 1" rot="0.0 0.0 0.0" />

                              <camera id="cam" fov="30" pos="0.0 24.0 1.9" target="0.0 26.5 1.9" roll="0" />

                              <light id="back" pos="0.0 28.5 2.4" color="255 128 0" near="2.5" far="4.0" />
                              <light id="lgt_m" pos="1.36 25.3 2.48" color="255 255 255" near="2.0" far="2.5" />
                              <light id="lgt_f" pos="-1.36 25.3 2.48" color="255 255 255" near="2.0" far="2.5" />

                              <shape id="shadow" name="shadow.shape" pos="0 26.5 1" rot="0.0 0.0 0.0" />
                              <ig id="env" name="" pos="0 0 0" />
                        </scene3d>
                        <view type="text" id="loading_text" posref="MM MM" x="0" y="0" color="255 255 255 155" fontsize="10" shadow="true" global_color="false" hardtext="uiLoading" justification="centered" />
                  </group>
                  <!-- Itemgroups -->
                  <group id="itemgroups" posref="TL TL" sizeref="h" w="140">
                        <group id="list_container" posref="TM TM" child_resize_w="true" h="133" x="0" y="-7">
                              <group id="black" posref="TR TR" w="124" inherit_gc_alpha="true"/>
                              <instance template="inner_thin_border" posparent="black" inherit_gc_alpha="true"/>
                              <group type="list"
                                    id="itemgroups_list"
                                    posref="TR TR"
                                    over="true"
                                    sizeref="h"
                                    w="119" h="-6" x="-2" y="-3">
                              </group>
                              <view type="text" id="empty_text" active="false" posref="MM MM" posparent="black" x="0" y="0" color="255 255 255 155" fontsize="9" shadow="true" global_color="false" multi_line="true" line_maxw="105" hardtext="uiEmptyItemgroups" justification="centered" />
                              <ctrl style="skin_scroll" id="scroll_bar" posref="TL TR" posparent="itemgroups_list" x="-4" target="itemgroups_list" target_stepy="4"/>
                        </group>
                        <group id="itemgroup_create" posref="BM TM" posparent="list_container" y="-4" child_resize_w="true">
                              <instance template="edit_box_widget" id="edit_name" posref="TL TL" x="0" y="0" child_resize_h="true" w="104" fontsize="10" prompt="" max_num_chars="255" clear_on_escape="true"
                                    reset_focus_on_hide="true" onenter="item_group_create" enter_loose_focus="false" on_focus_lost="proc" on_focus_lost_params="lose_focus_group_create" entry_type="text" tooltip="uittItemgroupNameInput" />
                              <ctrl type="button" id="create_button" button_type="push_button" posref="MR ML" posparent="edit_name" x="2" h="18" w="18" scale="true" tx_normal="r2ed_icon_newactivity.tga" tx_pushed="r2ed_icon_newactivity.tga" tx_over="W_button_14_over.tga"
                                    global_color_normal="false" global_color_over="true" global_color_pushed="true" onclick_l="item_group_create" tooltip="uimFaCrea" />
                        </group>
                  </group>
            </group>
      </group>
      <!-- Armor -->
      <group id="armors"
             posref="TR TL"
             posparent="midsection"
             child_resize_w="true"
             h="192"
             x="20"
             y="-5">
        <view type="text"
            id="armTitle"
            posref="TL TL"
            hardtext="uiArmorTitle"
            fontsize="10"
            shadow="true" />
        <ctrl style="armor_jewelry_item"
              id="head"
              posref="BL TL"
              posparent="armTitle"
              x="0"
              y="-2"
              tx_noitem="W_AR_helmet.tga"
              item_slot="HEAD"
              value="%head"
              tooltip="uittHelmet" />
        <ctrl style="armor_jewelry_item"
              id="chest"
              posref="BL TL"
              posparent="head"
              x="0"
              y="-2"
              tx_noitem="W_AR_gilet.tga"
              item_slot="CHEST"
              value="%chest"
              tooltip="uittChest" />
        <ctrl style="armor_jewelry_item"
              id="legs"
              posref="BL TL"
              posparent="chest"
              x="0"
              y="-2"
              tx_noitem="W_AR_pantabotte.tga"
              item_slot="LEGS"
              value="%legs"
              tooltip="uittLegs" />
        <ctrl style="armor_jewelry_item"
              id="feet"
              posref="BL TL"
              posparent="legs"
              x="0"
              y="-2"
              tx_noitem="W_AR_botte.tga"
              item_slot="FEET"
              value="%feet"
              tooltip="uittFeet" />
        <ctrl style="armor_jewelry_item"
              id="arms"
              posref="TR TL"
              posparent="chest"
              x="2"
              y="11"
              tx_noitem="W_AR_armpad.tga"
              item_slot="ARMS"
              value="%arms"
              tooltip="uittArms" />
        <ctrl style="armor_jewelry_item"
              id="hands"
              posref="BL TL"
              posparent="arms"
              x="0"
              y="-2"
              tx_noitem="W_AR_hand.tga"
              item_slot="HANDS"
              value="%hands"
              tooltip="uittHands" />
      </group>
      <!-- Jewelry -->
      <group id="jewelry"
             posref="TL TR"
             posparent="midsection"
             child_resize_w="true"
             h="192"
             x="-20"
             y="-5">
        <view type="text"
            id="jewTitle"
            posref="TR TR"
            hardtext="uiJewelryTitle"
            fontsize="10"
            shadow="true" />
        <ctrl style="armor_jewelry_item"
              id="earing_r"
              posref="BR TR"
              posparent="jewTitle"
              y="-2"
              tx_noitem="W_PA_earring.tga"
              item_slot="EARS"
              value="%earr"
              tooltip="uittEarr" />
        <ctrl style="armor_jewelry_item"
              id="bracelet_r"
              posparent="earing_r"
              posref="BL TL"
              y="-2"
              tx_noitem="W_PA_bracelet.tga"
              item_slot="WRIST"
              value="%wristr"
              tooltip="uittWristr" />
        <ctrl style="armor_jewelry_item"
              id="ring_r"
              posparent="bracelet_r"
              posref="BL TL"
              y="-2"
              tx_noitem="W_PA_ring.tga"
              item_slot="FINGERS"
              value="%fingerr"
              tooltip="uittFingerr" />
        <ctrl style="armor_jewelry_item"
              id="anklet_r"
              posparent="ring_r"
              posref="BL TL"
              y="-2"
              tx_noitem="W_PA_anklet.tga"
              item_slot="ANKLE"
              value="%ankler"
              tooltip="uittAnkler" />
        <ctrl style="armor_jewelry_item"
              id="earing_l"
              posref="TL TR"
              posparent="earing_r"
              x="-2"
              y="0"
              tx_noitem="W_PA_earring.tga"
              item_slot="EARS"
              value="%earl"
              tooltip="uittEarl" />
        <ctrl style="armor_jewelry_item"
              id="bracelet_l"
              posparent="earing_l"
              posref="BL TL"
              y="-2"
              tx_noitem="W_PA_bracelet.tga"
              item_slot="WRIST"
              value="%wristl"
              tooltip="uittWristl" />
        <ctrl style="armor_jewelry_item"
              id="ring_l"
              posparent="bracelet_l"
              posref="BL TL"
              y="-2"
              tx_noitem="W_PA_ring.tga"
              item_slot="FINGERS"
              value="%fingerl"
              tooltip="uittFingerl" />
        <ctrl style="armor_jewelry_item"
              id="anklet_l"
              posparent="ring_l"
              posref="BL TL"
              y="-2"
              tx_noitem="W_PA_anklet.tga"
              item_slot="ANKLE"
              value="%anklel"
              tooltip="uittAnklel" />
        <ctrl style="armor_jewelry_item"
              id="headdress"
              posparent="bracelet_l"
              posref="TL TR"
              x="-2"
              y="11"
              tx_noitem="W_PA_diadem.tga"
              item_slot="HEADDRESS"
              value="%headdress"
              tooltip="uittHeaddress" />
        <ctrl style="armor_jewelry_item"
              id="neck"
              posparent="headdress"
              posref="BL TL"
              x="0"
              y="-2"
              tx_noitem="W_PA_pendant.tga"
              item_slot="NECKLACE"
              value="%necklace"
              tooltip="uittNeck" />
      </group>
      <group id="hotbar_c"
           posref="TM TM"
           x="0"
           y="-230"
           child_resize_w="true"
           child_resize_h="true">
            <instance template="tinv_hotbar"/>
      </group>
      <view type="text"
            id="hotbarTitle"
            posref="TL BL"
            posparent="hotbar_c"
            hardtext="uiHotbarTitle"
            fontsize="10"
            y="2"
            shadow="true" />
      <ctrl type="sheet"
            id="handl"
            x="-12"
            y="0"
            w="86"
            h="44"
            posref="TL TR"
            posparent="hotbar_c"
            tx_noitem="hand_left.tga"
            selection_group="inventory_selection"
            onclick_l="proc"
            params_l="inv_left_click_on_slot"
            tooltip="uittHandL"
            menu_r="%self_item_modal_menu"
            dragable="true"
            ondrag="inv_drag"
            params_drag="from_slot"
            oncannotdrop="inv_cannot_drop"
            oncandrop="inv_can_drop"
            ondrop="inv_drop"
            item_slot="LEFT_HAND"
            value="%hand_l"
            other_hand_slot="handr"
            auto_grayed="false" />
      <ctrl type="sheet"
            id="handr"
            x="12"
            y="0"
            w="86"
            h="44"
            posref="TR TL"
            posparent="hotbar_c"
            tx_noitem="hand_right.tga"
            selection_group="inventory_selection"
            onclick_l="proc"
            params_l="inv_left_click_on_slot"
            tooltip="uittHandR"
            menu_r="%self_item_modal_menu"
            dragable="true"
            ondrag="inv_drag"
            params_drag="from_slot"
            oncannotdrop="inv_cannot_drop"
            oncandrop="inv_can_drop"
            ondrop="inv_drop"
            item_slot="RIGHT_HAND"
            value="%hand_r"
            other_hand_slot="handl"
            auto_grayed="false" />
        <!-- Must update some things when the item equipped change -->
        <link expr="depends(@%bag:[%hand_r:INDEX_IN_BAG-1]:SHEET)"
            action="phrase_update_from_hand" />
        <link expr="depends(@%bag:[%hand_r:INDEX_IN_BAG-1]:QUALITY)"
            action="phrase_update_from_hand" />
        <link expr="depends(@%bag:[%hand_r:INDEX_IN_BAG-1]:ENCHANT)"
            action="phrase_update_from_hand" />
    </group>
  </template>

  <template name="tinv_hotbar" x="0" y="0">
      <group id="hotbar"
            posref="MM MM"
            child_resize_w="true"
            child_resize_h="true"
            x="#x"
            y="#y">
      <ctrl style="hotbar_item"
            id="hotbar1"
            posref="TL TL"
            x="0"
            y="0"
            tx_noitem="W_hotbar1.tga"
            value="%hotbar:0"
            tooltip="uittHotbarItem1" />
      <ctrl style="hotbar_item"
            id="hotbar2"
            posref="TR TL"
            posparent="hotbar1"
            x="2"
            y="0"
            tx_noitem="W_hotbar2.tga"
            value="%hotbar:1"
            tooltip="uittHotbarItem2" />
      <ctrl style="hotbar_item"
            id="hotbar3"
            posref="TR TL"
            posparent="hotbar2"
            x="2"
            y="0"
            tx_noitem="W_hotbar3.tga"
            value="%hotbar:2"
            tooltip="uittHotbarItem3" />
      <ctrl style="hotbar_item"
            id="hotbar4"
            posref="TR TL"
            posparent="hotbar3"
            x="2"
            y="0"
            tx_noitem="W_hotbar4.tga"
            value="%hotbar:3"
            tooltip="uittHotbarItem4" />
      <ctrl style="hotbar_item"
            id="hotbar5"
            posref="TR TL"
            posparent="hotbar4"
            x="2"
            y="0"
            tx_noitem="W_hotbar5.tga"
            value="%hotbar:4"
            tooltip="uittHotbarItem5" />
      </group>
  </template>
  <!-- **************************** -->
  <!-- * ALL SEPARATED CONTAINERS * -->
  <!-- **************************** -->
  <proc id="inv_equip_active">
    <action handler="set" params="dblink=UI:VARIABLES:ISACTIVE:INV_EQUIP|value=1" />
    <action handler="lua" params="game:updateEquipOnResize('inv_equip', true)" />
  </proc>
  <!-- Equipment -->
  <group type="container"
         id="inv_equip"
         w="380"
         h="265"
         title="uiInvEquipTitle"
         locked="true"
         resizer="true"
         pop_min_w="290"
         pop_min_h="265"
         pop_max_w="800"
         pop_max_h="600"
         movable="true"
         active="false"
         opened="true"
         openable="false"
         global_color="false"
         header_color="UI:SAVE:WIN:COLORS:INV"
         on_active="proc"
         on_active_params="inv_equip_active"
         on_deactive="set"
         on_deactive_params="dblink=UI:VARIABLES:ISACTIVE:INV_EQUIP|value=0"
         on_resize="lua"
         on_resize_params="game:updateEquipOnResize('inv_equip', false)"
         title_class="text">
    <group id="header_opened"
           x="0"
           y="0"
           w="0"
           h="12"
           posref="TL TL"
           group_onclick_r="active_menu"
           group_params_r="menu=ui:interface:base_menu_with_color">
           </group>
    <group id="content"
           posref="TL TL"
           x="0"
           y="0"
           w="0"
           h="0">
      <ctrl type="button" id="expand_button" button_type="push_button" posref="TR TR" x="-5" y="-8" scale="true" w="16" h="16"
            color="255 255 255 200" col_over="255 255 255 255" col_pushed="255 255 255 255"
            global_color_normal="false" global_color_pushed="false" global_color_over="false"
            onclick_l="proc" params_l="expand_equip2" tx_over="w_button_12_over.tga" tx_normal="Switch_Ratio.tga" tx_pushed="Switch_Ratio.tga"
            over_when_pushed="false" tooltip="uiExpandWindow" />
      <instance template="tinv_equip" />
    </group>
  </group>
  <tree node="inv_equip" />
  
  <!-- hotbar -->
  <define id="hotbar_h" value="1" />
  <define id="hotbar_v" value="2" />

  <variable entry="UI:SAVE:HOTBAR_MODE" type="sint32" value="0" />

  <proc id="hotbar_proc_active">
    <action handler="set" params="dblink=UI:VARIABLES:ISACTIVE:INV_HOTBAR|value=1"/>
    <action handler="proc" params="hotbar_proc_mode" />
  </proc>

  <proc id="hotbar_proc_set">
    <action handler="set" params="dblink=UI:SAVE:HOTBAR_MODE|value=@0"/>
    <action handler="proc" params="hotbar_proc_mode" />
  </proc>

  <proc id="hotbar_proc_mode">
    <action handler="proc" cond="ne(@UI:SAVE:HOTBAR_MODE,%hotbar_v)" params="hotbar_proc_horiz"/>
    <action handler="proc" cond="eq(@UI:SAVE:HOTBAR_MODE,%hotbar_v)" params="hotbar_proc_vert"/>
  </proc>

  <proc id="hotbar_proc_vert">
    <action handler="set" params="target='ui:interface:hotbar_menu:horiz:active'|value=1"/>
    <action handler="set" params="target='ui:interface:hotbar_menu:vert:active'|value=0"/>

    <action handler="set" params="target='ui:interface:inv_hotbar:w'|value=70"/>
    <action handler="set" params="target='ui:interface:inv_hotbar:h'|value=246"/>

    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar1:x|value='0'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar2:x|value='-42'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar2:y|value='-48'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar3:x|value='-42'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar3:y|value='-48'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar4:x|value='-42'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar4:y|value='-48'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar5:x|value='-42'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar5:y|value='-48'"/>
  </proc>

  <proc id="hotbar_proc_horiz">
    <action handler="set" params="target='ui:interface:hotbar_menu:horiz:active'|value=0"/>
    <action handler="set" params="target='ui:interface:hotbar_menu:vert:active'|value=1"/>

    <action handler="set" params="target='ui:interface:inv_hotbar:w'|value=246"/>
    <action handler="set" params="target='ui:interface:inv_hotbar:h'|value=150"/>

    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar1:x|value='0'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar2:x|value='2'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar2:y|value='0'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar3:x|value='2'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar3:y|value='0'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar4:x|value='2'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar4:y|value='0'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar5:x|value='2'"/>
    <action handler="set" params="target_property=ui:interface:inv_hotbar:content:hotbar:hotbar5:y|value='0'"/>
  </proc>
  
  <group type="menu" id="hotbar_menu" extends="base_menu_with_color">
    <action id="horiz" name="uiHorizontal" handler="proc" params="hotbar_proc_set|%hotbar_h"/>
    <action id="vert" name="uiVertical" handler="proc" params="hotbar_proc_set|%hotbar_v"/>
    <separator />
  </group>

  <!-- Hotbar -->
  <group type="container"
         id="inv_hotbar"
         w="246"
         h="150"
         resizer="false"
         openable="false"
         opened="true"
         group_onclick_r="active_menu"
         group_params_r="menu=ui:interface:hotbar_menu"
         movable="true"
         active="false"
         global_color="false"
         header_color="UI:SAVE:WIN:COLORS:INV"
         on_active="proc"
         on_active_params="hotbar_proc_active"
         on_deactive="set"
         on_deactive_params="dblink=UI:VARIABLES:ISACTIVE:INV_HOTBAR|value=0">
      <group id="content"
           posref="TL TL"
           child_resize_h="true"
           child_resize_hmargin="10">
            <instance template="tinv_hotbar" posref="TR TL" y="-1"/>
      </group>
    <link expr="depends(@UI:SAVE:HOTBAR_MODE)" action="proc" params="gestionsets_proc_mode" />
  </group>
  <tree node="inv_hotbar" />
  <!-- Inventory Player Bag -->
  <group style="inv_container"
         id="inv_bag"
         title="uiInventoryTitle"
         header_color="UI:SAVE:WIN:COLORS:INV"
         on_active="set"
         on_active_params="dblink=UI:VARIABLES:ISACTIVE:INV_BAG|value=1"
         on_deactive="set"
         on_deactive_params="dblink=UI:VARIABLES:ISACTIVE:INV_BAG|value=0"
         title_class="formated">
    <group id="header_closed"
           x="0"
           y="0"
           h="12"
           posref="TL TL"></group>
    <group id="header_opened"
           x="0"
           y="0"
           h="16"
           posref="TL TL"
           group_onclick_r="active_menu"
           group_params_r="menu=ui:interface:base_menu_with_color">
      <instance template="tinv_nbslots_bulk_weight"
                id="ibw"
                x="-16"
                y="2"
                inv_branch="%bag"
                inv_bulk_max="%bag_bulk_max" />
    </group>
    <group id="content"
           h="394"
           posref="TR TR">
      <instance template="tinv_item_list"
                id="iil"
                inv_branch_nb="%max_bag_invslot"
                y="-8"
                sizeref="wh"
                h="-8"
                inv_branch="%bag"
                inv_type="INV_BAG" />
      <!-- Money -->
      <view type="text"
            id="moneyTitle"
            posref="BL BL"
            x="12"
            y="2"
            hardtext="uiMoneyTitle"
            fontsize="10"
            shadow="true" />
      <instance template="argent"
                id="money"
                posparent="moneyTitle"
                posref="TR TL"
                x="4"
                y="4"
                value="%money" />
    </group>
  </group>
  <tree node="inv_bag" />
  <!-- Inventory Player Room -->
  <group style="inv_container"
         id="inv_room"
         title="uiInvRoomTitle"
         header_color="UI:SAVE:WIN:COLORS:TRADE"
         on_active="set"
         on_active_params="dblink=UI:VARIABLES:ISACTIVE:INV_ROOM|value=1"
         on_deactive="set"
         on_deactive_params="dblink=UI:VARIABLES:ISACTIVE:INV_ROOM|value=0">

    <group id="header_closed"
           x="0"
           y="0"
           h="12"
           posref="TL TL"></group>
    <group id="header_opened"
           x="0"
           y="0"
           h="16"
           posref="TL TL"
           group_onclick_r="active_menu"
           group_params_r="menu=ui:interface:base_menu_with_color">
      <instance template="tinv_nbslots_bulk_weight"
                id="ibw"
                x="-16"
                inv_branch="%room_inv_dbentry"
                inv_bulk_max="%room_inv_bulk_max" />
    </group>
    <group id="content"
           h="214"
           posref="TR TR">
      <instance template="tinv_item_list"
                id="iil"
                inv_branch_nb="%max_room_invslot"
                y="-8"
                sizeref="wh"
                h="-8"
                inv_branch="%room_inv_dbentry"
                inv_type="INV_ROOM" />
    </group>
  </group>
  <tree node="inv_room" />
  <!-- ********************* -->
  <!-- * GROUPED INVENTORY * -->
  <!-- ********************* -->
  <template name="tinv_animal"
            id=""
            bag_entry=""
            info_entry=""
            icon_db="">
    <group id="#id"
           posref="TL TL"
           x="0"
           y="0"
           sizeref="wh"
           w="0"
           h="0">
      <instance template="tinv_nbslots_bulk_weight"
                id="ibw"
                x="0"
                inv_branch_nb="%max_animal_invslot"
                inv_branch="#bag_entry"
                inv_bulk_max="#info_entry:BULK_MAX" />
      <instance template="tinv_item_list"
                id="iil"
                y="-16"
                sizeref="wh"
                h="-16"
                inv_branch_nb="%max_animal_invslot"
                inv_branch="#bag_entry"
                inv_type="#icon_db"
                animal_status="#info_entry:STATUS" />
      <view type="text"
            id="disable_txt"
            posref="BL BL"
            x="2"
            y="2"
            color="255 255 255 255"
            shadow="true"
            fontsize="10" />
      <link expr="getAnimalInventoryStateText(@#info_entry:STATUS)"
            target="disable_txt:hardtext" />
    </group>
  </template>
  <!-- FAKE SOLUTION -->
  <proc id="inventory_focus">
    <action handler="set" params="target='ui:interface:inventory:pop_min_w'|value=380" />
    <action handler="set" params="target='ui:interface:inventory:content:expand_button:active'|value=0" />
  </proc>
  <proc id="equip_focus">
    <action handler="set" params="target='ui:interface:inventory:pop_min_w'|value=290" />
    <action handler="set" params="target='ui:interface:inventory:content:expand_button:active'|value=1" />
    <action handler="lua" params="game:updateEquipOnResize('inventory', true)" />
  </proc>
  <proc id="inventory_active">
    <action handler="set" params="dblink=UI:VARIABLES:ISACTIVE:INVENTORY|value=1" />
    <action handler="set" params="dblink=UI:VARIABLES:ISACTIVE:INV_EQUIP_3D|value=1" />
  </proc>
  <proc id="inventory_deactive">
    <action handler="set" params="dblink=UI:VARIABLES:ISACTIVE:INVENTORY|value=0" />
    <action handler="set" params="dblink=UI:VARIABLES:ISACTIVE:INV_EQUIP_3D|value=0" />
  </proc>
  <proc id="expand_equip">
      <action handler="set" params="target='ui:interface:inventory:w'|value=451" />
      <action handler="set" params="target='ui:interface:inventory:h'|value=346" />
      <action handler="lua" params="game:updateEquipOnResize('inventory', false)" />
  </proc>
  <proc id="expand_equip2">
      <action handler="set" params="target='ui:interface:inv_equip:w'|value=451" />
      <action handler="set" params="target='ui:interface:inv_equip:h'|value=346" />
      <action handler="lua" params="game:updateEquipOnResize('inv_equip', false)" />
  </proc>
  <group type="container"
         id="inventory"
         header_active="false"
         resizer="true"
         pop_min_w="380"
         pop_min_h="265"
         pop_max_w="920"
         pop_max_h="1600"
         w="380"
         h="265"
         movable="true"
         active="false"
         opened="true"
         openable="false"
         global_color="false"
         global_color_over="true"
         on_active="proc"
         on_active_params="inventory_active"
         on_deactive="proc"
         on_deactive_params="inventory_deactive"
         on_resize="lua"
         on_resize_params="game:updateEquipOnResize('inventory', false)"
         resizer_top_size="5">
    <group id="header_opened"
           x="0"
           y="0"
           w="100"
           h="28"
           posref="TL TL"
           group_onclick_r="active_menu"
           group_params_r="menu=ui:interface:base_menu_with_color">

      <group type="tab"
             id="inv_select"
             child_resize_w="true"
             h="24"
             posref="TL TL"
             x="0"
             y="-4">
        <ctrl style="tab_button_new"
              id="tab0"
              x="0"
              posref="TL TL"
              group="content:bag"
              hardtext="uitabInvBag"
              tooltip="uiTabInfo"
              onclick_r=""
              params_r=""
              onclick_l="proc"
              params_l="inventory_focus" />
        <ctrl style="tab_button_new"
              id="tab1"
              posparent="tab0"
              group="content:equip"
              hardtext="uitabInvEquip"
              tooltip="uiTabInfo"
              onclick_r="show"
              params_r="inv_equip"
              onclick_l="proc"
              params_l="equip_focus" />
        <!-- MAX_INVENTORY_ANIMAL -->
        <ctrl style="tab_button_new"
              id="tab2"
              posparent="tab1"
              group="content:pa0"
              hardtext="uitabInvPAMount0"
              tooltip="uiTabInfo"
              onclick_r="show"
              params_r="inv_pa0"
              onclick_l="proc"
              params_l="inventory_focus" />
        <ctrl style="tab_button_new"
              id="tab3"
              posparent="tab2"
              group="content:pa1"
              hardtext="uitabInvPAMount1"
              tooltip="uiTabInfo"
              onclick_r="show"
              params_r="inv_pa1"
              onclick_l="proc"
              params_l="inventory_focus" />
        <ctrl style="tab_button_new"
              id="tab4"
              posparent="tab3"
              group="content:pa2"
              hardtext="uitabInvPAMount2"
              tooltip="uiTabInfo"
              onclick_r="show"
              params_r="inv_pa2"
              onclick_l="proc"
              params_l="inventory_focus" />
        <ctrl style="tab_button_new"
              id="tab5"
              posparent="tab4"
              group="content:pa3"
              hardtext="uitabInvPAMount3"
              tooltip="uiTabInfo"
              onclick_r="show"
              params_r="inv_pa3"
              onclick_l="proc"
              params_l="inventory_focus" />
        <ctrl style="tab_button_new"
              id="tab6"
              posparent="tab5"
              group="content:pa4"
              hardtext="uitabInvPAZig1"
              tooltip="uiTabInfo"
              onclick_r="show"
              params_r="inv_pa4"
              onclick_l="proc"
              params_l="inventory_focus" />
        <ctrl style="tab_button_new"
              id="tab7"
              posparent="tab6"
              group="content:pa5"
              hardtext="uitabInvPAZig2"
              tooltip="uiTabInfo"
              onclick_r="show"
              params_r="inv_pa5"
              onclick_l="proc"
              params_l="inventory_focus" />
        <ctrl style="tab_button_new"
              id="tab8"
              posparent="tab7"
              group="content:pa6"
              hardtext="uitabInvPAZig3"
              tooltip="uiTabInfo"
              onclick_r="show"
              params_r="inv_pa6"
              onclick_l="proc"
              params_l="inventory_focus" />
        <ctrl style="tab_button_new"
              id="tab9"
              posparent="tab8"
              group="content:guild"
              hardtext="uitabInvGuild"
              tooltip="uiTabInfo"
              onclick_r="set"
              params_r="dblink=UI:SAVE:INVENTORY_GUILD_WANT_POPUP|value=1"
              onclick_l="proc"
              params_l="inventory_focus" />
        <ctrl style="tab_button_new"
              id="tab10"
              posparent="tab9"
              group="content:room"
              hardtext="uitabInvRoom"
              tooltip="uiTabInfo"
              onclick_r="show"
              params_r="inv_room"
              onclick_l="proc"
              params_l="inventory_focus" />
        <link expr="not(@UI:VARIABLES:ISACTIVE:INV_BAG)"
              target="tab0:active" />
        <link expr="not(@UI:VARIABLES:ISACTIVE:INV_EQUIP)"
              target="tab1:active" />
        <!-- MAX_INVENTORY_ANIMAL -->
        <link expr="and(not(@UI:VARIABLES:ISACTIVE:INV_PA0), isAnimalStatusPresent(@%pa_beast0:STATUS))"
              target="tab2:active" />
        <link expr="and(not(@UI:VARIABLES:ISACTIVE:INV_PA1), isAnimalStatusPresent(@%pa_beast1:STATUS))"
              target="tab3:active" />
        <link expr="and(not(@UI:VARIABLES:ISACTIVE:INV_PA2), isAnimalStatusPresent(@%pa_beast2:STATUS))"
              target="tab4:active" />
        <link expr="and(not(@UI:VARIABLES:ISACTIVE:INV_PA3), isAnimalStatusPresent(@%pa_beast3:STATUS))"
              target="tab5:active" />
        <link expr="and(not(@UI:VARIABLES:ISACTIVE:INV_PA4), isAnimalStatusPresent(@%pa_beast4:STATUS))"
              target="tab6:active" />
        <link expr="and(not(@UI:VARIABLES:ISACTIVE:INV_PA5), isAnimalStatusPresent(@%pa_beast5:STATUS))"
              target="tab7:active" />
        <link expr="and(not(@UI:VARIABLES:ISACTIVE:INV_PA6), isAnimalStatusPresent(@%pa_beast6:STATUS))"
              target="tab8:active" />
        <!-- MAX_INVENTORY_ANIMAL -->
        <link expr="switch(@%pa_beast0:TYPE, 'uitabInvPAMount0', 'uitabInvPAMount0', 'uitabInvPAPacker0', 'uitabInvPADemon0')"
              target="tab2:hardtext" />
        <link expr="switch(@%pa_beast1:TYPE, 'uitabInvPAMount1', 'uitabInvPAMount1', 'uitabInvPAPacker1', 'uitabInvPADemon1')"
              target="tab3:hardtext" />
        <link expr="switch(@%pa_beast2:TYPE, 'uitabInvPAMount2', 'uitabInvPAMount2', 'uitabInvPAPacker2', 'uitabInvPADemon2')"
              target="tab4:hardtext" />
        <link expr="switch(@%pa_beast3:TYPE, 'uitabInvPAMount3', 'uitabInvPAMount3', 'uitabInvPAPacker3', 'uitabInvPADemon3')"
              target="tab5:hardtext" />
        <link expr="and(%is_guild_present, not(@UI:SAVE:INVENTORY_GUILD_WANT_POPUP), @UI:TEMP:INVENTORY_GUILD_OPENED)"
              target="tab9:active" />
        <link expr="and(not(@UI:VARIABLES:ISACTIVE:INV_ROOM), @UI:TEMP:INVENTORY_ROOM_OPENED)"
              target="tab10:active" />
      </group>
      <view type="bitmap"
            id="sep"
            posparent="inv_select"
            posref="BR BL"
            sizeparent="parent"
            sizeref="w"
            w="0"
            h="1"
            scale="true"
            texture="blank.tga"
            color="166 166 166 255" />
    </group>
    <group id="content"
           x="0"
           y="0"
           h="170"
           posref="TL TL">
      <ctrl type="button" id="expand_button" button_type="push_button" posref="TR TR" x="-5" y="-8" scale="true" w="16" h="16"
            color="255 255 255 200" col_over="255 255 255 255" col_pushed="255 255 255 255" active="false"
            global_color_normal="false" global_color_pushed="false" global_color_over="false"
            onclick_l="proc" params_l="expand_equip" tx_over="w_button_12_over.tga" tx_normal="Switch_Ratio.tga" tx_pushed="Switch_Ratio.tga"
            over_when_pushed="false" tooltip="uiExpandWindow" />
      <!-- equip -->
      <instance template="tinv_equip" />
      <!-- bag -->
      <group id="bag"
             posref="TL TL"
             x="0"
             y="0"
             sizeref="wh"
             w="0"
             h="0">
        <!-- Special Items -->
        <ctrl style="text_button_16"
          id="bag_items"
          posref="TL TL"
          y="-2"
          x="10"
          wmargin="8"
          hardtext="uitabInvBag"
          tooltip="uitabInvBag"
          onclick_l="proc"
          params_l="select_bag_items" />

        <ctrl style="text_button_16"
          id="special_items"
          posref="TR TL"
          posparent="bag_items"
          y="0"
          x="2"
          wmargin="8"
          hardtext="uiSpecialLabo"
          tooltip="uiSpecialLabo"
          onclick_l="proc"
          params_l="select_special_items" />

        <ctrl id="artefact_tab"
          type="button"
          posref="TR TL"
          posparent="special_items"
          y="0" x="2"
          active="0"
          tooltip="Artefact"
          instant_help="false"
          tx_normal="r2_palette_act.tga"
          tx_pushed="r2_palette_act.tga"
          tx_over="r2_palette_act.tga" />

        <group id="webitems" posref="TL TL" sizeref="wh" h="-35" w="0" x="-10" y="-15" active="0">
            <instance id="html" template="webig_html_noborder" x="0" home="https://app.ryzom.com/app_arcc/index.php?action=mItem_DisplayUserItems" browse_redo="" browse_undo="" browse_refresh="" />
        </group>

        <group id="artefact_content" posref="TL TL" sizeref="wh" h="-35" w="0" x="-8" y="-15" active="0">
            <instance id="html" template="webig_html_noborder" x="0" home="" browse_redo="" browse_undo="" browse_refresh="" />
        </group>
        <group id="artefact_bottom" posref="BR BR" sizeref="wh" h="0" w="0" x="0" y="0" global_color="false" active="0">
            <ctrl id="detach"
                type="button"
                button_type="push_button"
                posref="BR MR"
                y="30"
                x="-4"
                tx_normal="W_win_popup.tga"
                tx_pushed="W_win_popup.tga"
                tx_over="W_button_16_over.tga"
                onclick_l="proc"
                params_l="artefact_win_detach" />
            <instance template="check_box"
                id="autopact_cb"
                posref="BR MR"
                y="10"
                x="-1"
                fontsize="9"
                tooltip="uiArtefactHelp"
                instant_help="false"
                dblink="UI:SAVE:TELEPORT:DO_PACT" />
            <view type="text"
                id="autopact_vt"
                posref="BR MR"
                x="-23"
                y="10"
                hardtext="" />
        </group>

        <instance template="tinv_nbslots_bulk_weight"
                  id="ibw"
                  x="0"
                  inv_branch="%bag"
                  inv_bulk_max="%bag_bulk_max" />
        <!-- y="-18" (because of webig buttons) messes filter icon placement (y should be "-16") -->
        <instance template="tinv_item_list"
                  id="iil"
                  inv_branch_nb="%max_bag_invslot"
                  y="-18"
                  sizeref="wh"
                  h="-16"
                  inv_branch="%bag"
                  inv_type="INV_BAG" />
        <instance template="argent"
                  id="money"
                  posref="BL BL"
                  x="4"
                  y="2"
                  value="%money" />
        <instance template="elyps"
                  id="elyps"
                  active="false"
                  posref="BL BL"
                  x="4"
                  y="2"
                  value="%elyps" />
      </group>
      <!-- pa0 -->
      <instance template="tinv_animal"
                id="pa0"
                info_entry="%pa_beast0"
                bag_entry="%pa_bag0"
                icon_db="INV_PA0" />
      <!-- pa1 -->
      <instance template="tinv_animal"
                id="pa1"
                info_entry="%pa_beast1"
                bag_entry="%pa_bag1"
                icon_db="INV_PA1" />
      <!-- pa2 -->
      <instance template="tinv_animal"
                id="pa2"
                info_entry="%pa_beast2"
                bag_entry="%pa_bag2"
                icon_db="INV_PA2" />
      <!-- pa3 -->
      <instance template="tinv_animal"
                id="pa3"
                info_entry="%pa_beast3"
                bag_entry="%pa_bag3"
                icon_db="INV_PA3" />
      <!-- pa4 -->
      <instance template="tinv_animal"
                id="pa4"
                info_entry="%pa_beast4"
                bag_entry="%pa_bag4"
                icon_db="INV_PA4" />
      <!-- pa5 -->
      <instance template="tinv_animal"
                id="pa5"
                info_entry="%pa_beast5"
                bag_entry="%pa_bag5"
                icon_db="INV_PA5" />
      <!-- pa6 -->
      <instance template="tinv_animal"
                id="pa6"
                info_entry="%pa_beast6"
                bag_entry="%pa_bag6"
                icon_db="INV_PA6" />
      <!-- guild -->
      <group id="guild"
             posref="TL TL"
             x="0"
             y="0"
             sizeref="wh"
             w="0"
             h="0">

        <instance template="tguildinv_nbslots_bulk_weight"
                  id="ibw"
                  x="0"
                  inv_branch="%guild_inv_dbentry"
                  inv_bulk_max="%guild_inv_bulk_max" />
        <instance template="tinv_item_list"
                  id="iil"
                  inv_branch_nb="%max_guild_invslot"
                  start_item="0"
                  inv_type="INV_GUILD" />
        <instance template="argent"
                  id="money"
                  posref="BL BL"
                  x="4"
                  y="2"
                  value="%guild_inv_money" />
        <ctrl style="new_element_header"
              id="getmoney_but"
              posref="MR ML"
              posparent="money"
              x="4"
              wmargin="8"
              hardtext="uittGetMoney"
              onclick_l="proc"
              params_l="guild_get_money" />
        <ctrl style="new_element_header"
              id="putmoney_but"
              posref="MR ML"
              posparent="getmoney_but"
              x="4"
              wmargin="8"
              hardtext="uittPutMoney"
              onclick_l="proc"
              params_l="guild_put_money" />
      </group>

      <group id="guild2"
             posref="TL TL"
             x="0"
             y="0"
             sizeref="wh"
             w="0"
             h="0">
        <instance template="tguildinv_nbslots_bulk_weight"
                  id="ibw"
                  x="0"
                  selected_chest="UI:SAVE:GUILD_INVENTORY_CHEST_B"
                  inv_branch="%guild_inv_dbentry" />
        <instance template="tinv_item_list"
                  id="iil"
                  y="-18"
                  sizeref="wh"
                  h="-16"
                  inv_branch="%guild_inv_dbentry"
                  inv_branch_nb="%max_guild_invslot"
                  start_item="0"
                  inv_type="INV_GUILD2" />
        <instance template="argent"
                  id="money"
                  posref="BL BL"
                  x="4"
                  y="2"
                  value="%guild_inv_money" />
        <ctrl style="new_element_header"
              id="getmoney_but"
              posref="MR ML"
              posparent="money"
              x="4"
              wmargin="8"
              hardtext="uittGetMoney"
              onclick_l="proc"
              params_l="guild_get_money" />
        <ctrl style="new_element_header"
              id="putmoney_but"
              posref="MR ML"
              posparent="getmoney_but"
              x="4"
              wmargin="8"
              hardtext="uittPutMoney"
              onclick_l="proc"
              params_l="guild_put_money" />
      </group>
      <!-- room -->
      <group id="room"
             posref="TL TL"
             x="0"
             y="0"
             sizeref="wh"
             w="0"
             h="0">
        <instance template="tinv_nbslots_bulk_weight"
                  id="ibw"
                  x="-4"
                  inv_branch="%room_inv_dbentry"
                  inv_bulk_max="%room_inv_bulk_max" />
        <instance template="tinv_item_list"
                  id="iil"
                  inv_branch_nb="%max_room_invslot"
                  y="-18"
                  sizeref="wh"
                  h="-16"
                  inv_branch="%room_inv_dbentry"
                  inv_type="INV_ROOM" />
        <instance template="argent"
                  id="money"
                  posref="BL BL"
                  x="4"
                  y="2"
                  value="%room_inv_money" />
      </group>
    </group>
  </group>
  <tree node="inventory" />
  <!--
<anim id="anim_inventory_char_rotate" duration="30"  disable_buttons="false" on_finish="proc" on_finish_params="inventory_char_rotate" >
        <track type="linear" target="inventory:content:char3d:char:rotz">
                <key time="0.0" value="0" />
                <key time="30.0" value="360" />
        </track>
</anim>
-->
  <!-- *********************** -->
  <!-- * TEMPORARY INVENTORY * -->
  <!-- *********************** -->
  <proc id="temp_inventory_activated">
    <action handler="proc"
            params="memorize_inventory_state" />
    <action handler="context_help_html"
            params="inventory" />
  </proc>
  <!-- Make the temp inventory modal parent on faber execution, so the faber can not be done if temp inventory opened
        Same For Missions selection or Mission selection validation
-->
  <group id="temp_inventory"
         type="container"
         posref="MM MM"
         w="242"
         h="136"
         active="false"
         openable="false"
         opened="true"
         resizer="true"
         savable="true"
         right_button="false"
         movable="true"
         pop_min_w="243"
         pop_min_h="136"
         pop_max_w="242"
         pop_max_h="418"
         win_priority="%win_priority_high"
         on_active="proc"
         on_active_params="temp_inventory_activated"
         on_deactive="proc"
         on_deactive_params="restore_inventory_state"
         modal_parent="phrase_faber_execution|bot_chat_missions|bot_chat_accept_mission">

    <group id="header_closed"
           x="0"
           y="0"
           h="12"
           posref="TL TL"></group>
    <group id="header_opened"
           x="0"
           y="0"
           h="16"
           posref="TL TL"
           group_onclick_r="active_menu"
           group_params_r="menu=ui:interface:base_menu_with_color">
      <view type="bitmap"
            id="weight"
            posref="MR MR"
            x="-20"
            texture="W_weight.tga"
            global_color="false" />
      <view type="text"
            id="weight_txt"
            posparent="weight"
            posref="ML MR"
            y="-2"
            x="-2"
            color="255 255 255 255"
            global_color="false"
            shadow="true"
            fontsize="10" />
      <link expr="identity(getItemsWeight('%temp_inv_dbentry',0,%max_temp_invslot),@%temp_inv_dbentry)"
            target="weight_txt:hardtext" />
    </group>
    <group id="content"
           h="136"
           posref="TL TL">
      <group id="list_of_items"
             posref="TL TL"
             x="0"
             y="-6"
             sizeref="wh"
             w="0"
             h="-32">
        <!-- The H should be "42+hspace" * Number of rows. Setup list.max_h too below -->
        <group type="list_sheet_text"
               sizeref="wh"
               w="-10"
               h="0"
               id="lootcontent"
               child_resize_h="false"
               posref="TL TL"
               x="0"
               y="0"
               xitem="2"
               yitem="-2"
               xtext="46"
               ytext="0"
               hspace="2"
               array="false"
               maxitem="%max_temp_invslot"
               startitem="0"
               value="%temp_inv_dbentry"
               selection="false"
               selection_group="buy_selection"
               onclick_r="open_item_help"
               onclick_l="inv_temp_to_bag"
               over_color="%bot_chat_sheet_selection_normal"
               over_col_pushed="%bot_chat_sheet_selection_pushed"
               over_col_over="%bot_chat_sheet_selection_over"
               color="255 255 255 255"
               fontsize="10"
               shadow="true"
               multi_line="true"
               multi_line_space="0">
          <ctrl style="skin_scroll"
                id="scroll_row"
                posref="TL TL"
                target_stepy="44" />
          <group id="list"
                 max_sizeref="h"
                 max_sizeparent="parent"
                 max_h="0"
                 sizeref="w"
                 posref="TL TL"
                 x="8"
                 y="0"
                 w="-16" />
        </group>
      </group>
      <view type="bitmap"
            id="sep"
            x="0"
            y="0"
            posparent="list_of_items"
            posref="BR TR"
            scale="true"
            h="2"
            sizeparent="parent"
            sizeref="w"
            texture="W_line_hor.tga" />
      <instance template="button_ok_cancel"
                posref="BR BR"
                x="-4"
                y="4"
                onclick_ok="inv_temp_all"
                ok_text="uittTakeAll"
                onclick_cancel="inv_temp_none"
                cancel_text="uittDropAll" />
      <!-- Gray the OK button if the inventory is empty -->
      <link expr="@UI:TEMP_INV:ALL_EMPTY"
            target="ok_cancel:ok:frozen" />
    </group>
  </group>
  <tree node="temp_inventory" />
  <!-- ********* -->
  <!-- * HANDS * -->
  <!-- ********* -->
  <proc id="memory_phrase_check"></proc>
  <!-- context menu for memory button -->
  <group type="menu"
         id="cm_memory_phrase"
         extends="base_menu"
         on_active="phrase_check_can_cristalize">
    <action id="cri"
            name="uimCristalize"
            handler="phrase_cristalize"
            icon="cristal_spell.tga" />
    <!-- The erase phrase on the memory is possible only if the phrase composition is not active, and the current phrase is not executed -->
    <action id="for"
            name="uimPhraseDel"
            handler="delete_phrase_or_forget_macro"
            cond="and(eq(@UI:VARIABLES:PHRASE_COMPOSITION:ACTIVE,0),isPhraseMenuNotExecuting())"
            icon="r2ed_not_current_act.tga" />
    <!-- The edit direct on the memory is possible only if the phrase composition is not active, and the current phrase is not executed -->
    <action id="edi"
            name="uimPhraseEdit"
            handler="phrase_edit"
            cond="and(eq(@UI:VARIABLES:PHRASE_COMPOSITION:ACTIVE,0),isPhraseMenuNotExecuting())"
            icon="r2ed_edit_dialog.tga" />
    <action id="inf"
            name="uimInfos"
            handler="open_phraseid_help"
            icon="brick_default.tga" />
    <action id="cut"
            name="uiEditCut"
            handler="phrase_memory_copy"
            params="mode=cut"
            icon="ico_extracting.tga" />
    <action id="copy"
            name="uiEditCopy"
            handler="phrase_memory_copy"
            icon="r2ed_tool_copy.tga" />
  </group>
  <!-- context menu for memory button, when slot is empty -->
  <group type="menu"
         id="cm_memory_phrase_empty"
         extends="base_menu">
    <!-- The new direct on the memory is possible only if the phrase composition is not active -->
    <action id="new"
            name="uimPhraseNew"
            handler="phrase_new"
            cond="eq(@UI:VARIABLES:PHRASE_COMPOSITION:ACTIVE,0)"
            icon="curs_create.tga" />
    <action id="paste"
            name="uiEditPaste"
            handler="memorize_phrase_or_macro"
            icon="r2ed_tool_paste.tga" />
  </group>
  <!-- context menu for memory button when it is a macro-->
  <group type="menu"
         id="cm_memory_macro"
         extends="base_menu"
         on_active="phrase_check_can_cristalize">
    <action id="for"
            name="uimForgetMacro"
            handler="delete_phrase_or_forget_macro"
            icon="r2ed_not_current_act.tga" />
  </group>
  <!-- Defines memory ctrl -->
  <template name="ctrl_memory"
            index=""
            posref="TL TL"
            posparent="parent"
            x="0"
            y="0"
            tx_noitem="">
    <ctrl type="sheet"
          id="s#index"
          value="UI:PHRASE:MEMORY:#index"
          nature="sphraseid"
          brick_over="true"
          x="#x"
          y="#y"
          posref="#posref"
          posparent="#posparent"
          tx_noitem="#tx_noitem"
          oncandrop="can_memorize_phrase_or_macro"
          ondrop="memorize_phrase_or_macro"
          dragable="true"
          menu_r="ui:interface:cm_memory_phrase"
          menu_r_empty_slot="ui:interface:cm_memory_phrase_empty"
          is_shortcut="true"
          drag_copy="true"
          onclick_r="phrase_memory_before_menu"
          onclick_l="cast_phrase_or_create_new"
          tooltip_parent="win"
          tooltip_posref="BL TL"
          tooltip_posref_alt="TL TR" />
    <link expr="eq(@UI:SAVE:GESTIONSETS:DRAGDROP,1)"
          target="s#index:dragable" />
  </template>
  <!-- Defines memory ctrl -->
  <template name="ctrl_alt_memory"
            index=""
            posref="TL TL"
            posparent="parent"
            x="0"
            y="0"
            tx_noitem="">
    <ctrl type="sheet"
          id="s#index"
          value="UI:PHRASE:MEMORY_ALT:#index"
          nature="sphraseid"
          brick_over="true"
          x="#x"
          y="#y"
          posref="#posref"
          posparent="#posparent"
          tx_noitem="#tx_noitem"
          oncandrop="can_memorize_phrase_or_macro"
          ondrop="memorize_phrase_or_macro"
          dragable="true"
          menu_r="ui:interface:cm_memory_phrase"
          menu_r_empty_slot="ui:interface:cm_memory_phrase_empty"
          is_shortcut="false"
          drag_copy="true"
          onclick_r="phrase_memory_before_menu"
          onclick_l="cast_phrase_or_create_new"
          tooltip_parent="win"
          tooltip_posref="TR TL"
          tooltip_posref_alt="TL TR" />
    <link expr="eq(@UI:SAVE:GESTIONSETS2:DRAGDROP,1)"
          target="s#index:dragable" />
  </template>
  <!-- System: must update the memory ctrls regen range BRICK_TICK_RANGE database is changed -->
  <link expr="@SERVER:FLAGS:BRICK_TICK_RANGE"
        action="phrase_update_all_memory_ctrl_regen_tick_range" />

  <!-- Defines memory lock ctrl -->
  <template name="lock_button"
            id=""
            posparent="parent"
            posref="TL TL"
            x="0"
            y="0"
            w="24"
            h="9"
            active="true">
    <ctrl type="button"
          id="#id"
          button_type="toggle_button"
          posparent="#posparent"
          x="#x"
          y="#y"
          posref="#posref"
          active="#active"
          tx_normal="W_button_spellock_off.tga"
          tx_pushed="W_button_spellock_on.tga"
          tx_over="W_button_spellock_over.tga" />
  </template>
  <!-- The Hands -->
  <group type="container"
         id="gestionsets"
         w="410"
         h="48"
         resizer="false"
         header_active="false"
         right_button="false"
         group_onclick_r="active_menu"
         group_params_r="menu=ui:interface:gestionsets_menu"
         movable="true"
         active="false"
         opened="false"
         openable="false"
         global_color="false"
         header_color="UI:SAVE:WIN:COLORS:INV"
         locked="true"
         on_active="set"
         on_active_params="dblink=UI:VARIABLES:ISACTIVE:SETS|value=1"
         on_deactive="set"
         on_deactive_params="dblink=UI:VARIABLES:ISACTIVE:SETS|value=0"
         help_page="interf_action_bar.html"
         on_move="lua:game:updateCurrentActionPosition()">
    <group id="header_closed"
           x="0"
           y="0"
           h="48"
           w="394"
           posref="TL TL" />
    <group id="hands"
           x="9"
           y="0"
           w="392"
           h="68"
           posref="ML ML"
           setnumber="1">
      <ctrl type="sheet"
            id="handr"
            posref="MR MR"
            x="0"
            tx_noitem="hand_right.tga"
            selection_group="inventory_selection"
            onclick_l="proc"
            params_l="inv_left_click_on_slot"
            tooltip="uittHandR"
            menu_r="%self_item_modal_menu"
            dragable="true"
            ondrag="inv_drag"
            params_drag="from_slot"
            oncannotdrop="inv_cannot_drop"
            oncandrop="inv_can_drop"
            ondrop="inv_drop"
            item_slot="RIGHT_HAND"
            value="%hand_r"
            other_hand_slot="handl"
            auto_grayed="false"
            tooltip_parent="win" />
      <ctrl type="sheet"
            id="handl"
            posref="ML ML"
            x="0"
            tx_noitem="hand_left.tga"
            selection_group="inventory_selection"
            onclick_l="proc"
            params_l="inv_left_click_on_slot"
            tooltip="uittHandL"
            menu_r="%self_item_modal_menu"
            dragable="true"
            ondrag="inv_drag"
            params_drag="from_slot"
            oncannotdrop="inv_cannot_drop"
            oncandrop="inv_can_drop"
            ondrop="inv_drop"
            item_slot="LEFT_HAND"
            value="%hand_l"
            other_hand_slot="handr"
            auto_grayed="false"
            tooltip_parent="win" />
      <!-- Must update some things when the item equipped change -->
      <link expr="depends(@%bag:[%hand_r:INDEX_IN_BAG-1]:SHEET)"
            action="phrase_update_from_hand" />
      <link expr="depends(@%bag:[%hand_r:INDEX_IN_BAG-1]:QUALITY)"
            action="phrase_update_from_hand" />
      <link expr="depends(@%bag:[%hand_r:INDEX_IN_BAG-1]:ENCHANT)"
            action="phrase_update_from_hand" />
    </group>
    <group id="shortcuts"
           x="-8"
           w="278"
           h="52"
           posparent="hands"
           posref="MM MM">
      <!-- The Shortcuts. Don't modify ids  -->
      <instance template="ctrl_memory"
                index="0"
                x="0"
                y="0"
                tx_noitem="W_slot_shortcut_id0.tga" />
      <instance template="ctrl_memory"
                index="1"
                x="28"
                y="0"
                tx_noitem="W_slot_shortcut_id1.tga" />
      <instance template="ctrl_memory"
                index="2"
                x="56"
                y="0"
                tx_noitem="W_slot_shortcut_id2.tga" />
      <instance template="ctrl_memory"
                index="3"
                x="84"
                y="0"
                tx_noitem="W_slot_shortcut_id3.tga" />
      <instance template="ctrl_memory"
                index="4"
                x="112"
                y="0"
                tx_noitem="W_slot_shortcut_id4.tga" />
      <instance template="ctrl_memory"
                index="5"
                x="140"
                y="0"
                tx_noitem="W_slot_shortcut_id5.tga" />
      <instance template="ctrl_memory"
                index="6"
                x="168"
                y="0"
                tx_noitem="W_slot_shortcut_id6.tga" />
      <instance template="ctrl_memory"
                index="7"
                x="196"
                y="0"
                tx_noitem="W_slot_shortcut_id7.tga" />
      <instance template="ctrl_memory"
                index="8"
                x="224"
                y="0"
                tx_noitem="W_slot_shortcut_id8.tga" />
      <instance template="ctrl_memory"
                index="9"
                x="252"
                y="0"
                tx_noitem="W_slot_shortcut_id9.tga" />
      <instance template="ctrl_memory"
                index="10"
                x="0"
                y="-26"
                tx_noitem="W_slot_shortcut_shift_id0.tga" />
      <instance template="ctrl_memory"
                index="11"
                x="28"
                y="-26"
                tx_noitem="W_slot_shortcut_shift_id1.tga" />
      <instance template="ctrl_memory"
                index="12"
                x="56"
                y="-26"
                tx_noitem="W_slot_shortcut_shift_id2.tga" />
      <instance template="ctrl_memory"
                index="13"
                x="84"
                y="-26"
                tx_noitem="W_slot_shortcut_shift_id3.tga" />
      <instance template="ctrl_memory"
                index="14"
                x="112"
                y="-26"
                tx_noitem="W_slot_shortcut_shift_id4.tga" />
      <instance template="ctrl_memory"
                index="15"
                x="140"
                y="-26"
                tx_noitem="W_slot_shortcut_shift_id5.tga" />
      <instance template="ctrl_memory"
                index="16"
                x="168"
                y="-26"
                tx_noitem="W_slot_shortcut_shift_id6.tga" />
      <instance template="ctrl_memory"
                index="17"
                x="196"
                y="-26"
                tx_noitem="W_slot_shortcut_shift_id7.tga" />
      <instance template="ctrl_memory"
                index="18"
                x="224"
                y="-26"
                tx_noitem="W_slot_shortcut_shift_id8.tga" />
      <instance template="ctrl_memory"
                index="19"
                x="252"
                y="-26"
                tx_noitem="W_slot_shortcut_shift_id9.tga" />
      <!-- The NextAction and CyclingAction Markers. Don't modify ids. They are posparented in code to the good ctrl -->
      <view type="bitmap"
            id="view_next_action"
            texture="action_next.tga"
            global_color="false"
            active="false"
            posref="TL TL"
            x="0"
            y="0"
            render_layer="3" />
      <view type="bitmap"
            id="view_cycle_action"
            texture="action_cycle.tga"
            global_color="false"
            active="false"
            posref="TL TL"
            x="0"
            y="0"
            render_layer="3" />
      <!-- They are hid special accouting to server state -->
      <link expr="@SERVER:EXECUTE_PHRASE:NEXT_COUNTER"
            action="phrase_counter_update"
            params="cyclic=0" />
      <link expr="@SERVER:EXECUTE_PHRASE:CYCLE_COUNTER"
            action="phrase_counter_update"
            params="cyclic=1" />
      <link expr="@UI:VARIABLES:CURRENT_TIME"
            action="phrase_debug_client" />
    </group>
    <group type="select_number"
           id="select_memory"
           value="UI:PHRASE:SELECT_MEMORY"
           loop="true"
           min="1"
           max="10"
           x="9"
           y="0"
           w="297"
           h="52"
           posparent="shortcuts"
           posref="MM MM"
           delta="1">
      <view type="bitmap"
            id="slot_number"
            posref="MR MR"
            texture="W_slot_number.tga" />
      <view type="text"
            id="number"
            posparent="slot_number"
            posref="MM MM"
            x="0"
            y="0"
            color="255 255 255 255"
            fontsize="10"
            shadow="true"
            hardtext="0"
            global_color="false" />
      <ctrl type="button"
            id="arrow_up"
            button_type="push_button"
            posref="TR TR"
            x="-2"
            y="-6"
            tx_normal="W_arrow_up_1.tga"
            tx_pushed="W_arrow_up_1.tga"
            tx_over="W_button_12_over.tga"
            tooltip="uittHandSet"
            tooltip_parent="win" />
      <ctrl type="button"
            id="arrow_down"
            button_type="push_button"
            posref="BR BR"
            x="-2"
            y="6"
            tx_normal="W_arrow_down_1.tga"
            tx_pushed="W_arrow_down_1.tga"
            tx_over="W_button_12_over.tga"
            tooltip="uittHandSet"
            tooltip_parent="win" />
    </group>
    <link expr="@UI:PHRASE:SELECT_MEMORY"
          action="phrase_select_memory"
          params="value=add(@UI:PHRASE:SELECT_MEMORY,-1)" />
  </group>
  <tree node="gestionsets" />

  <!-- second hands bar -->
  <define id="gestionsets_h" value="1" />
  <define id="gestionsets_v" value="2" />

  <variable entry="UI:SAVE:GESTIONSETS:DRAGDROP" type="sint32" value="1" />
  <variable entry="UI:SAVE:GESTIONSETS2:DRAGDROP" type="sint32" value="1" />
  <variable entry="UI:SAVE:GESTIONSETS2_MODE" type="sint32" value="0" />

  <proc id="gestionsets2_proc_active">
    <action handler="set" params="dblink=UI:VARIABLES:ISACTIVE:SETS2|value=1"/>
    <action handler="proc" params="gestionsets2_proc_mode" />
  </proc>

  <proc id="gestionsets2_proc_set">
    <action handler="set" params="dblink=UI:SAVE:GESTIONSETS2_MODE|value=@0"/>
    <action handler="proc" params="gestionsets2_proc_mode" />
  </proc>

  <proc id="gestionsets2_proc_mode">
    <action handler="proc" cond="eq(@UI:SAVE:GESTIONSETS2_MODE,%gestionsets_h)" params="gestionsets2_proc_horiz"/>
    <action handler="proc" cond="ne(@UI:SAVE:GESTIONSETS2_MODE,%gestionsets_h)" params="gestionsets2_proc_vert"/>
  </proc>

  <proc id="gestionsets2_proc_vert">
    <action handler="set" params="target='ui:interface:gestionsets2_menu:horiz:active'|value=1"/>
    <action handler="set" params="target='ui:interface:gestionsets2_menu:vert:active'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:w'|value=68"/>
    <action handler="set" params="target='ui:interface:gestionsets2:h'|value=300"/>

    <action handler="set" params="target='ui:interface:gestionsets2:select_memory:active'|value=1"/>
    <action handler="set" params="target='ui:interface:gestionsets2:select_memory_h:active'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:w'|value=68"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:h'|value=300"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:w'|value=68"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:h'|value=300"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s0:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s0:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s1:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s1:y'|value=-28"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s2:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s2:y'|value=-56"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s3:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s3:y'|value=-84"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s4:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s4:y'|value=-112"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s5:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s5:y'|value=-140"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s6:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s6:y'|value=-168"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s7:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s7:y'|value=-196"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s8:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s8:y'|value=-224"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s9:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s9:y'|value=-252"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s10:x'|value=26"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s10:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s11:x'|value=26"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s11:y'|value=-28"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s12:x'|value=26"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s12:y'|value=-56"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s13:x'|value=26"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s13:y'|value=-84"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s14:x'|value=26"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s14:y'|value=-112"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s15:x'|value=26"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s15:y'|value=-140"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s16:x'|value=26"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s16:y'|value=-168"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s17:x'|value=26"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s17:y'|value=-196"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s18:x'|value=26"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s18:y'|value=-224"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s19:x'|value=26"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s19:y'|value=-252"/>
  </proc>

  <proc id="gestionsets2_proc_horiz">
    <action handler="set" params="target='ui:interface:gestionsets2_menu:horiz:active'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2_menu:vert:active'|value=1"/>

    <action handler="set" params="target='ui:interface:gestionsets2:w'|value=315"/>
    <action handler="set" params="target='ui:interface:gestionsets2:h'|value=52"/>

    <action handler="set" params="target='ui:interface:gestionsets2:select_memory:active'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:select_memory_h:active'|value=1"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:w'|value=315"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:h'|value=52"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:w'|value=315"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:h'|value=52"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s0:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s0:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s1:x'|value=28"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s1:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s2:x'|value=56"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s2:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s3:x'|value=84"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s3:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s4:x'|value=112"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s4:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s5:x'|value=140"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s5:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s6:x'|value=168"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s6:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s7:x'|value=196"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s7:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s8:x'|value=224"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s8:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s9:x'|value=252"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s9:y'|value=0"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s10:x'|value=0"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s10:y'|value=-26"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s11:x'|value=28"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s11:y'|value=-26"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s12:x'|value=56"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s12:y'|value=-26"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s13:x'|value=84"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s13:y'|value=-26"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s14:x'|value=112"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s14:y'|value=-26"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s15:x'|value=140"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s15:y'|value=-26"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s16:x'|value=168"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s16:y'|value=-26"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s17:x'|value=196"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s17:y'|value=-26"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s18:x'|value=224"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s18:y'|value=-26"/>

    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s19:x'|value=252"/>
    <action handler="set" params="target='ui:interface:gestionsets2:header_closed:shortcuts:s19:y'|value=-26"/>
  </proc>

  <!-- show/hide menu options -->
  <proc id="proc_gestionsets_menu_iconlock">
    <action handler="set" params="target='ui:interface:gestionsets_menu:enable_dragdrop:active'|value=not(@UI:SAVE:GESTIONSETS:DRAGDROP)" />
    <action handler="set" params="target='ui:interface:gestionsets_menu:disable_dragdrop:active'|value=@UI:SAVE:GESTIONSETS:DRAGDROP" />
  </proc>

  <proc id="proc_gestionsets2_menu_iconlock">
    <action handler="set" params="target='ui:interface:gestionsets2_menu:enable_dragdrop:active'|value=not(@UI:SAVE:GESTIONSETS2:DRAGDROP)" />
    <action handler="set" params="target='ui:interface:gestionsets2_menu:disable_dragdrop:active'|value=@UI:SAVE:GESTIONSETS2:DRAGDROP" />
  </proc>

  <!-- menu -->
  <group type="menu" id="gestionsets_menu" extends="base_menu_with_color">
    <action id="enable_dragdrop"  name="uiUnlockIcons" handler="set" params="dblink=UI:SAVE:GESTIONSETS:DRAGDROP|value=1" />
    <action id="disable_dragdrop" name="uiLockIcons"   handler="set" params="dblink=UI:SAVE:GESTIONSETS:DRAGDROP|value=0" />
    <separator />
  </group>

  <group type="menu" id="gestionsets2_menu" extends="base_menu_with_color">
    <action id="enable_dragdrop"  name="uiUnlockIcons" handler="set" params="dblink=UI:SAVE:GESTIONSETS2:DRAGDROP|value=1" />
    <action id="disable_dragdrop" name="uiLockIcons"   handler="set" params="dblink=UI:SAVE:GESTIONSETS2:DRAGDROP|value=0" />
    <separator />
    <action id="horiz" name="uiHorizontal" handler="proc" params="gestionsets2_proc_set|%gestionsets_h"/>
    <action id="vert" name="uiVertical" handler="proc" params="gestionsets2_proc_set|%gestionsets_v"/>
    <separator />
  </group>

  <group type="container"
         id="gestionsets2"
         w="68"
         h="300"
         resizer="false"
         header_active="false"
         right_button="false"
         group_onclick_r="active_menu"
         group_params_r="menu=ui:interface:gestionsets2_menu"
         movable="true"
         active="true"
         opened="false"
         openable="false"
         global_color="false"
         header_color="UI:SAVE:WIN:COLORS:INV"
         locked="true"
         on_active="proc"
         on_active_params="gestionsets2_proc_active"
         on_deactive="set"
         on_deactive_params="dblink=UI:VARIABLES:ISACTIVE:SETS2|value=0"
         help_page="interf_action_bar.html">
    <group id="header_closed"
           x="0"
           y="0"
           w="68"
           h="300"
           posref="TL TL">
    <group id="shortcuts"
		   y="-1"
           w="68"
           h="300"
           posref="TL TL">
      <!-- The Shortcuts. Don't modify ids  -->
      <instance template="ctrl_alt_memory"
                index="0"
                x="0"
                y="0"
                tx_noitem="W_slot_shortcut_id0.tga" />
      <instance template="ctrl_alt_memory"
                index="1"
                y="-28"
                x="0"
                tx_noitem="W_slot_shortcut_id1.tga" />
      <instance template="ctrl_alt_memory"
                index="2"
                y="-56"
                x="0"
                tx_noitem="W_slot_shortcut_id2.tga" />
      <instance template="ctrl_alt_memory"
                index="3"
                y="-84"
                x="0"
                tx_noitem="W_slot_shortcut_id3.tga" />
      <instance template="ctrl_alt_memory"
                index="4"
                y="-112"
                x="0"
                tx_noitem="W_slot_shortcut_id4.tga" />
      <instance template="ctrl_alt_memory"
                index="5"
                y="-140"
                x="0"
                tx_noitem="W_slot_shortcut_id5.tga" />
      <instance template="ctrl_alt_memory"
                index="6"
                y="-168"
                x="0"
                tx_noitem="W_slot_shortcut_id6.tga" />
      <instance template="ctrl_alt_memory"
                index="7"
                y="-196"
                x="0"
                tx_noitem="W_slot_shortcut_id7.tga" />
      <instance template="ctrl_alt_memory"
                index="8"
                y="-224"
                x="0"
                tx_noitem="W_slot_shortcut_id8.tga" />
      <instance template="ctrl_alt_memory"
                index="9"
                y="-252"
                x="0"
                tx_noitem="W_slot_shortcut_id9.tga" />
      <instance template="ctrl_alt_memory"
                index="10"
                y="-0"
                x="26"
                tx_noitem="W_slot_shortcut_shift_id0.tga" />
      <instance template="ctrl_alt_memory"
                index="11"
                y="-28"
                x="26"
                tx_noitem="W_slot_shortcut_shift_id1.tga" />
      <instance template="ctrl_alt_memory"
                index="12"
                y="-56"
                x="26"
                tx_noitem="W_slot_shortcut_shift_id2.tga" />
      <instance template="ctrl_alt_memory"
                index="13"
                y="-84"
                x="26"
                tx_noitem="W_slot_shortcut_shift_id3.tga" />
      <instance template="ctrl_alt_memory"
                index="14"
                y="-112"
                x="26"
                tx_noitem="W_slot_shortcut_shift_id4.tga" />
      <instance template="ctrl_alt_memory"
                index="15"
                y="-140"
                x="26"
                tx_noitem="W_slot_shortcut_shift_id5.tga" />
      <instance template="ctrl_alt_memory"
                index="16"
                y="-168"
                x="26"
                tx_noitem="W_slot_shortcut_shift_id6.tga" />
      <instance template="ctrl_alt_memory"
                index="17"
                y="-196"
                x="26"
                tx_noitem="W_slot_shortcut_shift_id7.tga" />
      <instance template="ctrl_alt_memory"
                index="18"
                y="-224"
                x="26"
                tx_noitem="W_slot_shortcut_shift_id8.tga" />
      <instance template="ctrl_alt_memory"
                index="19"
                y="-252"
                x="26"
                tx_noitem="W_slot_shortcut_shift_id9.tga" />
     </group>
    </group>
<!-- Mofications Cyrillas for bar1 related selection -->
      <group type="select_number"
             id="select_memory"
             value="UI:PHRASE:SELECT_MEMORY_2"
             loop="true"
             min="1"
             max="10"
             x="0"
             y="0"
             w="68"
             h="300"
             posparent="shortcuts"
             posref="MM MM"
             delta="1">
        <view type="bitmap"
              id="slot_number"
              posref="BM BM"
              texture="W_slot_number.tga" />
        <view type="text"
              id="number"
              posparent="slot_number"
              posref="MM MM"
              x="0"
              y="0"
              color="255 255 255 255"
              fontsize="12"
              shadow="true"
              hardtext="0"
              global_color="false" />
        <ctrl type="button"
              id="arrow_down"
              button_type="push_button"
              posref="BL BL"
              x="10"
              y="0"
              tx_normal="W_arrow_left_0.tga"
              tx_pushed="W_arrow_left_0.tga"
              tx_over="W_button_12_over.tga"
              tooltip="uittHandSet"
              tooltip_parent="win" />
        <ctrl type="button"
              id="arrow_up"
              button_type="push_button"
              posref="BR BR"
              x="-9"
              y="0"
              tx_normal="W_arrow_right_0.tga"
              tx_pushed="W_arrow_right_0.tga"
              tx_over="W_button_12_over.tga"
              tooltip="uittHandSet"
              tooltip_parent="win" />
      </group>
      <group type="select_number"
             id="select_memory_h"
             value="UI:PHRASE:SELECT_MEMORY_2"
             loop="true"
             min="1"
             max="10"
             x="0"
             y="0"
             w="300"
             h="52"
             active="false"
             posparent="shortcuts"
             posref="MM MM"
             delta="1">
        <view type="bitmap"
              id="slot_number"
              posref="MR MR"
              texture="W_slot_number.tga" />
        <view type="text"
              id="number"
              posparent="slot_number"
              posref="MM MM"
              x="0"
              y="0"
              color="255 255 255 255"
              fontsize="12"
              shadow="true"
              hardtext="0"
              global_color="false" />
        <ctrl type="button"
              id="arrow_up"
              button_type="push_button"
              posref="TM BM"
              posparent="slot_number"
              x="0"
              y="0"
              tx_normal="W_arrow_up_1.tga"
              tx_pushed="W_arrow_up_1.tga"
              tx_over="W_button_12_over.tga"
              tooltip="uittHandSet"
              tooltip_parent="win" />
        <ctrl type="button"
              id="arrow_down"
              button_type="push_button"
              posref="BM TM"
              posparent="slot_number"
              x="0"
              y="0"
              tx_normal="W_arrow_down_1.tga"
              tx_pushed="W_arrow_down_1.tga"
              tx_over="W_button_12_over.tga"
              tooltip="uittHandSet"
              tooltip_parent="win" />
      </group>
      <link expr="@UI:PHRASE:SELECT_MEMORY_2"
            action="phrase_select_memory_2"
            params="value=add(@UI:PHRASE:SELECT_MEMORY_2,-1)" />
      <link expr="depends(@UI:SAVE:GESTIONSETS2_MODE)"
            action="proc"
            params="gestionsets_proc_mode" />
      <link expr="depends(@UI:SAVE:GESTIONSETS:DRAGDROP)"
            action="proc"
            params="proc_gestionsets_menu_iconlock" />
      <link expr="depends(@UI:SAVE:GESTIONSETS2:DRAGDROP)"
            action="proc"
            params="proc_gestionsets2_menu_iconlock" />
  </group>
  <tree node="gestionsets2" />
  <!-- hands -->
  <!-- ************************* -->
  <!-- ** TEAM SHARING SYSTEM ** -->
  <!-- ************************* -->
  <!-- Used to share item or phrase in mission rewards -->
  <template name="t_team_share_member"
            id=""
            memberid=""
            x="0"
            y="0"
            y1="0"
            posref="TL TL"
            posparent="parent">
    <view type="text_id"
          id="t_#id"
          x="#x"
          y="#y"
          posref="TL TL"
          posparent="#posparent"
          fontsize="10"
          shadow="true"
          textid="LOCAL:INVENTORY:SHARE:TM_#memberid:NAME"
          dynamic_string="false" />
    <view type="bitmap"
          id="v_#id"
          x="-2"
          y="#y1"
          posref="TR TR"
          posparent="#posparent"
          texture="w_answer_16_valid.tga"
          global_color="false" />
    <link expr="ne(@LOCAL:INVENTORY:SHARE:TM_#memberid:NAME,0)"
          target="t_#id:active,v_#id:active" />
    <link expr="ifthenelse(eq(@LOCAL:INVENTORY:SHARE:TM_#memberid:VALID,0), '', 'w_answer_16_valid.tga')"
          target="v_#id:texture" />
  </template>
  <group id="team_share"
         type="container"
         posref="MM MM"
         w="454"
         h="136"
         active="false"
         openable="false"
         opened="true"
         resizer="false"
         savable="false"
         right_button="false"
         movable="true"
         win_priority="%win_priority_high"
         title="uiTeamShareTitle"
         header_color="UI:SAVE:WIN:COLORS:MEM"
         global_color="false">
    <group id="header_closed"
           x="0"
           y="0"
           h="12"
           posref="TL TL"></group>
    <group id="header_opened"
           x="0"
           y="0"
           h="32"
           posref="TL TL"
           group_onclick_r="active_menu"
           group_params_r="menu=ui:interface:base_menu_with_color">
      <group id="top_menu"
             sizeref="w"
             w="0"
             h="18"
             y="-17"
             posref="TL TL">
        <view type="bitmap"
              id="back"
              x="274"
              y="0"
              posref="TL TL"
              scale="true"
              w="162"
              sizeref="h"
              texture="blank.tga"
              color="0 0 0 64"
              global_color="false" />
        <view type="bitmap"
              id="sep1"
              x="208"
              y="0"
              posref="TL TL"
              scale="true"
              w="2"
              sizeref="h"
              texture="W_line_ver.tga" />
        <view type="bitmap"
              id="sep2"
              x="236"
              y="0"
              posref="TL TL"
              scale="true"
              w="2"
              sizeref="h"
              texture="W_line_ver.tga" />
        <view type="bitmap"
              id="sep3"
              x="272"
              y="0"
              posref="TL TL"
              scale="true"
              w="2"
              sizeref="h"
              texture="W_line_ver.tga" />
        <view type="bitmap"
              id="sep4"
              x="0"
              y="0"
              posref="TR TR"
              scale="true"
              w="2"
              sizeref="h"
              texture="W_line_ver.tga" />
        <view type="text"
              id="items"
              x="10"
              y="0"
              posref="BL BL"
              fontsize="10"
              hardtext="uiTeamShareItems"
              shadow="true"
              global_color="false" />
        <view type="text"
              id="Nbr"
              x="220"
              y="0"
              posref="BL BL"
              fontsize="12"
              hardtext="uiTeamShareAsks"
              shadow="true"
              global_color="false" />
        <view type="text"
              id="chances"
              x="252"
              y="-1"
              posref="BL BL"
              fontsize="12"
              hardtext="uiTeamShareChance"
              shadow="true"
              global_color="false" />
        <view type="text"
              id="valids"
              x="276"
              y="0"
              posref="BL BL"
              fontsize="10"
              hardtext="uiTeamShareValid"
              shadow="true"
              global_color="false" />
      </group>
    </group>
    <group id="content"
           h="214"
           posref="TR TR">
      <group id="separators"
             posref="TL TL"
             sizeref="wh"
             h="-22">
        <view type="bitmap"
              id="back"
              x="274"
              y="0"
              posref="TL TL"
              scale="true"
              w="162"
              h="190"
              texture="blank.tga"
              color="0 0 0 64"
              global_color="false" />
        <view type="bitmap"
              id="sep0"
              x="0"
              y="0"
              posref="TL TL"
              scale="true"
              h="2"
              sizeref="w"
              texture="W_line_hor.tga" />
        <view type="bitmap"
              id="sep1"
              x="208"
              y="-2"
              posref="TL TL"
              scale="true"
              w="2"
              sizeref="h"
              h="-4"
              texture="W_line_ver.tga" />
        <view type="bitmap"
              id="sep2"
              x="236"
              y="-2"
              posref="TL TL"
              scale="true"
              w="2"
              sizeref="h"
              h="-4"
              texture="W_line_ver.tga" />
        <view type="bitmap"
              id="sep3"
              x="272"
              y="-2"
              posref="TL TL"
              scale="true"
              w="2"
              sizeref="h"
              h="-4"
              texture="W_line_ver.tga" />
        <view type="bitmap"
              id="sep4"
              x="436"
              y="-2"
              posref="TL TL"
              scale="true"
              w="2"
              sizeref="h"
              h="-4"
              texture="W_line_ver.tga" />
        <view type="bitmap"
              id="sep5"
              x="0"
              y="0"
              posref="BL BL"
              scale="true"
              h="2"
              sizeref="w"
              texture="W_line_hor.tga" />
      </group>
      <group id="list_of_items"
             posref="TL TL"
             x="0"
             y="-6"
             w="272"
             h="184">
        <!-- The H should be "42+hspace" * Number of rows. Setup list.max_h too below -->
        <group type="list_sheet_share"
               sizeref="w"
               w="0"
               h="184"
               id="content"
               posref="TM TM"
               x="0"
               y="0"
               xitem="18"
               yitem="-2"
               xtext="62"
               ytext="-2"
               selection="false"
               nature="auto"
               x_nbmember="212"
               y_nbmember="-20"
               icon_wanted="W_opacity_on.tga"
               icon_not_wanted="w_slot_on.tga"
               x_wanted="2"
               y_wanted="-17"
               x_chance="240"
               y_chance="-20"
               hspace="4"
               array="false"
               maxitem="16"
               startitem="0"
               value="SERVER:INVENTORY:SHARE"
               selection_group="buy_selection"
               onclick_r="open_item_help"
               onclick_l="team_share_choose"
               over_color="%bot_chat_sheet_selection_normal"
               over_col_pushed="%bot_chat_sheet_selection_pushed"
               over_col_over="%bot_chat_sheet_selection_over"
               color="255 255 255 255"
               fontsize="8"
               shadow="true"
               multi_line="true"
               multi_line_space="0"
               line_maxw="136">
          <ctrl style="skin_scroll"
                id="scroll_row"
                posref="TL TL"
                target_stepy="44" />
          <group id="list"
                 sizeref="w"
                 posref="TL TL"
                 max_h="184"
                 x="8"
                 y="0"
                 w="-8"
                 h="0" />
        </group>
      </group>
      <group id="list_of_members"
             posref="TR TR"
             x="0"
             y="-6"
             w="156"
             h="184">
        <instance template="t_team_share_member"
                  id="tsm1"
                  memberid="0"
                  y="0"
                  y1="4" />
        <instance template="t_team_share_member"
                  id="tsm2"
                  memberid="1"
                  y="-20"
                  y1="-16" />
        <instance template="t_team_share_member"
                  id="tsm3"
                  memberid="2"
                  y="-40"
                  y1="-36" />
        <instance template="t_team_share_member"
                  id="tsm4"
                  memberid="3"
                  y="-60"
                  y1="-56" />
        <instance template="t_team_share_member"
                  id="tsm5"
                  memberid="4"
                  y="-80"
                  y1="-76" />
        <instance template="t_team_share_member"
                  id="tsm6"
                  memberid="5"
                  y="-100"
                  y1="-96" />
        <instance template="t_team_share_member"
                  id="tsm7"
                  memberid="6"
                  y="-120"
                  y1="-116" />
        <instance template="t_team_share_member"
                  id="tsm8"
                  memberid="7"
                  y="-140"
                  y1="-136" />
      </group>
      <group id="tooltips"
             posref="TL TL"
             x="0"
             y="0"
             sizeref="w"
             h="190">
        <ctrl type="tooltip"
              id="ttselect"
              tooltip="uiTS_Select"
              color="255 255 255 255"
              posref="TL TL"
              x="8"
              y="0"
              w="18"
              h="190" />
        <ctrl type="tooltip"
              id="ttitems"
              tooltip="uiTS_Items"
              posparent="ttselect"
              color="255 255 255 255"
              posref="TR TL"
              w="183"
              h="190" />
        <ctrl type="tooltip"
              id="tttimes"
              tooltip="uiTS_Times"
              posparent="ttitems"
              color="255 255 255 255"
              posref="TR TL"
              w="28"
              h="190" />
        <ctrl type="tooltip"
              id="ttchance"
              tooltip="uiTS_Chances"
              posparent="tttimes"
              color="255 255 255 255"
              posref="TR TL"
              w="36"
              h="190" />
        <ctrl type="tooltip"
              id="ttvalid"
              tooltip="uiTS_Valids"
              posparent="ttchance"
              color="255 255 255 255"
              posref="TR TL"
              w="161"
              h="190" />
      </group>
      <ctrl style="button_ok"
            posref="BM BM"
            y="2"
            onclick_l="team_share_valid"
            hardtext="uiValidate" />
    </group>
  </group>
  <tree node="team_share" />
  <!-- ************* -->
  <!-- ** DEFENSE ** -->
  <!-- ************* -->
  <proc id="defense_active">
    <action handler="set"
            params="dblink=UI:VARIABLES:ISACTIVE:DEFENSE|value=1" />
  </proc>
  <proc id="defense_deactive">
    <action handler="set"
            params="dblink=UI:VARIABLES:ISACTIVE:DEFENSE|value=0" />
  </proc>
  <style style="defense_armor"
         type="sheet"
         menu_r="%self_item_modal_menu"
         selection_group="inventory_selection"
         auto_grayed="false" />
  <template name="defense_value"
            x="0"
            y="1"
            w="40"
            h="12"
            posref="BM BM"
            keep="true"
            id=""
            val_defense=""
            parent="">
    <group id="#id"
           posref="#posref"
           w="#w"
           h="#h"
           x="#x"
           y="#y"
           posparent="#posparent">
      <view type="bitmap"
            id="back"
            posref="TL TL"
            texture="blank.tga"
            scale="true"
            sizeref="wh"
            color="0 0 0 80"
            global_color="false" />
      <view type="text_number"
            id="value"
            posref="TM TM"
            x="2"
            y="-2"
            color="255 255 255 255"
            shadow="true"
            global_color="false"
            fontsize="10"
            value="#val_defense" />
      <view type="text"
            id="sign"
            posref="ML MR"
            x="1"
            y="0"
            color="152 211 72 255"
            posparent="value"
            shadow="true"
            global_color="false"
            fontsize="10"
            hardtext="+" />
      <link expr="gt(@#val_defense,0)"
            target="sign:active" />
      <link expr="ifthenelse(lt(@#val_defense,0),'-2',
                                                ifthenelse(gt(@#val_defense,0),'1','0'))"
            target="value:x" />
      <link expr="ifthenelse(lt(@#val_defense,0),'236 74 36 255',
                                                ifthenelse(gt(@#val_defense,0),'152 211 72 255', '255 255 255 255'))"
            target="value:color" />
    </group>
  </template>
  <group type="container"
         id="defense"
         w="94"
         h="256"
         title="uiDefenseTitle"
         min_w="94"
         max_w="94"
         min_h="236"
         max_h="236"
         resizer="false"
         locked="true"
         header_active="true"
         right_button="true"
         movable="true"
         active="false"
         opened="true"
         openable="false"
         global_color="false"
         header_color="UI:SAVE:WIN:COLORS:INV"
         title_class="formated"
         on_active="proc"
         on_active_params="defense_active"
         on_deactive="proc"
         on_deactive_params="defense_deactive">
    <group id="header_closed"
           x="0"
           y="0"
           h="12"
           posref="TL TL"></group>
    <group id="header_opened"
           x="0"
           y="0"
           w="86"
           h="248"
           posref="TL TL"
           group_onclick_r="active_menu"
           group_params_r="menu=ui:interface:base_menu_with_color">
      <group id="styles"
             posref="TM TM"
             y="-20"
             sizeref="w"
             w="0"
             h="50">
        <ctrl style="defense_style_button"
              id="style1"
              posref="TM TM"
              y="0"
              hardtext="uiStyle1"
              onclick_l="dodge"
              params_l="" />
        <ctrl style="defense_style_button"
              id="style2"
              posref="BM BM"
              y="0"
              hardtext="uiStyle2"
              onclick_l="parry"
              params_l="" />
        <link expr="eq(@SERVER:DEFENSE:DEFENSE_MODE,0)"
              target="style1:pushed" />
        <link expr="eq(@SERVER:DEFENSE:DEFENSE_MODE,1)"
              target="style2:pushed" />
      </group>
      <group id="armors"
             posref="BR BR"
             w="86"
             h="174"
             x="0"
             y="0">
        <ctrl style="defense_armor"
              id="head"
              posref="TL TL"
              x="0"
              y="0"
              tx_noitem="W_AR_helmet.tga"
              item_slot="HEAD"
              value="%head"
              tooltip="uittDefenseHead" />
        <ctrl style="defense_armor"
              id="chest"
              posref="BL TL"
              posparent="head"
              x="0"
              y="-2"
              tx_noitem="W_AR_gilet.tga"
              item_slot="CHEST"
              value="%chest"
              tooltip="uittDefenseChest" />
        <ctrl style="defense_armor"
              id="legs"
              posref="BL TL"
              posparent="chest"
              x="0"
              y="-2"
              tx_noitem="W_AR_pantabotte.tga"
              item_slot="LEGS"
              value="%legs"
              tooltip="uittDefenseLegs" />
        <ctrl style="defense_armor"
              id="feet"
              posref="BL TL"
              posparent="legs"
              x="0"
              y="-2"
              tx_noitem="W_AR_botte.tga"
              item_slot="FEET"
              value="%feet"
              tooltip="uittDefenseFeet" />
        <ctrl style="defense_armor"
              id="arms"
              posref="TR TL"
              posparent="chest"
              x="2"
              y="11"
              tx_noitem="W_AR_armpad.tga"
              item_slot="ARMS"
              value="%arms"
              tooltip="uittDefenseArms" />
        <ctrl style="defense_armor"
              id="hands"
              posref="BL TL"
              posparent="arms"
              x="0"
              y="-2"
              tx_noitem="W_AR_hand.tga"
              item_slot="HANDS"
              value="%hands"
              tooltip="uittDefenseHands" />
        <!-- BUTTONS TO DEFINE DEFENSE TARGET -->
        <ctrl id="all"
              type="text_button"
              button_type="radio_button"
              posref="BR BR"
              wmin="42"
              y="0"
              tx_normal="w_defense_normal"
              tx_pushed="w_defense"
              tx_over="w_defense"
              text_y="-2"
              fontsize="12"
              shadow="true"
              hardtext="uiDefenseReset"
              color="255 255 255 255"
              col_over="255 255 255 255"
              col_pushed="255 190 0 255"
              global_color_normal="true"
              global_color_over="true"
              global_color_pushed="false"
              text_color_normal="255 255 255 160"
              text_color_pushed="255 255 255 255"
              text_color_over="255 255 255 255"
              text_shadow_color_normal="0 0 0 255"
              text_shadow_color_pushed="0 0 0 255"
              text_shadow_color_over="0 0 0 255"
              text_global_color_normal="true"
              text_global_color_pushed="false"
              text_global_color_over="true"
              onclick_l="select_protected_slot"
              params_l="UNDEFINED" />
        <ctrl style="defense_button"
              id="head_button"
              posparent="head"
              posref="MM MM"
              onclick_l="select_protected_slot"
              params_l="Head" />
        <ctrl style="defense_button"
              id="chest_button"
              posparent="chest"
              posref="MM MM"
              onclick_l="select_protected_slot"
              params_l="Body" />
        <ctrl style="defense_button"
              id="arms_button"
              posparent="arms"
              posref="MM MM"
              onclick_l="select_protected_slot"
              params_l="Arms" />
        <ctrl style="defense_button"
              id="hands_button"
              posparent="hands"
              posref="MM MM"
              onclick_l="select_protected_slot"
              params_l="Hands" />
        <ctrl style="defense_button"
              id="legs_button"
              posparent="legs"
              posref="MM MM"
              onclick_l="select_protected_slot"
              params_l="Legs" />
        <ctrl style="defense_button"
              id="feet_button"
              posparent="feet"
              posref="MM MM"
              onclick_l="select_protected_slot"
              params_l="Feet" />
        <link expr="eq(@SERVER:DEFENSE:PROTECTED_SLOT,0)"
              target="all:pushed" />
        <link expr="eq(@SERVER:DEFENSE:PROTECTED_SLOT,1)"
              target="head_button:pushed" />
        <link expr="eq(@SERVER:DEFENSE:PROTECTED_SLOT,2)"
              target="chest_button:pushed" />
        <link expr="eq(@SERVER:DEFENSE:PROTECTED_SLOT,3)"
              target="arms_button:pushed" />
        <link expr="eq(@SERVER:DEFENSE:PROTECTED_SLOT,4)"
              target="hands_button:pushed" />
        <link expr="eq(@SERVER:DEFENSE:PROTECTED_SLOT,5)"
              target="legs_button:pushed" />
        <link expr="eq(@SERVER:DEFENSE:PROTECTED_SLOT,6)"
              target="feet_button:pushed" />
        <instance template="defense_value"
                  id="head_val"
                  posparent="head"
                  val_defense="SERVER:DEFENSE:SLOTS:0:MODIFIER" />
        <instance template="defense_value"
                  id="chest_val"
                  posparent="chest"
                  val_defense="SERVER:DEFENSE:SLOTS:1:MODIFIER" />
        <instance template="defense_value"
                  id="arms_val"
                  posparent="arms"
                  val_defense="SERVER:DEFENSE:SLOTS:2:MODIFIER" />
        <instance template="defense_value"
                  id="hands_val"
                  posparent="hands"
                  val_defense="SERVER:DEFENSE:SLOTS:3:MODIFIER" />
        <instance template="defense_value"
                  id="legs_val"
                  posparent="legs"
                  val_defense="SERVER:DEFENSE:SLOTS:4:MODIFIER" />
        <instance template="defense_value"
                  id="feet_val"
                  posparent="feet"
                  val_defense="SERVER:DEFENSE:SLOTS:5:MODIFIER" />
      </group>
    </group>
    <group id="content"
           w="0"
           h="0" />
  </group>
  <tree node="defense" />
  <!-- ********************************************************************* -->
  <!-- ** CUSTOM TEXT EDITION AND DISPLAY                                      ** -->
  <!-- ********************************************************************* -->
  <!-- :NOTE: ids are groupName+"_suffix", change them with group name -->
  <!-- element/type -->
  <define id="edit_custom_edit_large"
          value="ui:interface:edit_custom:content:scroll_text:edit_large" />
  <!-- group/ -->
  <define id="edit_custom_edit_box_large"
          value="ui:interface:edit_custom:content:scroll_text:edit_large:eb" />
  <!-- group/edit_box -->
  <define id="edit_custom_edit_short"
          value="ui:interface:edit_custom:content:scroll_text:edit_short" />
  <!-- group/ -->
  <define id="edit_custom_edit_box_short"
          value="ui:interface:edit_custom:content:scroll_text:edit_short:eb" />
  <!-- group/edit_box -->
  <define id="edit_custom_display"
          value="ui:interface:edit_custom:content:scroll_text:display" />
  <!-- view/text -->
  <define id="edit_custom_edit_buttons"
          value="ui:interface:edit_custom:content:buttons_edit" />
  <!-- group/ -->
  <define id="edit_custom_close_button"
          value="ui:interface:edit_custom:content:button_close" />
  <!-- ctrl/button -->
  <define id="edit_custom_background"
          value="ui:interface:edit_custom:content:scroll_text:background" />
  <!-- view/bitmap -->
  <!-- To know if EditCustom phrase is opened or not -->
  <variable entry="UI:VARIABLES:ISACTIVE:PHRASE_EDIT_CUSTOM"
            type="sint32"
            value="0" />
  <proc id="proc_phrase_edit_custom_opened">
    <action handler="set"
            params="dblink=UI:VARIABLES:ISACTIVE:PHRASE_EDIT_CUSTOM|value=1" />
  </proc>
  <proc id="proc_phrase_edit_custom_closed">
    <action handler="set"
            params="dblink=UI:VARIABLES:ISACTIVE:PHRASE_EDIT_CUSTOM|value=0" />
    <action handler="on_close_edit_custom" />
  </proc>
  <group type="container"
         id="edit_custom"
         w="432"
         h="400"
         title="uiItemTextEdition"
         global_color="false"
         line_at_bottom="false"
         movable="true"
         active="false"
         opened="true"
         openable="false"
         resizer="true"
         savable="false"
         header_color="UI:SAVE:WIN:COLORS:INFOS"
         on_active="proc"
         on_active_params="proc_phrase_edit_custom_opened"
         on_deactive="proc"
         on_deactive_params="proc_phrase_edit_custom_closed"
         pop_min_w="432"
         pop_min_h="128"
         pop_max_w="800"
         pop_max_h="600">
    <group id="header_closed"
           x="0"
           y="0"
           child_resize_w="true"
           h="16"
           posref="TL TL" />
    <group id="header_opened"
           x="0"
           y="0"
           child_resize_w="true"
           h="16"
           posref="TL TL" />
    <group id="content"
           x="0"
           y="0"
           sizeref="wh"
           w="0"
           h="0"
           posref="TL TL">
      <group id="crop"
             posref="TR TR"
             x="0"
             y="-8"
             sizeref="wh"
             w="-16"
             h="-32" />
      <!-- THEME -->
      <group id="scroll_text"
             posparent="crop"
             posref="TM TM"
             x="0"
             y="-4"
             sizeref="w"
             child_resize_h="true"
             child_resize_hmargin="4"
             w="-4"
             max_sizeparent="crop"
             max_sizeref="h"
             max_h="-4"
             active="true">
        <view type="bitmap"
              id="background"
              posref="TL TL"
              sizeref="w"
              x="0"
              y="-8"
              txtwidth="300"
              txtheight="360"
              texture=""
              global_color="false"
              render_layer="0" />
        <view type="text"
              id="display"
              posref="TL TL"
              sizeref="w"
              color="255 255 255 160"
              x="2"
              y="-4"
              fontsize="12"
              shadow="true"
              multi_line="true"
              multi_line_space="0" />
        <instance template="edit_box_widget_multiline"
                  max_num_chars="1024"
                  max_num_return="50"
                  id="edit_large"
                  posref="TL TL"
                  x="4"
                  y="-8"
                  sizeref="w"
                  sizeref_eb="w"
                  child_resize_h="true"
                  w="-8"
                  h="-30"
                  text_x="0"
                  text_y="0"
                  text_ref="TL TL"
                  fontsize="12"
                  multi_line="true"
                  enter_loose_focus="true"
                  enter_recover_focus="false"
                  prompt=""
                  reset_focus_on_hide="true"
                  want_return="true"
                  active="false"
                  render_layer="1"
                  scale="false" />
        <instance template="edit_box_widget_multiline"
                  max_num_chars="256"
                  max_num_return="16"
                  id="edit_short"
                  posref="TL TL"
                  x="4"
                  y="-8"
                  sizeref="w"
                  sizeref_eb="w"
                  child_resize_h="true"
                  w="-8"
                  h="-30"
                  text_x="0"
                  text_y="0"
                  text_ref="TL TL"
                  fontsize="12"
                  multi_line="true"
                  enter_loose_focus="true"
                  enter_recover_focus="false"
                  prompt=""
                  reset_focus_on_hide="true"
                  want_return="true"
                  active="false"
                  render_layer="1"
                  scale="false" />
      </group>
      <ctrl style="skin_scroll"
            id="scroll_bar_theme"
            align="T"
            target="scroll_text"
            posparent="crop"
            posref="TL TR"
            x="-8"
            y="0" />
      <view type="bitmap"
            id="sep"
            x="0"
            y="-2"
            posparent="crop"
            posref="BR TR"
            scale="true"
            h="2"
            sizeparent="parent"
            sizeref="w"
            texture="W_line_hor.tga" />
      <instance id="buttons_edit"
                template="button_ok_cancel"
                posref="BR BR"
                x="-4"
                y="2"
                active="false"
                onclick_ok="validate_edit_custom"
                onclick_ok_param="ui:interface:edit_custom"
                onclick_cancel="hide"
                onclick_cancel_param="ui:interface:edit_custom" />
      <ctrl id="button_close"
            style="button_cancel"
            x="-4"
            y="2"
            posref="BR BR"
            text_y="-2"
            onclick_l="hide"
            params_l="ui:interface:edit_custom"
            hardtext="uittClose"
            tooltip="uittClose" />
    </group>
  </group>
  <tree node="edit_custom" />
</interface_config>
