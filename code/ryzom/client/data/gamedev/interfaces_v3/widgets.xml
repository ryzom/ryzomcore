<!-- ****************************************** -->
<!-- *                  WIDGETS               * -->
<!-- ****************************************** -->
<interface_config>
  <root id="interface"
        x="0"
        y="0"
        w="800"
        h="600"
        active="true" />
  <proc id="proc_nothing"></proc>
  <!-- template for border inside of a group -->
  <template name="inner_thin_border_group"
            posparent="parent"
            keep="true"
            inherit_gc_alpha="false"
            posref="BL BL"
            w="0"
            h="0">
    <group id="itb"
           posparent="#posparent"
           sizeref="hw"
           w="#w"
           h="#h"
           posref="#posref">
      <view type="bitmap"
            id="bg"
            texture="W_box_blank.tga"
            scale="true"
            posref="MM MM"
            sizeref="hw"
            w="-8"
            h="-8"
            inherit_gc_alpha="#inherit_gc_alpha" />
      <view type="bitmap"
            id="tlb"
            texture="W_box_top_left.tga"
            posref="TL TL"
            inherit_gc_alpha="#inherit_gc_alpha" />
      <view type="bitmap"
            id="trb"
            texture="W_box_top_right.tga"
            posref="TR TR"
            inherit_gc_alpha="#inherit_gc_alpha" />
      <view type="bitmap"
            id="brb"
            texture="W_box_bot_right.tga"
            posref="BR BR"
            inherit_gc_alpha="#inherit_gc_alpha" />
      <view type="bitmap"
            id="blb"
            texture="W_box_bot_left.tga"
            posref="BL BL"
            inherit_gc_alpha="#inherit_gc_alpha" />
      <view type="bitmap"
            id="tb"
            texture="W_box_top.tga"
            posref="TM TM"
            scale="true"
            sizeref="w"
            w="-8"
            h="4"
            inherit_gc_alpha="#inherit_gc_alpha" />
      <view type="bitmap"
            id="bb"
            texture="W_box_bot.tga"
            posref="BM BM"
            scale="true"
            sizeref="w"
            w="-8"
            h="4"
            inherit_gc_alpha="#inherit_gc_alpha" />
      <view type="bitmap"
            id="lb"
            texture="W_box_left.tga"
            posref="ML ML"
            scale="true"
            sizeref="h"
            h="-8"
            w="4"
            inherit_gc_alpha="#inherit_gc_alpha" />
      <view type="bitmap"
            id="rb"
            texture="W_box_right.tga"
            posref="MR MR"
            scale="true"
            sizeref="h"
            h="-8"
            w="4"
            inherit_gc_alpha="#inherit_gc_alpha" />
    </group>
  </template>
  <!-- *********************************** -->
  <!-- *  TEMPLATE FOR SCENE INFORMATION * -->
  <!-- *********************************** -->
  <!-- * In scene user info with guild logo * -->
  <define id="in_scene_user_info_bar_h"
          value="4" />
  <define id="in_scene_user_info_bar_space"
          value="2" />
  <define id="in_scene_user_bar_length"
          value="120" />
  <!-- * In scene Target Selected * -->
  <template name="string_cursor"
            id=""
            keep="true">
    <group id="#id"
           posref="BL TL"
           x="0"
           y="0"
           child_resize_w="true"
           h="32"
           active="true">
      <!-- TEXT -->
      <view type="text"
            id="fake_txt"
            posref="TL TL"
            x="22"
            fontsize="12"
            shadow="true"
            hardtext="uimGcmTradePact"
            color="255 255 255 0" />
      <!-- BMP -->
      <view type="bitmap"
            id="curs_L"
            posref="TL TL"
            texture="curs_L.tga"
            global_color="false" />
      <view type="bitmap"
            id="curs_R"
            posref="TR TL"
            posparent="fake_txt"
            x="-10"
            texture="curs_R.tga"
            global_color="false" />
      <view type="bitmap"
            id="curs_M"
            posref="TM TM"
            posparent="fake_txt"
            sizeref="w"
            w="-20"
            scale="true"
            h="32"
            texture="curs_M.tga"
            global_color="false" />
      <view type="text"
            id="real_txt"
            posref="ML ML"
            x="26"
            y="-2"
            fontsize="12"
            shadow="true"
            hardtext="uimGcmTradePact"
            color="255 255 255 255"
            global_color="false" />
    </group>
  </template>
  <!-- hardware version of the text cursor : mouse cursor is not duplicated on the left of the text -->
  <template name="string_cursor_hardware"
            id=""
            keep="true">
    <group id="#id"
           posref="BL TL"
           x="0"
           y="0"
           child_resize_w="true"
           h="32"
           active="true">
      <!-- TEXT -->
      <view type="text"
            id="fake_txt"
            posref="TL TL"
            x="22"
            fontsize="12"
            shadow="true"
            hardtext="uimGcmTradePact"
            color="255 255 255 0" />
      <!-- BMP -->
      <view type="bitmap"
            id="curs_L"
            posref="TL TL"
            texture="curs_L_no_mouse.tga"
            global_color="false" />
      <view type="bitmap"
            id="curs_R"
            posref="TR TL"
            posparent="fake_txt"
            x="-10"
            texture="curs_R.tga"
            global_color="false" />
      <view type="bitmap"
            id="curs_M"
            posref="TM TM"
            posparent="fake_txt"
            sizeref="w"
            w="-20"
            scale="true"
            h="32"
            texture="curs_M.tga"
            global_color="false" />
      <view type="text"
            id="real_txt"
            posref="ML ML"
            x="26"
            y="-2"
            fontsize="12"
            shadow="true"
            hardtext="uimGcmTradePact"
            color="255 255 255 255"
            global_color="false" />
    </group>
  </template>
  <template name="in_scene_user_info"
            id=""
            keep="true">
    <group id="#id"
           type="in_scene_user_info"
           header_active="false"
           options="no_bordure"
           openable="false"
           savable="false"
           resizer="true"
           movable="false"
           right_button="false"
           opened="true"
           child_resize_w="true"
		   child_resize_h="true"
           w="0"
		   h="0"
           win_priority="%win_priority_world_space"
           posref="BL BM"
           use_cursor="false">
 
      <group id="right"
             child_resize_w="true"
			 child_resize_h="true"
             w="0"
			 x="38"
			 h="158"
             posref="TL TL" >
        <view type="text"
              id="info0"
              posref="TL TL"
              x="0"
              y="-7"
              fontsize="14"
              shadow="true"
              hardtext=""
              color="255 255 255 255"
              global_color="true" />
        <view type="text"
              id="info1"
              posref="BL TL"
			  posparent="info0"
              x="0"
              fontsize="12"
              shadow="true"
              hardtext=""
              color="255 255 255 255"
              global_color="true" />
        <view type="text"
              id="info2"
              posref="BL TL"
			  posparent="info1"
              x="0"
              fontsize="10"
              shadow="true"
              hardtext=""
              color="255 255 255 255"
              global_color="true" />
        <view type="bitmap"
              id="permanent_content"
              posref="TR TL"
              posparent="info0"
              y="0"
              x="4"
              texture=""
              global_color="false" />
        <view type="bitmap"
              id="target"
              posref="TR TL"
              posparent="info0"
              x="4"
              texture="target.tga"
              global_color="false" />
      <view type="bitmap"
            id="invisible_logo"
            posref="TR TL"
            posparent="target"
            x="2"
			y="3"
            scale="true"
            w="20"
            h="20"
            texture="ico_fear.tga"
            active="false"
            global_color="false" />
        <view type="bitmap"
              id="mission_target"
              posref="TR TL"
              posparent="invisible_logo"
              x="2"
              y="4"
              texture="target_mission.tga"
              global_color="false" />
       <view type="bitmap"
            id="rp_logo_1"
            posref="TR TL"
            x="2"
            y="0"
            slot="false"
            posparent="mission_target"
            color="255 255 255 255"
            render_layer="1"
            texture=""
            global_color="false" />
      <view type="bitmap"
            id="rp_logo_2"
            posref="TR TL"
            x="2"
            y="0"
            slot="false"
            posparent="rp_logo_1"
            color="255 255 255 255"
            render_layer="1"
            texture=""
            global_color="false" />
      <view type="bitmap"
            id="rp_logo_3"
            posref="TR TL"
            x="2"
            y="0"
            slot="false"
            posparent="rp_logo_2"
            color="255 255 255 255"
            render_layer="1"
            texture=""
            global_color="false" />
      <view type="bitmap"
            id="rp_logo_4"
            posref="TR TL"
            x="2"
            y="0"
            slot="false"
            posparent="rp_logo_3"
            color="255 255 255 255"
            render_layer="1"
            texture=""
            global_color="false" />
			
        <view type="bitmap"
              id="win_top"
			  posparent="info2"
              posref="BL TL"
			  y="-8"
              texture="Infos_top.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_mid"
              posparent="win_top"
              posref="BL TL"
              scale="true"
              w="70"
              h="1"
              texture="Infos_mid.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_bot"
              posparent="win_mid"
              posref="BL TL"
              texture="Infos_bot.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_jauge_mid"
              posparent="win_bot"
              posref="TL ML"
              x="0"
              y="-2"
              scale="true"
              w="128"
              h="24"
              texture="Bg_jauge_mid.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_jauge_top"
              posparent="win_jauge_mid"
              posref="TL BL"
              texture="Bg_jauge_top.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_jauge_bot"
              posparent="win_jauge_mid"
              posref="BL TL"
              texture="Bg_jauge_bot.tga"
              global_color="true" />

      <view type="bitmap"
              id="bar0"
              posparent="win_jauge_top"
              posref="TL TL"
              x="3"
              y="-3"
              scale="true"
              w="64"
              h="4"
              texture="Jauge_fill.tga"
              color="128 128 128 255"
              global_color="false" />
        <view type="bitmap"
              id="bar1"
              posparent="bar0"
              posref="BL TL"
              x="0"
              y="-2"
              scale="true"
              w="120"
              h="4"
              texture="Jauge_fill.tga"
              color="128 128 128 255"
              global_color="false" />
        <view type="bitmap"
              id="bar2"
              posparent="bar1"
              posref="BL TL"
              x="0"
              y="-2"
              scale="true"
              w="112"
              h="4"
              texture="Jauge_fill.tga"
              color="128 128 128 255"
              global_color="false" />
        <view type="bitmap"
              id="bar3"
              posparent="bar2"
              posref="BL TL"
              x="0"
              y="-2"
              scale="true"
              w="30"
              h="4"
              texture="Jauge_fill.tga"
              color="128 128 128 255"
              global_color="false" />
        <view type="bitmap"
              id="bar4"
              posparent="bar3"
              posref="BL TL"
              x="0"
              y="-2"
              scale="true"
              w="0"
              h="4"
              texture="Jauge_fill.tga"
              color="128 128 128 255"
              global_color="false" />
      </group>
      
	  <ctrl type="sheet"
            id="guild_logo"
            posref="TL TR"
			posparent="right"
			x="-4"
            slot="false"
            nature="guild_flag"
            value="UI:TEMP:GUILD_SHEET"
            dragable="false"
            color="255 255 255 255" />
	  <view type="bitmap"
            id="npc_mission_logo"
            posref="TL TL"
            slot="false"
            x="0"
            color="255 255 255 255"
            render_layer="1"
            texture=""
            global_color="false" />
      <view type="bitmap"
            id="npc_mission_logo_over"
            posref="TL TL"
            slot="false"
            x="0"
            color="255 255 255 255"
            render_layer="2"
            texture=""
            global_color="false" />
   
        <group id="right_pvp"
               posref="TR TL"
               posparent="right"
               child_resize_w="true"
               child_resize_h="true" >
          <group id="top_pvp"
                 posref="TL TL"
				 w="0"
                 h="0"
                 child_resize_w="true"
                 child_resize_h="true" >
            <view type="bitmap"
                  id="pvp_faction_logo"
                  posref="TL TL"
                  active="false"
                  texture="mp_pearl.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="pvp_safe_logo"
                  posref="TR TL"
                  active="false"
                  posparent="pvp_faction_logo"
                  texture="mp_pearl.tga"
                  x="2"
                  global_color="false" />
          </group>
          <group id="bottom_pvp"
                 posref="BL TL"
                 posparent="top_pvp"
                 child_resize_w="true"
                 child_resize_h="true" >
            <view type="bitmap"
                  id="pvp_outpost_logo"
                  posref="TL TL"
				  active="false"
                  texture="building_state_24x24.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="pvp_duel_logo"
                  posref="TR TL"
                  posparent="pvp_outpost_logo"
                  active="false"
                  x="2"
                  texture="pvp_duel.tga"
                  global_color="false" />
          </group>
        </group>

    </group>
  </template>
  <!-- prototype for fast cloning -->
  <instance template="in_scene_user_info"
            id="in_scene_user_info_proto" />
  <template name="in_scene_user_info_back"
            id=""
            keep="true">
    <group id="#id"
           type="in_scene_user_info"
           header_active="false"
           options="no_bordure"
           openable="false"
           savable="false"
           resizer="true"
           movable="false"
           right_button="false"
           opened="true"
           child_resize_w="true"
           child_resize_h="true"
           child_resize_hmargin="20"
           w="0"
           h="86"
           win_priority="%win_priority_world_space"
           posref="BL BM"
           use_cursor="false">
      <group id="right"
             x="42"
             y="-20"
             child_resize_w="true"
             w="0"
             h="86"
             posref="TL TL">
        <view type="bitmap"
              id="win_top"
              posref="TL TL"
              y="-10"
              texture="Infos_top.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_mid"
              posref="BL TL"
              posparent="win_top"
              scale="true"
              w="7"
              h="50"
              texture="Infos_mid.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_bot"
              posref="BL TL"
              posparent="win_mid"
              texture="Infos_bot.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_jauge_mid"
              posref="BR ML"
              x="-1"
              y="1"
              posparent="win_bot"
              scale="true"
              w="128"
              h="24"
              texture="Bg_jauge_mid.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_jauge_top"
              posref="TL BL"
              posparent="win_jauge_mid"
              texture="Bg_jauge_top.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_jauge_bot"
              posref="BL TL"
              posparent="win_jauge_mid"
              texture="Bg_jauge_bot.tga"
              global_color="true" />
        <view type="text"
              id="info0"
              posref="TL TL"
              x="8"
              y="-3"
              fontsize="14"
              shadow="true"
              hardtext=""
              color="255 255 255 255"
              global_color="true" />
        <view type="text"
              id="info1"
              posref="TL TL"
              x="8"
              y="-17"
              fontsize="12"
              shadow="true"
              hardtext=""
              color="255 255 255 255"
              global_color="true" />
        <view type="text"
              id="info2"
              posref="TL TL"
              x="8"
              y="-32"
              fontsize="10"
              shadow="true"
              hardtext=""
              color="255 255 255 255"
              global_color="true" />
        <view type="bitmap"
              id="target"
              posref="TR TL"
              posparent="info0"
              x="4"
              y=""
              texture="target.tga"
              global_color="false" />
        <view type="bitmap"
              id="mission_target"
              posref="TR TL"
              posparent="info0"
              x="25"
              y=""
              texture="target_mission.tga"
              global_color="false" />
        <view type="bitmap"
              id="bar0"
              posref="TL TL"
              posparent="win_jauge_top"
              x="3"
              y="-2"
              scale="true"
              w="64"
              h="4"
              texture="Jauge_fill.tga"
              color="128 128 128 255"
              global_color="false" />
        <view type="bitmap"
              id="bar1"
              posref="BL TL"
              posparent="bar0"
              x="0"
              y="-2"
              scale="true"
              w="120"
              h="4"
              texture="Jauge_fill.tga"
              color="128 128 128 255"
              global_color="false" />
        <view type="bitmap"
              id="bar2"
              posref="BL TL"
              posparent="bar1"
              x="0"
              y="-2"
              scale="true"
              w="112"
              h="4"
              texture="Jauge_fill.tga"
              color="128 128 128 255"
              global_color="false" />
        <view type="bitmap"
              id="bar3"
              posref="BL TL"
              posparent="bar2"
              x="0"
              y="-2"
              scale="true"
              w="30"
              h="4"
              texture="Jauge_fill.tga"
              color="128 128 128 255"
              global_color="false" />
        <view type="bitmap"
              id="bar4"
              posref="BL TL"
              posparent="bar3"
              x="0"
              y="-2"
              scale="true"
              w="0"
              h="4"
              texture="Jauge_fill.tga"
              color="128 128 128 255"
              global_color="false" />
      </group>
      <ctrl type="sheet"
            id="guild_logo"
            posref="ML MR"
            x="-8"
            slot="false"
            posparent="right"
            nature="guild_flag"
            value="UI:TEMP:GUILD_SHEET"
            dragable="false"
            color="255 255 255 255" />
    </group>
  </template>
  <instance template="in_scene_user_info_back"
            id="in_scene_user_info_back_proto" />
  <template name="forage_source"
            id=""
            keep="true">
    <group id="#id"
           type="in_scene_user_info"
           header_active="false"
           options="no_bordure"
           openable="false"
           savable="false"
           resizer="true"
           movable="false"
           right_button="false"
           opened="true"
           child_resize_w="true"
           child_resize_h="true"
   
           win_priority="%win_priority_world_space"
           posref="BL BM"
           use_cursor="true">
      <!--<group id="right" x="240" y="320" child_resize_w="true" w="0" h="126"  posref="TL TL" >-->
      <group id="right"
             child_resize_w="true"
             w="0"
             h="158"
             x="42"
             y="-20"
             posref="TL TL" >
        <view type="text"
              id="info0"
              posref="TL TL"
              x="0"
              y="0"
              fontsize="14"
              shadow="true"
              hardtext="Forage_Source"
              color="255 255 255 255"
              global_color="true" />
        <view type="bitmap"
              id="win_jauge_mid"
              posref="BL TL"
			  posparent="info0"
              x="0"
              y="-6"
              scale="true"
              w="152"
              h="100"
              texture="Bg_source_mid.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_jauge_top"
              posref="TL BL"
              posparent="win_jauge_mid"
              texture="Bg_source_top.tga"
              global_color="true" />
        <view type="bitmap"
              id="win_jauge_bot"
              posref="BL TL"
              posparent="win_jauge_mid"
              texture="Bg_source_bot.tga"
              global_color="true" />
        <view type="bitmap"
              id="bar0"
              posref="TL TL"
              posparent="win_jauge_top"
              x="27"
              y="-14"
              scale="true"
              w="64"
              h="4"
              texture="Jauge_fill.tga"
              color="255 255 255 255"
              global_color="false" />
        <view type="bitmap"
              id="bar1"
              posref="BL TL"
              posparent="bar0"
              x="0"
              y="-16"
              scale="true"
              w="112"
              h="4"
              texture="Jauge_fill.tga"
              color="0 180 255 255"
              global_color="false" />
        <view type="bitmap"
              id="bar2"
              posref="BL TL"
              posparent="bar1"
              x="0"
              y="-16"
              scale="true"
              w="120"
              h="4"
              texture="Jauge_fill.tga"
              color="255 127 127 255"
              global_color="false" />
        <view type="bitmap"
              id="bar3"
              posref="BL TL"
              posparent="bar2"
              x="0"
              y="-16"
              scale="true"
              w="30"
              h="4"
              texture="Jauge_fill.tga"
              color="255 175 0 255"
              global_color="false" />
        <view type="bitmap"
              id="bar4"
              posref="BL TL"
              posparent="bar3"
              x="0"
              y="-16"
              scale="true"
              w="98"
              h="4"
              texture="Jauge_fill.tga"
              color="255 125 0 255"
              global_color="false" />
        <view type="bitmap"
              id="icon0"
              posref="ML MR"
              posparent="bar0"
              x="0"
              y="0"
              texture="forage_time.tga"
              global_color="false" />
        <view type="bitmap"
              id="icon1"
              posref="ML MR"
              posparent="bar1"
              x="0"
              y="-2"
              texture="forage_content.tga"
              global_color="false" />
        <view type="bitmap"
              id="icon2"
              posref="ML MR"
              posparent="bar2"
              x="0"
              y="-1"
              texture="forage_life.tga"
              global_color="false" />
        <view type="bitmap"
              id="icon3"
              posref="ML MR"
              posparent="bar3"
              x="0"
              y="0"
              texture="forage_danger.tga"
              global_color="false" />
        <view type="bitmap"
              id="icon4"
              posref="ML MR"
              posparent="bar4"
              x="0"
              y="0"
              texture="forage_spawn.tga"
              global_color="false" />
        <!-- Some ToolTip Info -->
        <ctrl type="tooltip"
              id="tt0"
              posparent="icon0"
              posref="TL TL"
              sizeref="wh"
              w="0"
              h="0"
              tooltip="uittForageTime" />
        <ctrl type="tooltip"
              id="tt1"
              posparent="icon1"
              posref="TL TL"
              sizeref="wh"
              w="0"
              h="0"
              tooltip="uittForageContent" />
        <ctrl type="tooltip"
              id="tt2"
              posparent="icon2"
              posref="TL TL"
              sizeref="wh"
              w="0"
              h="0"
              tooltip="uittForageLife" />
        <ctrl type="tooltip"
              id="tt3"
              posparent="icon3"
              posref="TL TL"
              sizeref="wh"
              w="0"
              h="0"
              tooltip="uittForageDanger" />
        <ctrl type="tooltip"
              id="tt4"
              posparent="icon4"
              posref="TL TL"
              sizeref="wh"
              w="0"
              h="0"
              tooltip="uittForageKami" />
        <ctrl type="tooltip"
              id="ttb0"
              posparent="bar0"
              posref="ML ML"
              sizeref="w"
              w="0"
              h="24"
              tooltip="uittForageTime" />
        <ctrl type="tooltip"
              id="ttb1"
              posparent="bar1"
              posref="ML ML"
              sizeref="w"
              w="0"
              h="24"
              tooltip="uittForageContent" />
        <ctrl type="tooltip"
              id="ttb2"
              posparent="bar2"
              posref="ML ML"
              sizeref="w"
              w="0"
              h="24"
              tooltip="uittForageLife" />
        <ctrl type="tooltip"
              id="ttb3"
              posparent="bar3"
              posref="ML ML"
              sizeref="w"
              w="0"
              h="24"
              tooltip="uittForageDanger" />
        <ctrl type="tooltip"
              id="ttb4"
              posparent="bar4"
              posref="ML ML"
              sizeref="w"
              w="0"
              h="24"
              tooltip="uittForageKami" />
      </group>
      <view type="bitmap"
            id="guild_logo"
            posref="TL TR"
            x="-2"
            y="16"
            slot="false"
            posparent="right"
            color="255 255 255 255"
            texture=""
            global_color="false" />
    </group>
  </template>
  <instance template="forage_source"
            id="forage_source_proto" />
  <!-- flying text in scene (deltax is the delta xcoord to apply right for the user, and left for the ennemy) -->
  <define id="in_scene_flying_char_offsetx"
          value="30" />
  <template name="in_scene_flying_text"
            id=""
            keep="true">
    <group id="#id"
           type="in_scene_user_info"
           header_active="false"
           options="no_bordure"
           openable="false"
           savable="false"
           resizer="false"
           movable="false"
           right_button="false"
           opened="true"
           child_resize_w="true"
           child_resize_h="true"
           w="0"
           h="0"
           win_priority="%win_priority_world_space"
           posref="BL BM"
           use_cursor="false"
           user_scale="true"
           in_scene_offset_y="20">
      <view type="text"
            id="text"
            posref="TL TL"
            x="0"
            y="0"
            fontsize="18"
            shadow="true"
            hardtext=""
            color="255 255 255 255"
            global_color="false" />
    </group>
  </template>
  <!-- *  Bulle de dialogue a droite du perso * -->
  <!-- NOT USED FOR THE MOMENT !!!
<template name="3dbulle_R" id="" >
        <group id="#id" type="container" header_active="false" options="no_bordure" openable="false" savable="false" resizer="true" movable="false" right_button="false" opened="true" child_resize_w="true" w="0" max_w="256" min_w="48" h="48" >
        
                <group id="header_opened" x="0" y="0" child_resize_w="true" w="0" child_resize_h="true" h="0" max_w="256" min_w="48" max_h="256" min_h="48" posref="TL TL" >
                                                                
                        <group id="window" x="0" y="0" child_resize_w="true" w="0" child_resize_h="true" h="0" posref="TL TL" >
                                <view type="bitmap" id="win_M" posref="MM MM" scale="true" sizeref="wh" w="-10" h="-10" texture="Bulle_M.tga" global_color="false"/>
                                <view type="bitmap" id="win_T" posparent="win_M" posref="TL BL" scale="true" sizeref="w" w="0" h="5" texture="Bulle_T.tga" global_color="false"/>
                                <view type="bitmap" id="win_B" posparent="win_M" posref="BL TL" scale="true" sizeref="w" w="0" h="5" texture="Bulle_B.tga" global_color="false"/>
                                <view type="bitmap" id="win_L" posparent="win_M" posref="TL TR" scale="true" sizeref="h" w="5" h="0" texture="Bulle_L.tga" global_color="false"/>
                                <view type="bitmap" id="win_R" posparent="win_M" posref="TR TL" scale="true" sizeref="h" w="5" h="0" texture="Bulle_R.tga" global_color="false"/>
                                <view type="bitmap" id="win_TL" posref="TL TL" texture="Bulle_TL.tga" global_color="false"/>
                                <view type="bitmap" id="win_TR" posref="TR TR" texture="Bulle_TR.tga" global_color="false"/>
                                <view type="bitmap" id="win_BL" posref="BL BL" texture="Bulle_BL.tga" global_color="false"/>
                                <view type="bitmap" id="win_BR" posref="BR BR" texture="Bulle_BR.tga" global_color="false"/>
                                
                                <view type="text" id="text" posref="TL TL" x="5" y="-5" hardtext="#hardtext" 
                                        fontsize="12" justification="justified" color="0 0 0 255" global_color="false" 
                                        multi_line="true" multi_line_space="0" line_maxw="160" multi_line_maxw_only="true" />
                                <! - Yoyo: Fake to have minimum bubble size - >
                                <group id="min_w" posparent="text" posref="TL TL" x="0" y="0" w="48" h="14" />
                                
                        </group>
                        
                        <view type="bitmap" id="win_talk" posref="BL TL" x="24" y="2" posparent="window" texture="Bulle_Say_R.tga" global_color="false"/>
                
                </group>
                
        </group>
</template>
-->
  <!-- *  Bulle de dialogue a gauche du perso * -->
  <template name="3dbulle_L"
            id=""
            hardtext="uiTestDialogue"
            keep="true">
    <group id="#id"
           type="in_scene_bubble"
           header_active="false"
           options="no_bordure"
           openable="false"
           savable="false"
           resizer="true"
           movable="false"
           right_button="false"
           opened="true"
           child_resize_w="true"
           w="0"
           max_w="512"
           min_w="48"
           child_resize_h="true"
           in_scene_offset_x="-95"
           win_priority="%win_priority_world_space"
           posref="BL BR"
           use_cursor="true">
      <group id="header_opened"
             x="0"
             y="0"
             child_resize_w="true"
             w="0"
             child_resize_h="true"
             h="0"
             max_w="512"
             min_w="48"
             max_h="256"
             min_h="48"
             posref="TL TL">
        <group id="window"
               x="0"
               y="0"
               child_resize_w="true"
               child_resize_wmargin="10"
               child_resize_h="true"
               child_resize_hmargin="10"
               posref="TL TL">
          <group id="back"
                 x="0"
                 y="0"
                 w="0"
                 h="0"
                 sizeref="wh"
                 posref="TL TL">
            <view type="bitmap"
                  id="win_M"
                  posref="MM MM"
                  scale="true"
                  sizeref="wh"
                  w="-10"
                  h="-10"
                  texture="Bulle_M.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_T"
                  posparent="win_M"
                  posref="TL BL"
                  scale="true"
                  sizeref="w"
                  w="0"
                  h="5"
                  texture="Bulle_T.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_B"
                  posparent="win_M"
                  posref="BL TL"
                  scale="true"
                  sizeref="w"
                  w="0"
                  h="5"
                  texture="Bulle_B.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_L"
                  posparent="win_M"
                  posref="TL TR"
                  scale="true"
                  sizeref="h"
                  w="5"
                  h="0"
                  texture="Bulle_L.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_R"
                  posparent="win_M"
                  posref="TR TL"
                  scale="true"
                  sizeref="h"
                  w="5"
                  h="0"
                  texture="Bulle_R.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_TL"
                  posref="TL TL"
                  texture="Bulle_TL.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_TR"
                  posref="TR TR"
                  texture="Bulle_TR.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_BL"
                  posref="BL BL"
                  texture="Bulle_BL.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_BR"
                  posref="BR BR"
                  texture="Bulle_BR.tga"
                  global_color="false" />
          </group>
          <view type="text"
                id="text"
                posref="TL TL"
                x="5"
                y="-24"
                hardtext="#hardtext"
                fontsize="12"
                justification="dont_clip_word"
                color="0 0 0 255"
                global_color="false"
                multi_line="true"
                multi_line_space="0"
                line_maxw="320"
                multi_line_maxw_only="true" />
          <ctrl type="button"
                button_type="push_button"
                tx_normal="Bulle_next.tga"
                tx_pushed="Bulle_next.tga"
                tx_over="Bulle_next.tga"
                color="255 255 255 255"
                col_over="255 255 255 0"
                col_pushed="255 255 255 255"
                global_color_normal="false"
                global_color_over="false"
                global_color_pushed="false"
                tooltip="uiNext"
                id="but_next"
                posref="TR TR"
                x="-5"
                y="-5"
                onclick_l="bubble_next"
                active="false" />
          <ctrl type="button"
                button_type="push_button"
                tx_normal="Bulle_quit.tga"
                tx_pushed="Bulle_quit.tga"
                tx_over="Bulle_quit.tga"
                color="255 255 255 255"
                col_over="255 255 255 0"
                col_pushed="255 255 255 255"
                global_color_normal="false"
                global_color_over="false"
                global_color_pushed="false"
                tooltip="uiSkip"
                id="but_skip"
                posref="TL TR"
                posparent="but_next"
                x="-4"
                y="0"
                onclick_l="bubble_skip"
                active="false" />
          <!-- Yoyo: Fake to have minimum bubble size -->
          <group id="min_w"
                 posparent="text"
                 posref="TL TL"
                 x="0"
                 y="0"
                 w="48"
                 h="14" />
        </group>
        <view type="bitmap"
              id="win_talk"
              posref="BR TR"
              x="-24"
              y="2"
              posparent="window"
              texture="Bulle_Say_L.tga"
              global_color="false" />
      </group>
    </group>
  </template>
  <!-- *  Bulle de dialogue dynamique a gauche du perso 
                textid of the views are updated by code * -->
  <style style="dynchat_desc"
         type="text"
         fontsize="12"
         justification="dont_clip_word"
         color="0 0 0 255"
         global_color="false"
         multi_line="true"
         multi_line_space="0"
         line_maxw="320"
         multi_line_maxw_only="true" />
  <style style="dynchat_option"
         type="text_id"
         dynamic_string="true"
         format_taged="true"
         fontsize="10"
         justification="dont_clip_word"
         color="0 0 64 255"
         underlined="true"
         global_color="false"
         multi_line="true"
         multi_line_space="0"
         line_maxw="320"
         multi_line_maxw_only="true" />
  <style style="dynchat_option_but"
         type="button_link"
         posref="TL TL"
         x="0"
         y="0"
         sizeref="wh"
         w="0"
         h="0"
         onclick_l="dynchat_click_option" />
  <template name="dyn_3dbulle_L"
            id=""
            keep="true">
    <group id="#id"
           type="in_scene_bubble"
           header_active="false"
           options="no_bordure"
           openable="false"
           savable="false"
           resizer="true"
           movable="false"
           right_button="false"
           opened="true"
           child_resize_w="true"
           w="0"
           max_w="512"
           min_w="48"
           child_resize_h="true"
           in_scene_offset_x="-95"
           win_priority="%win_priority_world_space"
           posref="BL BR"
           use_cursor="true">
      <group id="header_opened"
             x="0"
             y="0"
             child_resize_w="true"
             w="0"
             child_resize_h="true"
             h="0"
             max_w="512"
             min_w="48"
             max_h="256"
             min_h="48"
             posref="TL TL">
        <group id="window"
               x="0"
               y="0"
               child_resize_w="true"
               child_resize_wmargin="10"
               child_resize_h="true"
               child_resize_hmargin="10"
               posref="TL TL">
          <group id="back"
                 x="0"
                 y="0"
                 w="0"
                 h="0"
                 sizeref="wh"
                 posref="TL TL">
            <view type="bitmap"
                  id="win_M"
                  posref="MM MM"
                  scale="true"
                  sizeref="wh"
                  w="-10"
                  h="-10"
                  texture="Bulle_M.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_T"
                  posparent="win_M"
                  posref="TL BL"
                  scale="true"
                  sizeref="w"
                  w="0"
                  h="5"
                  texture="Bulle_T.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_B"
                  posparent="win_M"
                  posref="BL TL"
                  scale="true"
                  sizeref="w"
                  w="0"
                  h="5"
                  texture="Bulle_B.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_L"
                  posparent="win_M"
                  posref="TL TR"
                  scale="true"
                  sizeref="h"
                  w="5"
                  h="0"
                  texture="Bulle_L.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_R"
                  posparent="win_M"
                  posref="TR TL"
                  scale="true"
                  sizeref="h"
                  w="5"
                  h="0"
                  texture="Bulle_R.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_TL"
                  posref="TL TL"
                  texture="Bulle_TL.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_TR"
                  posref="TR TR"
                  texture="Bulle_TR.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_BL"
                  posref="BL BL"
                  texture="Bulle_BL.tga"
                  global_color="false" />
            <view type="bitmap"
                  id="win_BR"
                  posref="BR BR"
                  texture="Bulle_BR.tga"
                  global_color="false" />
          </group>
          <view style="dynchat_desc"
                id="text"
                posref="TL TL"
                x="5"
                y="-24" />
          <ctrl type="button"
                button_type="push_button"
                tx_normal="Bulle_next.tga"
                tx_pushed="Bulle_next.tga"
                tx_over="Bulle_next.tga"
                color="255 255 255 255"
                col_over="255 255 255 0"
                col_pushed="255 255 255 255"
                global_color_normal="false"
                global_color_over="false"
                global_color_pushed="false"
                tooltip="uiNext"
                id="but_next"
                posref="TR TR"
                x="-5"
                y="-5"
                onclick_l="bubble_next"
                active="false" />
          <ctrl type="button"
                button_type="push_button"
                tx_normal="Bulle_quit.tga"
                tx_pushed="Bulle_quit.tga"
                tx_over="Bulle_quit.tga"
                color="255 255 255 255"
                col_over="255 255 255 0"
                col_pushed="255 255 255 255"
                global_color_normal="false"
                global_color_over="false"
                global_color_pushed="false"
                tooltip="uiSkip"
                id="but_skip"
                posref="TL TR"
                posparent="but_next"
                x="-4"
                y="0"
                onclick_l="bubble_skip"
                active="false" />
          <!-- Yoyo: Fake to have minimum bubble size -->
          <group id="min_w"
                 posparent="text"
                 posref="TL TL"
                 x="0"
                 y="0"
                 w="48"
                 h="14" />
          <view style="dynchat_option"
                id="opt0"
                posparent="text"
                posref="BL TL"
                x="16"
                y="-4" />
          <view style="dynchat_option"
                id="opt1"
                posparent="opt0"
                posref="BL TL"
                x="0"
                y="-4" />
          <view style="dynchat_option"
                id="opt2"
                posparent="opt1"
                posref="BL TL"
                x="0"
                y="-5" />
          <view style="dynchat_option"
                id="opt3"
                posparent="opt2"
                posref="BL TL"
                x="0"
                y="-5" />
          <view style="dynchat_option"
                id="opt4"
                posparent="opt3"
                posref="BL TL"
                x="0"
                y="-5" />
          <view style="dynchat_option"
                id="opt5"
                posparent="opt4"
                posref="BL TL"
                x="0"
                y="-5" />
          <view style="dynchat_option"
                id="opt6"
                posparent="opt5"
                posref="BL TL"
                x="0"
                y="-5" />
          <view style="dynchat_option"
                id="opt7"
                posparent="opt6"
                posref="BL TL"
                x="0"
                y="-5" />
          <ctrl style="dynchat_option_but"
                id="optb0"
                posparent="opt0"
                params_l="0" />
          <ctrl style="dynchat_option_but"
                id="optb1"
                posparent="opt1"
                params_l="1" />
          <ctrl style="dynchat_option_but"
                id="optb2"
                posparent="opt2"
                params_l="2" />
          <ctrl style="dynchat_option_but"
                id="optb3"
                posparent="opt3"
                params_l="3" />
          <ctrl style="dynchat_option_but"
                id="optb4"
                posparent="opt4"
                params_l="4" />
          <ctrl style="dynchat_option_but"
                id="optb5"
                posparent="opt5"
                params_l="5" />
          <ctrl style="dynchat_option_but"
                id="optb6"
                posparent="opt6"
                params_l="6" />
          <ctrl style="dynchat_option_but"
                id="optb7"
                posparent="opt7"
                params_l="7" />
        </group>
        <view type="bitmap"
              id="win_talk"
              posref="BR TR"
              x="-24"
              y="2"
              posparent="window"
              texture="Bulle_Say_L.tga"
              global_color="false" />
      </group>
    </group>
  </template>
  <!-- *  Bulle d'IA a droite * -->
  <template name="3dIA_R"
            id="">
    <group id="#id"
           type="container"
           header_active="false"
           options="no_bordure"
           openable="false"
           savable="false"
           resizer="true"
           movable="false"
           right_button="false"
           opened="true"
           w="66"
           h="72">
      <group id="header_opened"
             x="0"
             y="0"
             w="66"
             h="72"
             posref="TL TL">
        <view type="bitmap"
              id="win_ia"
              posref="TL TL"
              texture="Bulle_IA.tga"
              global_color="false" />
        <view type="bitmap"
              id="win_think"
              posref="BL BL"
              x="2"
              y="0"
              texture="Bulle_Think_R.tga"
              global_color="false" />
        <view type="bitmap"
              id="ia"
              posparent="win_ia"
              posref="MM MM"
              texture="IA_Surpris.tga"
              global_color="false" />
      </group>
    </group>
  </template>
  <!-- *  Bulle d'IA a gauche * -->
  <template name="3dIA_L"
            id="">
    <group id="#id"
           type="container"
           header_active="false"
           options="no_bordure"
           openable="false"
           savable="false"
           resizer="true"
           movable="false"
           right_button="false"
           opened="true"
           w="66"
           h="72">
      <group id="header_opened"
             x="0"
             y="0"
             w="66"
             h="72"
             posref="TL TL">
        <view type="bitmap"
              id="win_ia"
              posref="TL TL"
              texture="Bulle_IA.tga"
              global_color="false" />
        <view type="bitmap"
              id="win_think"
              posref="BR BR"
              x="-2"
              y="0"
              texture="Bulle_Think_L.tga"
              global_color="false" />
        <view type="bitmap"
              id="ia"
              posparent="win_ia"
              posref="MM MM"
              texture="IA_Surpris.tga"
              global_color="false" />
      </group>
    </group>
  </template>
  <!-- ********************************* -->
  <!-- *  TEMPLATE FOR MENU SEPARATORS * -->
  <!-- ********************************* -->
  <template name="menu_separator"
            keep="true">
    <group id="sep_gr"
           posref="BL BL"
           sizeref="w"
           w="0"
           h="4">
      <!-- width is setupped by the menu -->
      <view type="bitmap"
            id="m"
            scale="true"
            w="0"
            h="0"
            sizeref="wh"
            texture="W_line_hor3.tga" />
    </group>
  </template>
  <!-- the same as menu_separator, but this is just a place holder (must give height of the separator -->
  <template name="menu_separator_empty"
            keep="true">
    <group id="sep"
           posref="BL BL"
           w="4"
           h="4"
           x="-4">
      <!-- <view type="bitmap" id="l" posref="TL TL" texture="w_button_08_over.tga" /> -->
    </group>
  </template>
  <!-- ******************************* -->
  <!-- *  TEMPLATE FOR MENU CHECKBOX * -->
  <!-- ******************************* -->
  <template name="menu_checkbox"
            keep="true"
            onclick_l=""
            params_l="">
    <group id="cb"
           child_resize_h="true"
           child_resize_w="true">
      <ctrl type="button"
            id="b"
            button_type="toggle_button"
            posref="TL TL"
            tx_normal="W_sound_off.tga"
            tx_pushed="W_sound_on.tga"
            tx_over="W_button_14_over.tga"
            color="255 255 255 255"
            col_pushed="255 255 255 255"
            col_over="255 255 255 255"
            global_color_pushed="false"
            onclick_l="#onclick_l"
            params_l="#params_l" />
    </group>
  </template>
  <!-- **************************************** -->
  <!-- *  BASE PARAMETERS FOR MENU (COLOR ..) * -->
  <!-- **************************************** -->
  <group type="menu"
         id="base_menu"
         mouse_pos="true"
         exit_click_b="true"
         win_priority="%win_priority_highest"
         space="1"
         fontsize="12"
         shadow="true"
         color="255 255 255 200"
         shadow_color="0 0 0 255"
         color_over="0 0 0 255"
         shadow_color_over="0 0 0 0"
         color_grayed="255 255 255 64"
         shadow_color_grayed="0 0 0 255"
         highlight_over="255 255 255 150"
         case_mode="%case_first_word_letter_up"></group>
  <group type="menu"
         id="base_menu_with_color"
         extends="base_menu">
    <action id="choose_ui_alpha"
            name="uimChooseUIAlpha"
            handler="choose_ui_alpha"
            cond="eq(@UI:VARIABLES:GC_POPUP, 1)" />
    <action id="lock_unlock"
            name="uimLockUnlock"
            handler="lock_unlock"
            cond="eq(@UI:VARIABLES:GC_POPUP, 1)" />
    <action id="help"
            name="uimHelp"
            handler="ic_help"
            cond="eq(@UI:VARIABLES:GC_HAS_HELP, 1)" />
  </group>
  <!-- ************** -->
  <!-- *  ITEM MENU * -->
  <!-- ************** -->
  <proc id="move_to_bag">
    <action handler="move_item"
            params="to=lists|nblist=1|
                                                                                listsheet0=ui:interface:inventory:content:bag:iil:bag_icons" />
  </proc>
  <proc id="move_to_pa">
    <action handler="move_item"
            params="to=lists|nblist=1|
                                                                                listsheet0=ui:interface:inventory:content:pa@0:iil:bag_icons" />
  </proc>
  <proc id="move_to_room">
    <action handler="move_item"
            params="to=lists|nblist=1|
                                                                                listsheet0=ui:interface:inventory:content:room:iil:bag_icons" />
  </proc>
  <proc id="move_to_guild">
    <action handler="move_item"
            params="to=lists|nblist=1|
                                                                                listsheet0=ui:interface:inventory:content:guild:iil:bag_icons" />
  </proc>
  <!-- item menu when we are in bags (do not modify hierarchy or ids if you do not modify the code) -->
  <group type="menu"
         id="item_menu_in_bag"
         extends="base_menu"
         on_deactive="item_menu_deactivate"
         on_active="item_menu_check">
    <action id="cris_enchant"
            name="uimCristalEnchant"
            handler="item_cristal_enchant" />
    <action id="cris_reload"
            name="uimCristalReload"
            handler="item_cristal_reload" />
    <action id="teleport_use"
            name="uimTeleportUse"
            handler="teleport_use" />
    <action id="item_consume"
            name="uimItemConsume"
            handler="item_consume" />
    <action id="xp_catalyser_use"
            name="uimXpCatalyserUse"
            handler="xp_catalyser_use" />
    <action id="item_text_display"
            name="uiOpen"
            handler="item_text_display"
            params="ui:interface:edit_custom" />
   <separator />
    <!-- Move to an Animal -->
    <action id="move"
            name="uimMoveTo">
      <action id="bag"
              name="uimMtBag"
              handler="proc"
              params="move_to_bag" />
      <!-- MAX_INVENTORY_ANIMAL -->
      <action id="pa0"
              name="uimMtPaMount0"
              handler="proc"
              params="move_to_pa|0" />
      <action id="pa1"
              name="uimMtPaMount1"
              handler="proc"
              params="move_to_pa|1" />
      <action id="pa2"
              name="uimMtPaMount2"
              handler="proc"
              params="move_to_pa|2" />
      <action id="pa3"
              name="uimMtPaMount3"
              handler="proc"
              params="move_to_pa|3" />
      <action id="guild"
              name="uimMtGuild"
              handler="proc"
              params="move_to_guild" />
      <action id="room"
              name="uimMtRoom"
              handler="proc"
              params="move_to_room" />
    </action>
    <!--<action id="drop"           name="uimDrop"          handler="proc"  params="drop_item_proc" />-->
    <action id="destroy"
            name="uimDestroy"
            handler="proc"
            params="destroy_item_proc" />
    <action id="equip"
            name="uimEquip"
            handler="inv_auto_equip" />
    <action id="infos"
            name="uimBoldInfo"
            handler="open_item_help" />
    <action id="lockunlock"
            name="uimLockItem"
            handler="lock_inv_item" />
    <action id="item_text_edition"
            name="uimItemTextEdit"
            handler="item_text_edition"
            params="ui:interface:edit_custom" />
  </group>
  <!-- MAX_INVENTORY_ANIMAL -->
  <link expr="switch(@%pa_beast0:TYPE, 'uimMtPaMount0', 'uimMtPaMount0', 'uimMtPaPacker0', 'uimMtPaDemon0')"
        target="ui:interface:item_menu_in_bag:move:pa0:hardtext" />
  <link expr="switch(@%pa_beast1:TYPE, 'uimMtPaMount1', 'uimMtPaMount1', 'uimMtPaPacker1', 'uimMtPaDemon1')"
        target="ui:interface:item_menu_in_bag:move:pa1:hardtext" />
  <link expr="switch(@%pa_beast2:TYPE, 'uimMtPaMount2', 'uimMtPaMount2', 'uimMtPaPacker2', 'uimMtPaDemon2')"
        target="ui:interface:item_menu_in_bag:move:pa2:hardtext" />
  <link expr="switch(@%pa_beast3:TYPE, 'uimMtPaMount3', 'uimMtPaMount3', 'uimMtPaPacker3', 'uimMtPaDemon3')"
        target="ui:interface:item_menu_in_bag:move:pa3:hardtext" />
  <!-- item menu when we are in self -->
  <group type="menu"
         id="item_menu_in_self"
         extends="base_menu"
         on_active="item_menu_base_check" >
    <!--<action id="drop"    name="uimDrop"     handler="proc" params="drop_item_proc"/>-->
    <action id="destroy"
            name="uimDestroy"
            handler="proc"
            params="destroy_item_proc" />
    <action id="infos"
            name="uimBoldInfo"
            handler="open_item_help"
            params="" />
    <action id="lockunlock"
            name="uimLockItem"
            handler="lock_inv_item" />
  </group>
  <!-- item menu default -->
  <group type="menu"
         id="item_menu"
         extends="base_menu"
         on_active="item_menu_base_check" >
    <!--<action id="drop"    name="uimDrop"     handler="proc" params="drop_item_proc"/>-->
    <action id="destroy"
            name="uimDestroy"
            handler="proc"
            params="destroy_item_proc" />
    <action id="move"
            name="uimMoveTo">
      <!--<action id="bag"    name="uimMtBag"         handler="proc" params="move_to_bag" /> -->
    </action>
    <action id="infos"
            name="uimBoldInfo"
            handler="open_item_help"
            params="" />
    <action id="lockunlock"
            name="uimLockItem"
            handler="lock_inv_item" />
  </group>
  <define id="item_modal_menu"
          value="ui:interface:item_menu" />
  <define id="self_item_modal_menu"
          value="ui:interface:item_menu_in_self" />
  <!-- ************************ -->
  <!-- *  ITEM DROP PROCEDURE * -->
  <!-- ************************ -->
  <!-- modal de selection d'armure/fourreaux -->
  <group type="modal"
         id="bag_choose"
         x="0"
         y="0"
         w="182"
         posref="BL TL"
         child_resize_h="true"
         exit_click_out="true"
         exit_click_l="true"
         options="skin_modal">
    <group type="list_sheet_filter_clm_slot"
           id="list"
           posref="TL TL"
           value="%bag"
           wspace="2"
           hspace="2"
           array="false"
           x="0"
           y="0"
           w="182"
           display_empty_slot="true"
           onclick_l="inv_drop"
           params_l="src=ctrl_launch_modal"
           onclick_r="open_help_auto"
           lmargin="4"
           rmargin="4"
           tmargin="4"
           bmargin="4"
           column_max="4"
           child_resize_h="true"></group>
  </group>
  <!-- the player buy an item from a bot -->
  <!--
<proc id="buy_item">
-->
  <!-- set sheet of item to buy -->
  <!--<action handler="set" params="dblink=%item_to_trade_sheet:SHEET|value=getSheetID(getDraggedSheet())" /> -->
  <!-- activate the box to choose the number of item to but (stackable item) -->
  <!--<action handler="set_active" params="target=ui:interface:confirm_buy:content:quantity|active=isStackable(getDraggedSheet())"/>-->
  <!-- set the number of item to 1 -->
  <!--<action handler="set" params="dblink=%num_stackable_item_to_trade|value=1"/>-->
  <!-- activate the dialog to choose -->
  <!--<action handler="buy_dropped_item"/>-->
  <!--</proc>-->
  <!--
<proc id="drop_item" >
-->
  <!-- If the item is from the inventory, just swap the item -->
  <!-- <action handler="swap_item"        params="@0" cond="eq(getSheetSelectionGroup(getDraggedSheet()), 'inventory_selection')"/>       -->
  <!-- If the items comes from a bot inventory, display the dialog to buy it -->
  <!-- <action handler="proc" cond="eq(getDroppedItemSelectionGroup(), 'buy_selection')" params="buy_item"/>-->
  <!--</proc>-->
  <proc id="drop_item">
    <action handler="swap_item"
            params="@0" />
  </proc>
  <proc id="drag_item"></proc>
  <!--
<proc id="test_can_drop"> -->
  <!-- If the item is from the inventory, can drop if it is an item -->
  <!--
        <action handler="isitem"        params="@0" cond="eq(getSheetSelectionGroup(getDraggedSheet()), 'inventory_selection')"/>       
        -->
  <!-- If the items comes from a bot inventory, can drop on an empty slot only. The source must also be an item -->
  <!--
        <action handler="itemtoemptyslottest"  params="@0" cond="eq(getSheetSelectionGroup(getDraggedSheet()), 'buy_selection')"/>
        -->
  <!--    
</proc>
-->
  <proc id="test_can_drop">
    <action handler="isitem"
            params="@0" />
  </proc>
  <!-- ******************* -->
  <!-- *     THUNES      * -->
  <!-- ******************* -->
  <template name="argent"
            posparent="parent"
            x="0"
            y="0"
            w="110"
            h="16"
            posref="TL TL"
            id=""
            tooltip="uittPlayerMoney">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           w="#w"
           h="#h"
           x="#x"
           y="#y">
      <!-- Yoyo: pust scale=true, because this texture may be replaced with Faction icones (32x32) -->
      <view type="bitmap"
            id="icone"
            posref="TL TL"
            texture="money_seve.tga"
            scale="true"
            w="16"
            h="16"
            global_color="false" />
      <instance template="box_widget"
                id="box1"
                posref="TL TL"
                sizeref="w"
                w="-18"
                h="16"
                x="18" />
      <view type="text_number"
            id="val1"
            posparent="box1"
            posref="MR MR"
            x="-3"
            y="-2"
            color="135 243 28 255"
            shadow="true"
            fontsize="10"
            value="#value"
            global_color="false"
            positive="true"
            format="true" />
      <view type="text"
            id="bad_price"
            posparent="box1"
            posref="MR MR"
            x="-3"
            y="-3"
            color="192 192 192 255"
            shadow="true"
            fontsize="10"
            hardtext="uiBadPrice"
            global_color="false" />
      <ctrl type="tooltip"
            id="tt"
            posparent="box1"
            posref="TL TL"
            sizeref="wh"
            w="0"
            h="0"
            tooltip="#tooltip" />
      <!-- display bad price text if price value is -1 -->
      <link expr="eq(@#value, -1)"
            target="bad_price:active" />
      <link expr="ne(@#value, -1)"
            target="val1:active" />
    </group>
  </template>
  <!-- ********************* -->
  <!-- *     SKILL POINTS  * -->
  <!-- ********************* -->
  <template name="skill_points_widget"
            posparent="parent"
            sizeref="w"
            posref="TL TL"
            x="0"
            y="0"
            id=""
            fontsize_text="10"
            fontsize_number="10"
            hardtext="uiSkillPoints"
            tooltip=""
            global_color="true">
    <group id="#id"
           child_resize_h="true"
           posparent="#posparent"
           posref="#posref"
           sizeref="w"
           x="#x"
           y="#y"
           global_color="#global_color">
      <view type="text"
            id="sp_text"
            posref="ML ML"
            color="255 255 255 255"
            x="8"
            shadow="true"
            fontsize="#fontsize_text"
            hardtext="#hardtext"
            global_color="#global_color" />
      <view type="text_number"
            id="sp_value"
            posref="MR MR"
            x="-4"
            y="0"
            color="255 255 255 255"
            shadow="true"
            fontsize="#fontsize_number"
            value="#value"
            global_color="#global_color" />
    </group>
    <instance template="text_tt"
              posparent="#id"
              tooltip="#tooltip" />
  </template>
  <template name="skill_points_widget2"
            posparent="parent"
            posref="TL TL"
            x="0"
            y="0"
            id=""
            fontsize_text="10"
            fontsize_number="10"
            hardtext="uiSkillPoints">
    <group id="#id"
           child_resize_h="true"
           posparent="#posparent"
           posref="#posref"
           child_resize_w="true"
           x="#x"
           y="#y">
      <view type="text"
            id="sp_text"
            posref="ML ML"
            color="255 255 255 255"
            shadow="true"
            fontsize="#fontsize_text"
            hardtext="#hardtext"
            global_color="false" />
      <view type="text_number"
            id="sp_value"
            posref="MR ML"
            posparent="sp_text"
            x="4"
            y="0"
            color="255 255 255 255"
            shadow="true"
            fontsize="#fontsize_number"
            value="#value"
            global_color="false" />
    </group>
  </template>

  <!-- ********************* -->
  <!-- *   FACTION POINTS  * -->
  <!-- ********************* -->
  <template name="faction_points_widget"
            id=""
            posref="TL TL"
            posparent="parent"
            x="0"
            y="0"
            sizeref="w"
            sizeparent="parent"
            w="0">
    <group id="#id"
           posref="#posref"
           posparent="#posparent"
           x="#x"
           y="#y"
           sizeref="#sizeref"
           sizeparent="#sizeparent"
           w="#w"
           h="74">
      <!-- the title -->
      <view type="text"
            id="factionpt_t"
            posref="TL TL"
            x="0"
            y="0"
            hardtext="uiFactionPointTable"
            shadow="true"
            color="255 255 255 255"
            global_color="false"
            fontsize="12" />
      <instance template="text_tt"
                tooltip="uittIdentityFaction"
                posparent="factionpt_t" />
      <!-- left part : kami fyros zorai -->
      <group id="left"
             posref="TL TL"
             x="0"
             y="-14"
             sizeref="w5"
             w="0"
             h="60"
             inherit_gc_alpha="true">
        <!-- texts -->
        <view type="text"
              id="tkami"
              posref="TL TL"
              x="8"
              y="-8"
              w="-16"
              color="255 255 255 255"
              fontsize="12"
              shadow="true"
              hardtext="uiFactionPoint_Kami" />
        <view type="text"
              id="tfyro"
              posref="TL TL"
              x="8"
              y="-24"
              color="255 255 255 255"
              fontsize="12"
              shadow="true"
              hardtext="uiFactionPoint_Fyros" />
        <view type="text"
              id="tzora"
              posref="TL TL"
              x="8"
              y="-40"
              color="255 255 255 255"
              fontsize="12"
              shadow="true"
              hardtext="uiFactionPoint_Zorai" />
        <!-- numbers -->
        <view type="text_number"
              id="vkami"
              posref="TR TR"
              x="-8"
              y="-8"
              w="-16"
              color="255 255 255 255"
              shadow="true"
              fontsize="12"
              value="%faction_points_kami"
              positive="true" />
        <view type="text_number"
              id="vfyro"
              posref="TR TR"
              x="-8"
              y="-24"
              color="255 255 255 255"
              shadow="true"
              fontsize="12"
              value="%faction_points_fyros"
              positive="true" />
        <view type="text_number"
              id="vzora"
              posref="TR TR"
              x="-8"
              y="-40"
              color="255 255 255 255"
              shadow="true"
              fontsize="12"
              value="%faction_points_zorai"
              positive="true" />
        <instance template="inner_thin_border"
                  posparent="parent"
                  inherit_gc_alpha="true" />
      </group>
      <!-- right part : karavan matis tryker -->
      <group id="right"
             posref="TR TR"
             x="0"
             y="-14"
             sizeref="w5"
             w="0"
             h="60"
             inherit_gc_alpha="true">
        <!-- texts -->
        <view type="text"
              id="tkara"
              posref="TL TL"
              x="8"
              y="-8"
              w="-16"
              color="255 255 255 255"
              fontsize="12"
              shadow="true"
              hardtext="uiFactionPoint_Karavan" />
        <view type="text"
              id="tmati"
              posref="TL TL"
              x="8"
              y="-24"
              color="255 255 255 255"
              fontsize="12"
              shadow="true"
              hardtext="uiFactionPoint_Matis" />
        <view type="text"
              id="ttryk"
              posref="TL TL"
              x="8"
              y="-40"
              color="255 255 255 255"
              fontsize="12"
              shadow="true"
              hardtext="uiFactionPoint_Tryker" />
        <!-- numbers -->
        <view type="text_number"
              id="vkara"
              posref="TR TR"
              x="-8"
              y="-8"
              color="255 255 255 255"
              shadow="true"
              fontsize="12"
              value="%faction_points_karavan"
              positive="true" />
        <view type="text_number"
              id="vmati"
              posref="TR TR"
              x="-8"
              y="-24"
              color="255 255 255 255"
              shadow="true"
              fontsize="12"
              value="%faction_points_matis"
              positive="true" />
        <view type="text_number"
              id="vtryk"
              posref="TR TR"
              x="-8"
              y="-40"
              color="255 255 255 255"
              shadow="true"
              fontsize="12"
              value="%faction_points_tryker"
              positive="true" />
        <instance template="inner_thin_border"
                  posparent="parent"
                  inherit_gc_alpha="true" />
      </group>
    </group>
  </template>
  <!-- ******************* -->
  <!-- *  SELECT NUMBER  * -->
  <!-- ******************* -->
  <template name="SNH"
            id=""
            value=""
            loop="true"
            min="0"
            max="9"
            posparent="parent"
            posref="MM MM"
            x="0"
            y="0"
            w="28"
            h="20"
            delta="1">
    <group type="select_number"
           id="#id"
           value="#value"
           loop="#loop"
           min="#min"
           max="#max"
           x="#x"
           y="#y"
           w="#w"
           h="#h"
           posparent="#posparent"
           posref="#posref"
           delta="#delta">
      <view type="bitmap"
            id="slot_number"
            posref="ML ML"
            texture="W_slot_number.tga" />
      <view type="text"
            id="number"
            posparent="slot_number"
            posref="MM MM"
            x="-1"
            y="-2"
            color="255 255 255 255"
            fontsize="12"
            shadow="true"
            hardtext="0"
            global_color="false" />
      <ctrl type="button"
            id="arrow_up"
            button_type="push_button"
            posref="TR TR"
            tx_normal="W_arrow_up_2.tga"
            tx_pushed="W_arrow_up_2.tga"
            tx_over="W_button_10_over.tga" />
      <ctrl type="button"
            id="arrow_down"
            button_type="push_button"
            posref="BR BR"
            tx_normal="W_arrow_down_2.tga"
            tx_pushed="W_arrow_down_2.tga"
            tx_over="W_button_10_over.tga" />
    </group>
  </template>
  <template name="SNV"
            id=""
            value=""
            loop="true"
            min="0"
            max="9"
            posparent="parent"
            posref="MM MM"
            x="0"
            y="0"
            w="16"
            h="40"
            delta="1">
    <group type="select_number"
           id="#id"
           value="#value"
           loop="#loop"
           min="#min"
           max="#max"
           x="#x"
           y="#y"
           w="#w"
           h="#h"
           posparent="#posparent"
           posref="#posref"
           delta="#delta">
      <view type="bitmap"
            id="slot_number"
            posref="MM MM"
            texture="W_slot_number.tga" />
      <view type="text"
            id="number"
            posparent="slot_number"
            posref="MM MM"
            x="-1"
            y="-2"
            color="255 255 255 255"
            fontsize="12"
            shadow="true"
            hardtext="0"
            global_color="false" />
      <ctrl type="button"
            id="arrow_up"
            button_type="push_button"
            posref="TM TM"
            tx_normal="W_arrow_up_1.tga"
            tx_pushed="W_arrow_up_1.tga"
            tx_over="W_button_12_over.tga" />
      <ctrl type="button"
            id="arrow_down"
            button_type="push_button"
            posref="BM BM"
            tx_normal="W_arrow_down_1.tga"
            tx_pushed="W_arrow_down_1.tga"
            tx_over="W_button_12_over.tga" />
    </group>
  </template>
  <!-- ********** -->
  <!-- *  SETS  * -->
  <!-- ********** -->
  <!-- test if drop can be done depending on the mode 
        Param 0 is src=... (filled by code)
-->
  <proc id="slot_can_drop">
    <action cond="eq(getSheetSelectionGroup(getDraggedSheet()), 'inventory_selection')"
            handler="isitem_slot"
            params="@0" />
    <action cond="eq(getSheetSelectionGroup(getDraggedSheet()), 'buy_selection')"
            handler="isitem_slot"
            params="@0|test_empty=true" />
  </proc>
  <!-- Exemple of ifthenelse function
        <view type="text" id="notabene" posparent="handr" posref="MM MM" color="255 255 255 255" fontsize="12" shadow="true" hardtext="0" /> 
        <link expr="ifthenelse(isRangeWeapon (@%set_base:#setnumber:%set_r),str('RW'),str('.'))" target="notabene:hardtext" />
-->
  <!-- template for border inside of a group -->
  <template name="inner_thin_border"
            posparent="parent"
            keep="true"
            inherit_gc_alpha="false">
    <view type="bitmap"
          id="bg"
          texture="W_box_blank.tga"
          scale="true"
          posparent="#posparent"
          posref="MM MM"
          sizeref="hw"
          w="-8"
          h="-8"
          inherit_gc_alpha="#inherit_gc_alpha" />
    <view type="bitmap"
          id="tlb"
          texture="W_box_top_left.tga"
          posref="TL TL"
          posparent="#posparent"
          inherit_gc_alpha="#inherit_gc_alpha" />
    <view type="bitmap"
          id="trb"
          texture="W_box_top_right.tga"
          posref="TR TR"
          posparent="#posparent"
          inherit_gc_alpha="#inherit_gc_alpha" />
    <view type="bitmap"
          id="brb"
          texture="W_box_bot_right.tga"
          posref="BR BR"
          posparent="#posparent"
          inherit_gc_alpha="#inherit_gc_alpha" />
    <view type="bitmap"
          id="blb"
          texture="W_box_bot_left.tga"
          posref="BL BL"
          posparent="#posparent"
          inherit_gc_alpha="#inherit_gc_alpha" />
    <view type="bitmap"
          id="tb"
          texture="W_box_top.tga"
          posref="TM TM"
          posparent="#posparent"
          scale="true"
          sizeref="w"
          w="-8"
          h="4"
          inherit_gc_alpha="#inherit_gc_alpha" />
    <view type="bitmap"
          id="bb"
          texture="W_box_bot.tga"
          posref="BM BM"
          posparent="#posparent"
          scale="true"
          sizeref="w"
          w="-8"
          h="4"
          inherit_gc_alpha="#inherit_gc_alpha" />
    <view type="bitmap"
          id="lb"
          texture="W_box_left.tga"
          posref="ML ML"
          posparent="#posparent"
          scale="true"
          sizeref="h"
          h="-8"
          w="4"
          inherit_gc_alpha="#inherit_gc_alpha" />
    <view type="bitmap"
          id="rb"
          texture="W_box_right.tga"
          posref="MR MR"
          posparent="#posparent"
          scale="true"
          sizeref="h"
          h="-8"
          w="4"
          inherit_gc_alpha="#inherit_gc_alpha" />
  </template>
  <!-- ********** -->
  <!-- *  CHAT  * -->
  <!-- ********** -->
  <template name="chat_box"
            posparent="parent"
            posref="TL TL"
            x="0"
            y="0"
            w="0"
            h="64"
            sizeref=""
            maxelements="200"
            keep="true"
            chat="false">
    <group type="scroll_text"
           id="#id"
           sizeref="#sizeref"
           w="#w"
           h="#h"
           posparent="#posparent"
           posref="#posref"
           y="#y"
           x="#x"
           popup_minh="96">
      <!--
                <ctrl type="button" id="button_add" posref="TR TR" button_type="push_button" tx_normal="W_scale_more_3.tga" tx_pushed="W_scale_more_3.tga" tx_over="W_button_08_over.tga"/>
                <ctrl type="button" id="button_sub" posref="TL TR" posparent="button_add" x="-4" button_type="push_button" tx_normal="W_scale_less_3.tga" tx_pushed="W_scale_less_3.tga" tx_over="W_button_08_over.tga"/>
                -->
      <group id="black"
             posref="BR BR"
             sizeref="hw"
             w="-10"
             h="-12"
             inherit_gc_alpha="true" />
      <instance template="inner_thin_border"
                posparent="black"
                inherit_gc_alpha="true" />
      <group type="list"
             id="text_list"
             chat="#chat"
             fontsize="10"
             posref="BL BL"
             posparent="black"
             x="2"
             y="2"
             space="0"
             sizeref="hw"
             w="-4"
             h="-4"
             maxelements="#maxelements" />
      <ctrl style="skin_scroll"
            id="scroll_bar" />
    </group>
  </template>
  <template name="chat_box_mainchat"
            posparent="parent"
            posref="TL TL"
            x="0"
            y="0"
            w="0"
            h="0"
            sizeref=""
            maxelements="200"
            keep="true"
            chat="false">
    <group type="scroll_text"
           id="#id"
           w="#w"
           h="#h"
           sizeref="#sizeref"
           posparent="#posparent"
           posref="#posref"
           y="#y"
           x="#x">
      <!--
                <ctrl type="button" id="button_add" posref="TR TR" button_type="push_button" tx_normal="W_scale_more_3.tga" tx_pushed="W_scale_more_3.tga" tx_over="W_button_08_over.tga"/>
                <ctrl type="button" id="button_sub" posref="TL TR" posparent="button_add" x="-4" button_type="push_button" tx_normal="W_scale_less_3.tga" tx_pushed="W_scale_less_3.tga" tx_over="W_button_08_over.tga"/>
                -->
      <group id="black"
             posref="BR BR"
             sizeref="hw"
             w="-10"
             h="-4"
             inherit_gc_alpha="true" />
      <instance template="inner_thin_border"
                posparent="black"
                inherit_gc_alpha="true" />
      <group type="list"
             id="text_list"
             chat="#chat"
             fontsize="10"
             posref="BL BL"
             posparent="black"
             x="2"
             y="2"
             space="0"
             sizeref="hw"
             w="-4"
             h="-4"
             maxelements="#maxelements" />
      <ctrl style="skin_scroll"
            id="scroll_bar" />
    </group>
  </template>
  <!-- ********************* -->
  <!-- *  EDIT BOX WIDGET  * -->
  <!-- ********************* -->
  <template name="edit_box_widget"
            posref="TL TL"
            text_x="0"
            text_y="-1"
            text_ref="BL BL"
            child_resize_h="true"
            child_resize_hmargin="0"
            multi_line="false"
            x="0"
            y="0"
            w="0"
            h="0"
            sizeref=""
            id="eb"
            posparent="parent"
            onenter="chat_box_entry"
            params=""
            reset_focus_on_hide="true"
            enter_loose_focus="true"
            prompt="&gt;"
            enter_recover_focus="true"
            max_num_chars="255"
            menu_r=""
            onchange=""
            onchange_params=""
            entry_type="text"
            keep="true"
            max_historic="40"
            fontsize="10"
            backup_father_container_pos="false"
            want_return="false"
            color="255 255 255 255"
            continuous_text_update="false"
            bg_texture="W_box_blank.tga"
            on_focus_lost=""
            on_focus_lost_params=""
            max_float_prec="5"
            tooltip=""
            tooltip_parent=""
            negative_filter="">
    <group id="#id"
           posref="#posref"
           x="#x"
           y="#y"
           posparent="#posparent"
           child_resize_h="#child_resize_h"
           child_resize_hmargin="#child_resize_hmargin"
           sizeref="#sizeref"
           w="#w"
           h="#h">
      <group type="edit_box"
             sizeref="w"
             w="-8"
             id="eb"
             posref="TL TL"
             x="4"
             y="-4"
             child_resize_h="true"
             onenter="#onenter"
             params="#params"
             onchange="#onchange"
             onchange_params="#onchange_params"
             max_num_chars="#max_num_chars"
             prompt="#prompt"
             enter_loose_focus="#enter_loose_focus"
             enter_recover_focus="#enter_recover_focus"
             entry_type="#entry_type"
             reset_focus_on_hide="#reset_focus_on_hide"
             menu_r="#menu_r"
             max_historic="#max_historic"
             want_return="#want_return"
             backup_father_container_pos="#backup_father_container_pos"
             on_focus_lost="#on_focus_lost"
             on_focus_lost_params="#on_focus_lost_params"
             max_float_prec="#max_float_prec"
             tooltip="#tooltip"
             tooltip_parent="#tooltip_parent"
             negative_filter="#negative_filter">
        <view type="bitmap"
              id="bg"
              scale="true"
              sizeref="hw"
              h="0"
              w="0"
              texture="#bg_texture"
              inherit_gc_alpha="true" />
        <view id="edit_text"
              type="text"
              continuous_update="#continuous_text_update"
              x="#text_x"
              y="#text_y"
              posref="#text_ref"
              multi_line="#multi_line"
              multi_line_space="0"
              fontsize="#fontsize"
              color="#color"
              shadow="true"
              hardtext=""
              global_color="false" />
      </group>
      <!-- border around the list -->
      <view type="bitmap"
            id="tlb"
            texture="W_box_top_left.tga"
            posparent="eb"
            posref="TL BR"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            id="trb"
            texture="W_box_top_right.tga"
            posparent="eb"
            posref="TR BL"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            id="brb"
            texture="W_box_bot_right.tga"
            posparent="eb"
            posref="BR TL"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            id="blb"
            texture="W_box_bot_left.tga"
            posparent="eb"
            posref="BL TR"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            id="tb"
            texture="W_box_top.tga"
            posparent="eb"
            posref="TL BL"
            scale="true"
            sizeref="w"
            w="0"
            h="4"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            id="bb"
            texture="W_box_bot.tga"
            posparent="eb"
            posref="BL TL"
            scale="true"
            sizeref="w"
            w="0"
            h="4"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            id="lb"
            texture="W_box_left.tga"
            posparent="eb"
            posref="TL TR"
            scale="true"
            sizeref="h"
            h="0"
            w="4"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            id="rb"
            texture="W_box_right.tga"
            posparent="eb"
            posref="TR TL"
            scale="true"
            sizeref="h"
            h="0"
            w="4"
            inherit_gc_alpha="true" />
    </group>
  </template>
  <!-- ******************************* -->
  <!-- *  MULTILINE EDIT BOX WIDGET  * -->
  <!-- ******************************* -->
  <template name="edit_box_widget_multiline"
            posref="TL TL"
            text_x="0"
            text_y="-1"
            text_ref="BL BL"
            child_resize_h="true"
            multi_line="true"
            x="0"
            y="0"
            w="0"
            h="0"
            sizeref=""
            id="eb"
            posparent="parent"
            onenter="chat_box_entry"
            params=""
            reset_focus_on_hide="true"
            enter_loose_focus="true"
            prompt="&gt;"
            enter_recover_focus="true"
            max_num_chars="10000"
            max_num_return="50"
            menu_r=""
            onchange=""
            onchange_params=""
            entry_type="text"
            keep="true"
            max_historic="40"
            fontsize="10"
            backup_father_container_pos="false"
            want_return="false"
            color="255 255 255 255"
            sizeref_eb="w"
            render_layer="0"
            negative_filter="">
    <group id="#id"
           posref="#posref"
           x="#x"
           y="#y"
           posparent="#posparent"
           child_resize_h="#child_resize_h"
           sizeref="#sizeref"
           w="#w"
           h="#h"
           render_layer="#render_layer">
      <group type="edit_box"
             sizeref="#sizeref_eb"
             w="-8"
             id="eb"
             posref="TL TL"
             x="4"
             y="-4"
             child_resize_h="#child_resize_h"
             onenter="#onenter"
             params="#params"
             onchange="#onchange"
             onchange_params="#onchange_params"
             max_num_chars="#max_num_chars"
             max_num_return="#max_num_return"
             prompt="#prompt"
             enter_loose_focus="#enter_loose_focus"
             enter_recover_focus="#enter_recover_focus"
             entry_type="#entry_type"
             reset_focus_on_hide="#reset_focus_on_hide"
             menu_r="#menu_r"
             max_historic="#max_historic"
             want_return="#want_return"
             backup_father_container_pos="#backup_father_container_pos"
             render_layer="#render_layer"
             negative_filter="#negative_filter">
        <view type="bitmap"
              id="bg"
              scale="true"
              sizeref="hw"
              h="0"
              w="0"
              texture="W_box_blank.tga"
              inherit_gc_alpha="true"
              render_layer="#render_layer" />
        <view id="edit_text"
              type="text"
              x="#text_x"
              y="#text_y"
              posref="#text_ref"
              multi_line="#multi_line"
              multi_line_space="0"
              fontsize="#fontsize"
              color="#color"
              shadow="true"
              hardtext=""
              global_color="false"
              render_layer="#render_layer" />
      </group>
      <!-- border around the list -->
      <view type="bitmap"
            id="tlb"
            texture="W_box_top_left.tga"
            posparent="eb"
            posref="TL BR"
            inherit_gc_alpha="true"
            render_layer="#render_layer" />
      <view type="bitmap"
            id="trb"
            texture="W_box_top_right.tga"
            posparent="eb"
            posref="TR BL"
            inherit_gc_alpha="true"
            render_layer="#render_layer" />
      <view type="bitmap"
            id="brb"
            texture="W_box_bot_right.tga"
            posparent="eb"
            posref="BR TL"
            inherit_gc_alpha="true"
            render_layer="#render_layer" />
      <view type="bitmap"
            id="blb"
            texture="W_box_bot_left.tga"
            posparent="eb"
            posref="BL TR"
            inherit_gc_alpha="true"
            render_layer="#render_layer" />
      <view type="bitmap"
            id="tb"
            texture="W_box_top.tga"
            posparent="eb"
            posref="TL BL"
            scale="true"
            sizeref="w"
            w="0"
            h="4"
            inherit_gc_alpha="true"
            render_layer="#render_layer" />
      <view type="bitmap"
            id="bb"
            texture="W_box_bot.tga"
            posparent="eb"
            posref="BL TL"
            scale="true"
            sizeref="w"
            w="0"
            h="4"
            inherit_gc_alpha="true"
            render_layer="#render_layer" />
      <view type="bitmap"
            id="lb"
            texture="W_box_left.tga"
            posparent="eb"
            posref="TL TR"
            scale="true"
            sizeref="h"
            h="0"
            w="4"
            inherit_gc_alpha="true"
            render_layer="#render_layer" />
      <view type="bitmap"
            id="rb"
            texture="W_box_right.tga"
            posparent="eb"
            posref="TR TL"
            scale="true"
            sizeref="h"
            h="0"
            w="4"
            inherit_gc_alpha="true"
            render_layer="#render_layer" />
    </group>
  </template>
  <!-- ******************** -->
  <!-- *  STACK SELECTION * -->
  <!-- ******************** -->
  <proc id="stack_dialog_ok">
    <action handler="stack_item" />
    <action handler="leave_modal" />
  </proc>
  <!-- declare the dummy stack selection slot -->
  <variable entry="UI:VARIABLES:STACK_SELECTED:DSPSLOT:SHEET"
            type="sint32"
            value="0" />
  <variable entry="UI:VARIABLES:STACK_SELECTED:DSPSLOT:QUANTITY"
            type="sint32"
            value="0" />
  <variable entry="UI:VARIABLES:STACK_SELECTED:DSPSLOT:QUALITY"
            type="sint32"
            value="0" />
  <variable entry="UI:VARIABLES:STACK_SELECTED:DSPSLOT:USER_COLOR"
            type="sint32"
            value="0" />
  <variable entry="UI:VARIABLES:STACK_SELECTED:DSPSLOT:WEIGHT"
            type="sint32"
            value="0" />
  <variable entry="UI:VARIABLES:STACK_SELECTED:DSPSLOT:NAMEID"
            type="sint32"
            value="0" />
  <variable entry="UI:VARIABLES:STACK_SELECTED:DSPSLOT:INFOVERSION"
            type="sint32"
            value="0" />
  <variable entry="UI:VARIABLES:STACK_SELECTED:DSPSLOT:ENCHANT"
            type="sint32"
            value="0" />
  <variable entry="UI:VARIABLES:STACK_SELECTED:DSPSLOT:RM_CLASS_TYPE"
            type="sint32"
            value="0" />
  <variable entry="UI:VARIABLES:STACK_SELECTED:DSPSLOT:RM_FABER_STAT_TYPE"
            type="sint32"
            value="0" />
  <!-- the modal -->
  <group type="modal"
         id="stack_dialog"
         exit_click_out="true"
         posref="TL TL"
         w="155"
         h="80"
         options="skin_modal"
         on_enter="proc"
         on_enter_params="stack_dialog_ok">
    <view type="text"
          id="text"
          posref="TL TL"
          x="4"
          y="-4"
          color="255 255 255 255"
          fontsize="12"
          shadow="true"
          global_color="false"
          hardtext="SELECT QUANTITY" />
    <ctrl type="sheet"
          id="sheet"
          onclick_r="open_help_auto"
          value="UI:VARIABLES:STACK_SELECTED:DSPSLOT"
          posref="MM MM"
          x="-26"
          y="0"
          use_quantity="false" />
    <view type="text"
          id="x"
          posparent="sheet"
          posref="MR MM"
          x="8"
          y="0"
          color="255 255 255 255"
          fontsize="12"
          shadow="true"
          hardtext="X" />
    <instance template="edit_box_widget"
              id="edit"
              entry_type="positive_integer"
              text_ref="TR TR"
              text_y="-1"
              fontsize="12"
              posparent="sheet"
              posref="MR ML"
              x="16"
              y="0"
              text_x="-2"
              w="32"
              prompt=""
              enter_loose_focus="false"
              multi_line="false"
              max_num_chars="3"
              onchange="editbox_number"
              onchange_params="value=UI:VARIABLES:STACK_SELECTED:CUR_QUANTITY|update_text=false"
              onenter="proc"
              params="stack_dialog_ok"
              max_historic="0" />
    <instance template="button_ok_cancel"
              posref="BR BR"
              x="-4"
              y="4"
              onclick_ok="proc"
              onclick_ok_param="stack_dialog_ok"
              onclick_cancel="leave_modal"
              onclick_cancel_param="" />
  </group>
  <!-- ************************ -->
  <!-- *  UI COLOR SELECTIONS * -->
  <!-- ************************ -->
  <variable entry="UI:TEMP:COLOR:R"
            type="sint64"
            value="0" />
  <variable entry="UI:TEMP:COLOR:G"
            type="sint64"
            value="0" />
  <variable entry="UI:TEMP:COLOR:B"
            type="sint64"
            value="0" />
  <variable entry="UI:VARIABLES:ALPHA_BG"
            type="sint32" />
  <variable entry="UI:VARIABLES:ALPHA_CONTENT"
            type="sint32" />
  <variable entry="UI:VARIABLES:ALPHA_ROLLOVER_BG"
            type="sint32" />
  <variable entry="UI:VARIABLES:ALPHA_ROLLOVER_CONTENT"
            type="sint32" />
  <variable entry="UI:VARIABLES:USER_ALPHA"
            type="sint32"
            value="0" />
  <proc id="cancel_choose_ui_alpha">
    <action handler="cancel_choose_ui_alpha"
            params="" />
    <action handler="leave_modal"
            params="" />
  </proc>
  <group type="modal"
         id="define_ui_transparency"
         posref="TM BM"
         y="-8"
         h="180"
         child_resize_w="true"
         child_resize_wmargin="16"
         exit_click_out="true"
         onclick_out="proc"
         onclick_out_params="cancel_choose_ui_alpha"
         options="skin_modal"
         win_priority="%win_priority_highest">
    <view type="text"
          id="text_opacity"
          posref="TM TM"
          x="0"
          y="-4"
          color="255 255 255 255"
          fontsize="12"
          shadow="true"
          global_color="false"
          hardtext="uimChooseUIAlpha" />
    <!-- button to use global settings -->
    <group id="globals_settings"
           posparent="text_opacity"
           posref="BM TM"
           y="-8"
           child_resize_h="true"
           child_resize_w="true">
      <view type="text"
            id="text_use_glob_alp"
            posref="TM TM"
            x="10"
            y="-2"
            color="255 255 255 255"
            fontsize="10"
            shadow="true"
            hardtext="uiUserAlpha" />
      <ctrl type="button"
            id="use_glob_alp"
            button_type="toggle_button"
            posparent="text_use_glob_alp"
            posref="ML MR"
            x="-4"
            y="0"
            tx_normal="w_opacity_on.tga"
            tx_pushed="w_slot_on.tga"
            tx_over="w_slot_on.tga"
            color="255 255 255 255"
            col_pushed="255 255 255 255"
            col_over="255 255 255 0"
            onclick_l="use_global_alpha_settings" />
      <link expr="@UI:VARIABLES:USER_ALPHA"
            target="use_glob_alp:pushed" />
    </group>
    <view type="text"
          id="pipo"
          posref="TM TM"
          x="0"
          y="-40"
          color="255 255 255 255"
          fontsize="10"
          shadow="true"
          hardtext="uiLocalAlpha" />
    <!-- background -->
    <view type="text"
          id="text_alp_bg"
          posparent="pipo"
          posref="BM TM"
          x="0"
          y="-8"
          color="255 255 255 160"
          fontsize="8"
          shadow="true"
          hardtext="uiAlphaBG" />
    <view type="bitmap"
          id="b1"
          posparent="text_alp_bg"
          posref="BM TM"
          scale="true"
          x="0"
          y="-4"
          w="64"
          h="2"
          texture="W_line_hor2.tga" />
    <ctrl type="scroll"
          id="alp1"
          posparent="b1"
          posref="MM MM"
          x="0"
          y="0"
          w="64"
          h="8"
          vertical="false"
          align="L"
          min="0"
          max="255"
          value="UI:VARIABLES:ALPHA_BG"
          tracksize="8"
          onscroll=""
          params=""
          tx_topright="w_scroll_R.tga"
          tx_middle="w_scroll_l123_m.tga"
          tx_bottomleft="w_scroll_L.tga" />
    <!-- content -->
    <view type="text"
          id="text_alp_content"
          posparent="b1"
          x="0"
          y="-8"
          posref="BM TM"
          color="255 255 255 160"
          fontsize="8"
          shadow="true"
          hardtext="uiAlphaContent" />
    <view type="bitmap"
          id="b2"
          posparent="text_alp_content"
          posref="BM TM"
          scale="true"
          x="0"
          y="-4"
          w="64"
          h="2"
          texture="W_line_hor2.tga" />
    <ctrl type="scroll"
          id="alp2"
          posparent="b2"
          posref="MM MM"
          x="0"
          y="0"
          w="64"
          h="8"
          vertical="false"
          align="L"
          min="64"
          max="255"
          value="UI:VARIABLES:ALPHA_CONTENT"
          tracksize="8"
          onscroll=""
          params=""
          tx_topright="w_scroll_R.tga"
          tx_middle="w_scroll_l123_m.tga"
          tx_bottomleft="w_scroll_L.tga" />
    <!-- rollover background -->
    <view type="text"
          id="text_alp_rollover_bg"
          posparent="b2"
          x="0"
          y="-8"
          posref="BM TM"
          color="255 255 255 160"
          fontsize="8"
          shadow="true"
          hardtext="uiAlphaRolloverBG" />
    <view type="bitmap"
          id="b3"
          posparent="text_alp_rollover_bg"
          posref="BM TM"
          scale="true"
          x="0"
          y="-4"
          w="64"
          h="2"
          texture="W_line_hor2.tga" />
    <ctrl type="scroll"
          id="alp3"
          posparent="b3"
          posref="MM MM"
          x="0"
          y="0"
          w="64"
          h="8"
          vertical="false"
          align="L"
          min="0"
          max="255"
          value="UI:VARIABLES:ALPHA_ROLLOVER_BG"
          tracksize="8"
          onscroll=""
          params=""
          tx_topright="w_scroll_R.tga"
          tx_middle="w_scroll_l123_m.tga"
          tx_bottomleft="w_scroll_L.tga" />
    <!-- rollover content -->
    <view type="text"
          id="text_alp_rollover_content"
          posparent="b3"
          x="0"
          y="-8"
          posref="BM TM"
          color="255 255 255 160"
          fontsize="8"
          shadow="true"
          hardtext="uiAlphaRolloverContent" />
    <view type="bitmap"
          id="b4"
          posparent="text_alp_rollover_content"
          posref="BM TM"
          scale="true"
          x="0"
          y="-4"
          w="64"
          h="2"
          texture="W_line_hor2.tga" />
    <ctrl type="scroll"
          id="alp4"
          posparent="b4"
          posref="MM MM"
          x="0"
          y="0"
          w="64"
          h="8"
          vertical="false"
          align="L"
          min="64"
          max="255"
          value="UI:VARIABLES:ALPHA_ROLLOVER_CONTENT"
          tracksize="8"
          onscroll=""
          params=""
          tx_topright="w_scroll_R.tga"
          tx_middle="w_scroll_l123_m.tga"
          tx_bottomleft="w_scroll_L.tga" />
    <link expr="@UI:VARIABLES:USER_ALPHA"
          target="alp1:active,alp2:active,alp3:active,alp4:active" />
    <link expr="ifthenelse(@UI:VARIABLES:USER_ALPHA, 255, 96)"
          target="pipo:alpha,text_alp_bg:alpha,b1:alpha,text_alp_content:alpha,b2:alpha,text_alp_rollover_bg:alpha,text_alp_rollover_content:alpha,b3:alpha,b4:alpha" />
    <link expr="ifthenelse(@UI:VARIABLES:USER_ALPHA, 96, 255)"
          target="globals_settings:text_use_glob_alp:alpha" />
    <instance template="button_ok_cancel"
              posref="BR BR"
              x="-4"
              y="4"
              onclick_ok="leave_modal"
              onclick_ok_param=""
              onclick_cancel="proc"
              onclick_cancel_param="cancel_choose_ui_alpha" />
    <link expr="depends(@UI:VARIABLES:ALPHA_CONTENT)"
          action="set"
          params="dblink=UI:VARIABLES:ALPHA_BG|value=min(@UI:VARIABLES:ALPHA_CONTENT, @UI:VARIABLES:ALPHA_BG)" />
    <link expr="depends(@UI:VARIABLES:ALPHA_BG)"
          action="set"
          params="dblink=UI:VARIABLES:ALPHA_CONTENT|value=max(@UI:VARIABLES:ALPHA_CONTENT, @UI:VARIABLES:ALPHA_BG)" />
    <link expr="depends(@UI:VARIABLES:ALPHA_ROLLOVER_CONTENT)"
          action="set"
          params="dblink=UI:VARIABLES:ALPHA_ROLLOVER_BG|value=min(@UI:VARIABLES:ALPHA_ROLLOVER_CONTENT, @UI:VARIABLES:ALPHA_ROLLOVER_BG)" />
    <link expr="depends(@UI:VARIABLES:ALPHA_ROLLOVER_BG)"
          action="set"
          params="dblink=UI:VARIABLES:ALPHA_ROLLOVER_CONTENT|value=max(@UI:VARIABLES:ALPHA_ROLLOVER_CONTENT, @UI:VARIABLES:ALPHA_ROLLOVER_BG)" />
  </group>
  <!-- **************** -->
  <!-- *  BOX WIDGET  * -->
  <!-- **************** -->
  <template name="box_widget"
            posref="TL TL"
            x="0"
            y="0"
            w="64"
            h="16"
            id=""
            posparent="parent"
            sizeref=""
            keep="true"
            render_layer="0">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           w="#w"
           h="#h"
           x="#x"
           y="#y"
           sizeref="#sizeref">
      <group id="bg"
             sizeref="hw"
             h="0"
             w="0" />
      <view type="bitmap"
            render_layer="#render_layer"
            id="back"
            scale="true"
            posparent="bg"
            posref="MM MM"
            sizeref="hw"
            h="-8"
            w="-8"
            texture="W_box_blank.tga"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            render_layer="#render_layer"
            id="bgb"
            scale="true"
            sizeref="hw"
            h="0"
            w="0"
            texture="W_box_blank.tga"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            render_layer="#render_layer"
            id="tlb"
            texture="W_box_top_left.tga"
            posref="TL TL"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            render_layer="#render_layer"
            id="trb"
            texture="W_box_top_right.tga"
            posref="TR TR"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            render_layer="#render_layer"
            id="brb"
            texture="W_box_bot_right.tga"
            posref="BR BR"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            render_layer="#render_layer"
            id="blb"
            texture="W_box_bot_left.tga"
            posref="BL BL"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            render_layer="#render_layer"
            id="tb"
            texture="W_box_top.tga"
            posref="TM TM"
            scale="true"
            sizeref="w"
            w="-8"
            h="4"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            render_layer="#render_layer"
            id="bb"
            texture="W_box_bot.tga"
            posref="BM BM"
            scale="true"
            sizeref="w"
            w="-8"
            h="4"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            render_layer="#render_layer"
            id="lb"
            texture="W_box_left.tga"
            posref="ML ML"
            scale="true"
            sizeref="h"
            h="-8"
            w="4"
            inherit_gc_alpha="true" />
      <view type="bitmap"
            render_layer="#render_layer"
            id="rb"
            texture="W_box_right.tga"
            posref="MR MR"
            scale="true"
            sizeref="h"
            h="-8"
            w="4"
            inherit_gc_alpha="true" />
    </group>
  </template>
  <template name="frame_widget"
            posref="TL TL"
            x="0"
            y="0"
            w="64"
            h="16"
            id=""
            posparent="parent"
            sizeref=""
            keep="true">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           w="#w"
           h="#h"
           x="#x"
           y="#y"
           sizeref="#sizeref">
      <group id="bg"
             sizeref="hw"
             h="0"
             w="0" />
      <view type="bitmap"
            id="t"
            texture="blank.tga"
            posref="TM TM"
            scale="true"
            sizeref="w"
            w="0"
            h="1"
            color="3 3 3 255" />
      <view type="bitmap"
            id="b"
            texture="blank.tga"
            posref="BM BM"
            scale="true"
            sizeref="w"
            w="0"
            h="1"
            color="160 160 160 255" />
      <view type="bitmap"
            id="l"
            texture="blank.tga"
            posref="ML ML"
            scale="true"
            sizeref="h"
            h="-2"
            w="1"
            color="45 45 45 255" />
      <view type="bitmap"
            id="r"
            texture="blank.tga"
            posref="MR MR"
            scale="true"
            sizeref="h"
            h="-2"
            w="1"
            color="129 129 129 255" />
    </group>
  </template>
  <template name="border_select_widget"
            posref="TL TL"
            x="0"
            y="0"
            w="64"
            h="16"
            id=""
            posparent="parent"
            sizeref=""
            keep="true"
            alpha="255"
            render_layer="0">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           w="#w"
           h="#h"
           x="#x"
           y="#y"
           sizeref="#sizeref">
      <group id="bg"
             sizeref="hw"
             h="0"
             w="0" />
      <view type="bitmap"
            id="t"
            texture="blank.tga"
            posref="TM TM"
            scale="true"
            sizeref="w"
            w="0"
            h="1"
            global_color="false"
            color="255 255 255 #alpha"
            render_layer="#render_layer" />
      <view type="bitmap"
            id="b"
            texture="blank.tga"
            posref="BM BM"
            scale="true"
            sizeref="w"
            w="0"
            h="1"
            global_color="false"
            color="255 255 255 #alpha"
            render_layer="#render_layer" />
      <view type="bitmap"
            id="l"
            texture="blank.tga"
            posref="ML ML"
            scale="true"
            sizeref="h"
            h="-2"
            w="1"
            global_color="false"
            color="255 255 255 #alpha"
            render_layer="#render_layer" />
      <view type="bitmap"
            id="r"
            texture="blank.tga"
            posref="MR MR"
            scale="true"
            sizeref="h"
            h="-2"
            w="1"
            global_color="false"
            color="255 255 255 #alpha"
            render_layer="#render_layer" />
    </group>
  </template>
  <!-- template for the inner border of a dialog, with thick border on the left -->
  <template name="inner_thick_border"
            id="inner_thick_border"
            posparent="parent"
            keep="true">
    <group id="#id"
           posref="TL TL"
           sizeref="hw">
      <view type="bitmap"
            id="tlb"
            texture="W_L0_TL.tga"
            posparent="#posparent"
            posref="TL TL" />
      <view type="bitmap"
            id="trb"
            texture="W_L0_TR.tga"
            posparent="#posparent"
            posref="TR TR" />
      <view type="bitmap"
            id="brb"
            texture="W_L0_BR.tga"
            posparent="#posparent"
            posref="BR BR" />
      <view type="bitmap"
            id="blb"
            texture="W_L0_BL.tga"
            posparent="#posparent"
            posref="BL BL" />
      <view type="bitmap"
            id="tb"
            texture="W_L0_T.tga"
            posparent="#posparent"
            posref="TL TL"
            scale="true"
            sizeref="w"
            w="-24"
            h="8"
            x="16" />
      <view type="bitmap"
            id="bb"
            texture="W_L0_B.tga"
            posparent="#posparent"
            posref="BL BL"
            scale="true"
            sizeref="w"
            w="-24"
            h="8"
            x="16" />
      <view type="bitmap"
            id="lb"
            texture="W_L0_L.tga"
            posparent="#posparent"
            posref="TL TL"
            scale="true"
            sizeref="h"
            h="-16"
            w="16"
            y="-8" />
      <view type="bitmap"
            id="rb"
            texture="W_L0_R.tga"
            posparent="#posparent"
            posref="TR TR"
            scale="true"
            sizeref="h"
            h="-16"
            w="8"
            y="-8" />
    </group>
  </template>
  <!-- ***************** -->
  <!-- *  CONTEXT HELP * -->
  <!-- ***************** -->
  <define id="over_border_color"
          value="140 140 240 255" />
  <define id="help_bg_color"
          value="100 120 120 255" />

     <!-- Define varaibles for the list sheet of the root brick selection modal-->
    <!--<define id="phrase_brick_selection_max" value_from_code="getPhraseBrickSelectionMax()" />-->
    <variable entry="UI:VARIABLES:CRYSTALBRICKS:$i:SHEET" type="sint32" value="0" size="64" />

  <!-- Over Text used for buttons or controls -->
  <group id="context_help"
         posref="BL BL"
         child_resize_w="true"
         child_resize_wmargin="12"
         child_resize_h="true"
         child_resize_hmargin="9">
    <!--Decoration-->
    <view type="bitmap"
          id="midcolor"
          sizeref="wh"
          posref="MM MM"
          h="-4"
          w="-4"
          scale="true"
          color="%help_bg_color"
          global_color="false"
          texture="blank.tga" />
    <view type="bitmap"
          id="t"
          sizeref="w"
          posref="TM TM"
          w="-16"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_t.tga" />
    <view type="bitmap"
          id="b"
          sizeref="w"
          posref="BM BM"
          w="-16"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_b.tga" />
    <view type="bitmap"
          id="l"
          sizeref="h"
          posref="ML ML"
          w="8"
          h="-16"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_l.tga" />
    <view type="bitmap"
          id="r"
          sizeref="h"
          posref="MR MR"
          w="8"
          h="-16"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_r.tga" />
    <view type="bitmap"
          id="tl"
          avoid_resize_parent="true"
          posref="TL TL"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_tl.tga" />
    <view type="bitmap"
          id="bl"
          avoid_resize_parent="true"
          posref="BL BL"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_bl.tga" />
    <view type="bitmap"
          id="tr"
          avoid_resize_parent="true"
          posref="TR TR"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_tr.tga" />
    <view type="bitmap"
          id="br"
          avoid_resize_parent="true"
          posref="BR BR"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_br.tga" />
    <!--System, don'change the ids -->
    <view type="text"
          id="text"
          posref="TM TM"
          y="-6"
          color="255 255 255 255"
          global_color="false"
          fontsize="10"
          shadow="true"
          multi_line="true"
          multi_line_space="1"
          line_maxw="300"
          multi_line_maxw_only="true" />
  </group>
  <!-- Over Text used for actions : this include additionnal icons -->
  <group id="action_context_help"
         posref="BL BL"
         child_resize_w="true"
         child_resize_wmargin="12"
         child_resize_h="true"
         child_resize_hmargin="9">
    <!--Decoration-->
    <view type="bitmap"
          id="midcolor"
          sizeref="wh"
          posref="MM MM"
          h="-4"
          w="-4"
          scale="true"
          color="%help_bg_color"
          global_color="false"
          texture="blank.tga" />
    <view type="bitmap"
          id="t"
          sizeref="w"
          posref="TM TM"
          w="-16"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_t.tga" />
    <view type="bitmap"
          id="b"
          sizeref="w"
          posref="BM BM"
          w="-16"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_b.tga" />
    <view type="bitmap"
          id="l"
          sizeref="h"
          posref="ML ML"
          w="8"
          h="-16"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_l.tga" />
    <view type="bitmap"
          id="r"
          sizeref="h"
          posref="MR MR"
          w="8"
          h="-16"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_r.tga" />
    <view type="bitmap"
          id="tl"
          avoid_resize_parent="true"
          posref="TL TL"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_tl.tga" />
    <view type="bitmap"
          id="bl"
          avoid_resize_parent="true"
          posref="BL BL"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_bl.tga" />
    <view type="bitmap"
          id="tr"
          avoid_resize_parent="true"
          posref="TR TR"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_tr.tga" />
    <view type="bitmap"
          id="br"
          avoid_resize_parent="true"
          posref="BR BR"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_br.tga" />
    <!--System, don'change the ids -->
    <view type="text"
          id="text"
          posref="TL TL"
          y="-6"
          x="5"
          color="255 255 255 255"
          global_color="false"
          fontsize="10"
          shadow="true"
          multi_line="true"
          multi_line_space="1"
          line_maxw="300"
          multi_line_maxw_only="true" />
    <view type="text"
          id="success_rate"
          y="0"
          posparent="text"
          posref="BL TL"
          hardtext="success_rate"
          active="false"
          global_color="false"/>
    <view type="bitmap"
          id="hp_cost"
          texture="ico_heal.tga"
          global_color="false"
          posref="BL TL"
          posparent="success_rate" />
    <view type="bitmap"
          id="sta_cost"
          y="0"
          texture="ico_stamina.tga"
          global_color="false"
          posref="BL TL"
          posparent="hp_cost" />
    <view type="bitmap"
          id="sap_cost"
          y="0"
          texture="ico_sap.tga"
          global_color="false"
          posref="BL TL"
          posparent="sta_cost" />
    <view type="bitmap"
          id="focus_cost"
          y="0"
          texture="ico_focus.tga"
          global_color="false"
          posref="BL TL"
          posparent="sap_cost" />
    <view type="bitmap"
          id="cast_time"
          y="0"
          texture="ico_time.tga"
          global_color="false"
          posref="BL TL"
          posparent="focus_cost" />
    <view type="bitmap"
          id="cast_range"
          y="0"
          texture="ico_range.tga"
          global_color="false"
          posref="BL TL"
          posparent="cast_time" />
    <view type="text"
          id="hp_cost_text"
          posparent="hp_cost"
          posref="MR ML"
          hardtext="0"
          global_color="false"/>
    <view type="text"
          id="sta_cost_text"
          posparent="sta_cost"
          posref="MR ML"
          hardtext="0"
          global_color="false"/>
    <view type="text"
          id="sap_cost_text"
          posparent="sap_cost"
          posref="MR ML"
          hardtext="0"
          global_color="false"/>
    <view type="text"
          id="focus_cost_text"
          posparent="focus_cost"
          posref="MR ML"
          hardtext="0"
          global_color="false"/>
    <view type="text"
          id="cast_time_text"
          posparent="cast_time"
          posref="MR ML"
          hardtext="0"
          global_color="false"/>
    <view type="text"
          id="cast_range_text"
          posparent="cast_range"
          posref="MR ML"
          hardtext="0"
          global_color="false"/>
    <view type="text"
          id="disable_time"
          y="0"
          posparent="cast_range_text"
          posref="BL TL"
          hardtext="uittDisableTime"
          active="false"
          global_color="false"/>
    <view type="text"
          id="regen_time"
          y="0"
          posparent="disable_time"
          posref="BL TL"
          hardtext="regen_time"
          active="false"
          global_color="false"/>
  </group>
    <!-- Over Text used for Buff Items : this include additionnal icons -->
  <group id="buff_item_context_help"
         posref="BL BL"
         child_resize_w="true"
         child_resize_wmargin="12"
         child_resize_h="true"
         child_resize_hmargin="9"
         global_color="false">
             <!--Decoration-->
    <view type="bitmap"
          id="midcolor"
          sizeref="wh"
          posref="MM MM"
          h="-4"
          w="-4"
          scale="true"
          color="%help_bg_color"
          global_color="false"
          texture="blank.tga" />
    <view type="bitmap"
          id="t"
          sizeref="w"
          posref="TM TM"
          w="-16"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_t.tga" />
    <view type="bitmap"
          id="b"
          sizeref="w"
          posref="BM BM"
          w="-16"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_b.tga" />
    <view type="bitmap"
          id="l"
          sizeref="h"
          posref="ML ML"
          w="8"
          h="-16"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_l.tga" />
    <view type="bitmap"
          id="r"
          sizeref="h"
          posref="MR MR"
          w="8"
          h="-16"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_r.tga" />
    <view type="bitmap"
          id="tl"
          avoid_resize_parent="true"
          posref="TL TL"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_tl.tga" />
    <view type="bitmap"
          id="bl"
          avoid_resize_parent="true"
          posref="BL BL"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_bl.tga" />
    <view type="bitmap"
          id="tr"
          avoid_resize_parent="true"
          posref="TR TR"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_tr.tga" />
    <view type="bitmap"
          id="br"
          avoid_resize_parent="true"
          posref="BR BR"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_br.tga" />
    <!--System, don'change the ids -->
    <view type="text"
          id="text"
          posref="TL TL"
          y="-6"
          x="5"
          color="255 255 255 255"
          global_color="false"
          fontsize="10"
          shadow="true"
          multi_line="true"
          multi_line_space="1"
          line_maxw="300"
          multi_line_maxw_only="true" />
    <view type="bitmap"
          id="hp_buff"
          h="15"
          y="0"
          texture="ico_heal.tga"
          global_color="false"
          posref="BL TL"
          posparent="text" 
          active="true"/>
    <view type="bitmap"
          id="sta_buff"
          y="0"
          texture="ico_stamina.tga"
          global_color="false"
          posref="BL TL"
          posparent="hp_buff" />
    <view type="bitmap"
          id="sap_buff"
          y="0"
          texture="ico_sap.tga"
          global_color="false"
          posref="BL TL"
          posparent="sta_buff" />
    <view type="bitmap"
          id="focus_buff"
          y="0"
          texture="ico_focus.tga"
          global_color="false"
          posref="BL TL"
          posparent="sap_buff" />
    <view type="text"
          id="hp_buff_text"
          posparent="hp_buff"
          posref="MR ML"
          hardtext="0"
          global_color="false"/>
    <view type="text"
          id="sta_buff_text"
          posparent="sta_buff"
          posref="MR ML"
          hardtext="0"
          global_color="false"/>
    <view type="text"
          id="sap_buff_text"
          posparent="sap_buff"
          posref="MR ML"
          hardtext="0"
          global_color="false"/>
    <view type="text"
          id="focus_buff_text"
          posparent="focus_buff"
          posref="MR ML"
          hardtext="0"
          global_color="false"/>
  </group>
      <!-- Over Text used for Crystallized Spells: this include additionnal icons -->
  <define id="crystallized_spell_list_brick" value="ui:interface:crystallized_spell_context_help:list_brick" />
  <group id="crystallized_spell_context_help"
         posref="BL BL"
         child_resize_w="true"
         child_resize_wmargin="12"
         child_resize_h="true"
         child_resize_hmargin="9"
         global_color="false">
             <!--Decoration-->
    <view type="bitmap"
          id="midcolor"
          sizeref="wh"
          posref="MM MM"
          h="-4"
          w="-4"
          scale="true"
          color="%help_bg_color"
          global_color="false"
          texture="blank.tga" />
    <view type="bitmap"
          id="t"
          sizeref="w"
          posref="TM TM"
          w="-16"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_t.tga" />
    <view type="bitmap"
          id="b"
          sizeref="w"
          posref="BM BM"
          w="-16"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_b.tga" />
    <view type="bitmap"
          id="l"
          sizeref="h"
          posref="ML ML"
          w="8"
          h="-16"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_l.tga" />
    <view type="bitmap"
          id="r"
          sizeref="h"
          posref="MR MR"
          w="8"
          h="-16"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_r.tga" />
    <view type="bitmap"
          id="tl"
          avoid_resize_parent="true"
          posref="TL TL"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_tl.tga" />
    <view type="bitmap"
          id="bl"
          avoid_resize_parent="true"
          posref="BL BL"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_bl.tga" />
    <view type="bitmap"
          id="tr"
          avoid_resize_parent="true"
          posref="TR TR"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_tr.tga" />
    <view type="bitmap"
          id="br"
          avoid_resize_parent="true"
          posref="BR BR"
          w="8"
          h="8"
          scale="true"
          color="%over_border_color"
          global_color="false"
          texture="W_hl_br.tga" />
    <!--System, don'change the ids -->
    <view type="text"
          id="text"
          posref="TL TL"
          y="-6"
          x="5"
          color="255 255 255 255"
          global_color="false"
          fontsize="10"
          shadow="true"
          multi_line="true"
          multi_line_space="1"
          line_maxw="300"
          multi_line_maxw_only="true" />
    <!-- For Cristallized Phrase -->
    <instance template="template_info_list_brick"
          type="list_sheet_compo_brick"
          id="list_brick"
          brickdb="UI:VARIABLES:CRYSTALBRICKS"
          posparent="text"
          xcost="230"
          line_maxw="185"
          multi_line_maxw_only="true" 
          param_deltax="13"
          sizeref="none"
          child_resize_w="true"
          child_resize_wmargin="13"
          global_color="false"/>

  </group>
  
  <!-- Over Text used for SingleLine TextView that are clamped (group_tree, keys interface....) -->
  <group id="over_extend_view_text"
         child_resize_w="true"
         child_resize_h="true"
         child_resize_wmargin="4"
         child_resize_hmargin="4"
         posref="BL BL">
    <!-- System, don'change the ids, nor the posref -->
    <!-- color and modulate_color are replaced according to the view text to over -->
    <view type="bitmap"
          id="midoutline"
          sizeref="wh"
          posref="MM MM"
          w="0"
          h="0"
          scale="true"
          color="255 255 255 255"
          texture="blank.tga" />
    <view type="bitmap"
          id="midback"
          sizeref="wh"
          posref="MM MM"
          h="-2"
          w="-2"
          scale="true"
          color="64 64 64 255"
          texture="blank.tga" />
    <!-- fontsize, shadow, text, color, modulate_color.... are replaced according to the view text to over -->
    <view type="text"
          id="text"
          posref="BL BL"
          x="2"
          y="1"
          color="255 255 255 255"
          fontsize="12"
          shadow="true"
          multi_line="false" />
  </group>
  <!-- Helper to place a tooltip over a text or anything else
        Basically just define 'posparent', and 'tooltip'.  (id is the parent id prefixed by tt_
        Other params are for advanced use
-->
  <template name="text_tt"
            posparent=""
            tooltip=""
            tooltip_i18n=""
            on_tooltip=""
            on_tooltip_params=""
            instant_help="true"
            tooltip_parent="ctrl"
            tooltip_posref="auto"
            tooltip_special_parent=""
            keep="true">
    <ctrl type="tooltip"
          id="tt_#posparent"
          sizeref="wh"
          x="0"
          y="0"
          w="0"
          h="0"
          posparent="#posparent"
          tooltip="#tooltip"
          tooltip_i18n="#tooltip_i18n"
          on_tooltip="#on_tooltip"
          on_tooltip_params="#on_tooltip_params"
          instant_help="#instant_help"
          tooltip_parent="#tooltip_parent"
          tooltip_posref="#tooltip_posref"
          tooltip_special_parent="#tooltip_special_parent" />
  </template>
  <!-- ******************************** -->
  <!-- *  ITEM DROP/DESTROY PROCEDURE * -->
  <!-- ******************************** -->
  <proc id="drop_item_proc">
    <!-- set the mode -->
    <action handler="set"
            params="dblink=UI:DROP_DESTROY_ITEM:DROP_MODE|value=1" />
    <action handler="proc"
            params="drop_destroy_item_proc" />
  </proc>
  <proc id="destroy_item_proc">
    <!-- set the mode -->
    <action handler="set"
            params="dblink=UI:DROP_DESTROY_ITEM:DROP_MODE|value=0" />
    <action handler="proc"
            params="drop_destroy_item_proc" />
  </proc>
  <proc id="drop_destroy_item_proc">
    <!-- copy infos about current sheet -->
    <action handler="eval_expr"
            params="expr=copySheet(getMenuItemSheet(), getSheetFromId('ui:interface:drop_destroy_item_quantity_modal:sheet'))" />
    <!-- set default quantity to 1 -->
    <action handler="set"
            params="dblink=UI:DROP_DESTROY_ITEM:ITEM:QUANTITY|value=1" />
    <!-- if the item is stackable, popup a menu to select the number of item to drop/destroy, else, directly drop/destroy the item (after confirmation)-->
    <action cond="isStackable(getMenuItemSheet())"
            handler="enter_modal"
            params="group=ui:interface:drop_destroy_item_quantity_modal" />
    <action cond="not(isStackable(getMenuItemSheet()))"
            handler="enter_modal"
            params="group=ui:interface:drop_destroy_item_confirm_modal" />
  </proc>
  <!-- proc to setup modal box to choose the number of item to drop/destroy -->
  <proc id="setup_drop_destroy_item_modal">
    <!-- copy the max number of items into the edit box (start value that is displayed), and the db -->
    <action handler="set"
            params="dblink=UI:DROP_DESTROY_ITEM:ITEM:QUANTITY|value=getSheetQuantity(getMenuItemSheet())" />
    <action handler="set"
            params="target_property=ui:interface:drop_destroy_item_quantity_modal:edit:eb:input_string|value=getSheetQuantity(getMenuItemSheet())" />
    <!-- set keyboard focus on the edit box -->
    <action handler="set_keyboard_focus"
            params="select_all=true|target=ui:interface:drop_destroy_item_quantity_modal:edit:eb" />
  </proc>
  <!-- proc that is called when the user has given the number of item to drop/destroy -->
  <proc id="drop_destroy_item_quantity_modal_ok">
    <!-- close the modal -->
    <action handler="leave_modal"
            params="" />
    <!-- clamp the number of item to drop/destroy -->
    <action handler="set"
            params="dblink=UI:DROP_DESTROY_ITEM:ITEM:QUANTITY|value=min(getSheetQuantity(getMenuItemSheet()), @@UI:DROP_DESTROY_ITEM:ITEM:QUANTITY)" />
    <!-- call the modal to confirm the choice -->
    <action cond="ne(@UI:DROP_DESTROY_ITEM:ITEM:QUANTITY, 0)"
            handler="enter_modal"
            params="group=ui:interface:drop_destroy_item_confirm_modal" />
  </proc>
  <!-- temp variables -->
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:SHEET"
            type="sint64"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:QUANTITY"
            type="sint64"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:QUALITY"
            type="sint64"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:USER_COLOR"
            type="sint64"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:LOCKED"
            type="sint64"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:WEIGHT"
            type="sint64"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:NAMEID"
            type="sint64"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:INFO_VERSION"
            type="sint64"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:ENCHANT"
            type="sint32"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:RM_CLASS_TYPE"
            type="sint32"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:RM_FABER_STAT_TYPE"
            type="sint32"
            value="0" />
  <variable entry="UI:DROP_DESTROY_ITEM:ITEM:PREREQUSIT_VALID"
            type="sint32"
            value="0" />
  <!-- drop or destroy/mode -->
  <variable entry="UI:DROP_DESTROY_ITEM:DROP_MODE"
            type="sint64"
            value="0" />
  <!-- modal box to choose the number of item to drop/destroy -->
  <group type="modal"
         id="drop_destroy_item_quantity_modal"
         exit_click_out="true"
         posref="TL TL"
         w="180"
         h="80"
         x="-8"
         y="8"
         on_active="proc"
         on_active_params="setup_drop_destroy_item_modal"
         options="skin_modal"
         on_enter="proc"
         on_enter_params="drop_destroy_item_quantity_modal_ok">
    <view type="bitmap"
          id="warning"
          posref="TL TL"
          x="4"
          y="-4"
          global_color="false"
          texture="w_warning_2.tga" />
    <view type="text"
          id="destroy_text"
          posref="TL TL"
          x="20"
          y="-5"
          fontsize="12"
          shadow="true"
          hardtext="uimQuantityDestroy"
          global_color="false"
          color="233 197 42 255" />
    <view type="text"
          id="drop_text"
          posref="TL TL"
          x="20"
          y="-5"
          fontsize="12"
          shadow="true"
          hardtext="uimQuantityDrop"
          global_color="false"
          color="233 197 42 255" />
    <ctrl type="sheet"
          id="sheet"
          value="UI:DROP_DESTROY_ITEM:ITEM"
          posparent="parent"
          posref="MM MM"
          x="-26"
          y="0" />
    <view type="text"
          id="x"
          posparent="sheet"
          posref="MR MM"
          x="8"
          y="0"
          color="255 255 255 255"
          fontsize="12"
          shadow="true"
          hardtext="X" />
    <instance template="edit_box_widget"
              entry_type="positive_integer"
              id="edit"
              text_ref="TR TR"
              text_y="-1"
              fontsize="12"
              posparent="sheet"
              posref="MR ML"
              x="16"
              text_x="-2"
              w="32"
              prompt=""
              enter_loose_focus="false"
              multi_line="false"
              max_num_chars="3"
              onchange="editbox_number"
              onchange_params="value=UI:DROP_DESTROY_ITEM:ITEM:QUANTITY|update_text=false"
              onenter="proc"
              params="drop_destroy_item_quantity_modal_ok"
              max_historic="0" />
    <instance template="button_ok_cancel"
              posref="BR BR"
              x="-4"
              y="4"
              onclick_ok="proc"
              onclick_ok_param="drop_destroy_item_quantity_modal_ok"
              onclick_cancel="leave_modal"
              onclick_cancel_param="" />
    <!-- link to display the right text (drop or destroy) -->
    <link expr="eq(@UI:DROP_DESTROY_ITEM:DROP_MODE, 1)"
          target="drop_text:active" />
    <link expr="ne(@UI:DROP_DESTROY_ITEM:DROP_MODE, 1)"
          target="destroy_text:active" />
  </group>
  <!-- confirm drop/destroy item -->
  <proc id="confirm_drop_destroy_item">
    <action handler="leave_modal"
            params="" />
    <action cond="eq(@UI:DROP_DESTROY_ITEM:DROP_MODE, 1)"
            handler="drop_item"
            params="quantity=@@UI:DROP_DESTROY_ITEM:ITEM:QUANTITY" />
    <action cond="ne(@UI:DROP_DESTROY_ITEM:DROP_MODE, 1)"
            handler="destroy_item"
            params="quantity=@@UI:DROP_DESTROY_ITEM:ITEM:QUANTITY" />
  </proc>
  <!-- modal box to confirm destruction of the item -->
  <group type="modal"
         id="drop_destroy_item_confirm_modal"
         exit_click_out="true"
         posref="TL TL"
         x="-8"
         y="8"
         w="104"
         h="96"
         on_enter="proc"
         options="skin_modal"
         on_enter_params="confirm_drop_destroy_item">
    <view type="bitmap"
          id="warning"
          posref="TL TL"
          x="4"
          y="-4"
          global_color="false"
          texture="w_warning_2.tga" />
    <view type="text"
          id="destroy_text"
          posref="TL TL"
          x="20"
          y="-5"
          color="233 197 42 255"
          fontsize="12"
          shadow="true"
          global_color="false"
          hardtext="uimDestroy" />
    <view type="text"
          id="drop_text"
          posref="TL TL"
          x="20"
          y="-5"
          color="233 197 42 255"
          fontsize="12"
          shadow="true"
          global_color="false"
          hardtext="uimDrop" />
    <ctrl type="sheet"
          id="sheet"
          value="UI:DROP_DESTROY_ITEM:ITEM"
          posparent="parent"
          posref="MM MM"
          y="0"
          x="0"
          use_quantity="false" />
    <view type="text"
          id="disp_number"
          posref="MR MM"
          posparent="sheet"
          x="16"
          y="-1"
          color="255 255 255 255"
          fontsize="12"
          shadow="true"
          global_color="false"
          hardtext="" />
    <!-- link to display the right number of item -->
    <link expr="ifthenelse(eq(@UI:DROP_DESTROY_ITEM:ITEM:QUANTITY, 1), '', str('x', @UI:DROP_DESTROY_ITEM:ITEM:QUANTITY))"
          target="disp_number:hardtext" />
    <link expr="ifthenelse(eq(@UI:DROP_DESTROY_ITEM:ITEM:QUANTITY, 1), 0, -10)"
          target="sheet:x" />
    <instance template="button_ok_cancel"
              posref="BR BR"
              x="-4"
              y="4"
              onclick_ok="proc"
              onclick_ok_param="confirm_drop_destroy_item"
              onclick_cancel="leave_modal"
              onclick_cancel_param="" />
    <!-- link to display the right text (drop or destroy) -->
    <link expr="eq(@UI:DROP_DESTROY_ITEM:DROP_MODE, 1)"
          target="drop_text:active" />
    <link expr="ne(@UI:DROP_DESTROY_ITEM:DROP_MODE, 1)"
          target="destroy_text:active" />
  </group>
  <!-- ********************************************************* -->
  <!-- *     AUTOMATIC OPENING / RESTORING OF PLAYER INVENTORY * -->
  <!-- ********************************************************* -->
  <proc id="memorize_inventory_state">
    <!-- memorize previous state -->
    <!-- <action handler="set" params="dblink=%bag1_open_value|value=isOpen('ui:interface:userbag1')"/>
        <action handler="set" params="dblink=%bag2_open_value|value=isOpen('ui:interface:userbag2')"/>
        <action handler="set" params="dblink=%bag3_open_value|value=isOpen('ui:interface:userbag3')"/>
        <action handler="set" params="dblink=%bag4_open_value|value=isOpen('ui:interface:userbag4')"/>
        <action handler="set" params="dblink=%bags_open_value|value=isOpen('ui:interface:userbags')"/>
        <action handler="set" params="dblink=%player_open_value|value=isOpen('ui:interface:player')"/>
        <action handler="set" params="dblink=%money_open_value|value=isOpen('ui:interface:usermoney')"/> -->
    <action handler="set"
            params="dblink=%inventory_open_value|value=isOpen('ui:interface:inventory')" />
    <!-- force to open the inventory -->
    <!-- <action handler="set_open" cond="le(1,@%bag_nb)" params="target=ui:interface:userbags|open='true'"/>
        <action handler="set_open" cond="le(1,@%bag_nb)" params="target=ui:interface:userbag1|open='true'"/>    
        <action handler="set_open" cond="le(2,@%bag_nb)" params="target=ui:interface:userbag2|open='true'"/>
        <action handler="set_open" cond="le(3,@%bag_nb)" params="target=ui:interface:userbag3|open='true'"/>
        <action handler="set_open" cond="le(4,@%bag_nb)" params="target=ui:interface:userbag4|open='true'"/>
        <action handler="set_open" params="target=ui:interface:player|open='true'"/>
        <action handler="set_open" params="target=ui:interface:usermoney|open='true'"/> -->
    <action handler="set_open"
            params="target=ui:interface:inventory|open='true'" />
    <!-- reset flag to see if the user has opened the inventory -->
    <!--<action handler="set" params="dblink=%bag1_touched|value=0"/>
        <action handler="set" params="dblink=%bag2_touched|value=0"/>
        <action handler="set" params="dblink=%bag3_touched|value=0"/>
        <action handler="set" params="dblink=%bag4_touched|value=0"/>
        <action handler="set" params="dblink=%bags_touched|value=0"/>
        <action handler="set" params="dblink=%player_touched|value=0"/>
        <action handler="set" params="dblink=%money_touched|value=0"/>-->
    <action handler="set"
            params="dblink=%inventory_touched|value=0" />
  </proc>
  <proc id="restore_inventory_state">
    <!--<action handler="set_open" cond="and(eq(@%bag1_touched, 0), le(1,@%bag_nb))" params="target=ui:interface:userbag1|open=@@%bag1_open_value"/>
        <action handler="set_open" cond="and(eq(@%bag2_touched, 0), le(2,@%bag_nb))" params="target=ui:interface:userbag2|open=@@%bag2_open_value"/>
        <action handler="set_open" cond="and(eq(@%bag3_touched, 0), le(3,@%bag_nb))" params="target=ui:interface:userbag3|open=@@%bag3_open_value"/>
        <action handler="set_open" cond="and(eq(@%bag4_touched, 0), le(4,@%bag_nb))" params="target=ui:interface:userbag4|open=@@%bag4_open_value"/>
        <action handler="set_open" cond="and(eq(@%bags_touched, 0), le(1,@%bag_nb))" params="target=ui:interface:userbags|open=@@%bags_open_value"/>    
        <action handler="set_open" cond="eq(@%player_touched, 0)" params="target=ui:interface:player|open=@@%player_open_value"/>
        <action handler="set_open" cond="eq(@%money_touched, 0)" params="target=ui:interface:usermoney|open=@@%money_open_value"/>-->
    <action handler="set_open"
            cond="eq(@%inventory_touched, 0)"
            params="target=ui:interface:inventory|open=@@%inventory_open_value" />
  </proc>
  <!-- modal box -->
  <template name="modal_border"
            posparent="parent">
    <view type="bitmap"
          id="tlb"
          texture="W_modal_TL.tga"
          posparent="#posparent"
          posref="TL TL" />
    <view type="bitmap"
          id="trb"
          texture="W_modal_TR.tga"
          posparent="#posparent"
          posref="TR TR" />
    <view type="bitmap"
          id="brb"
          texture="W_modal_BR.tga"
          posparent="#posparent"
          posref="BR BR" />
    <view type="bitmap"
          id="blb"
          texture="W_modal_BL.tga"
          posparent="#posparent"
          posref="BL BL" />
    <view type="bitmap"
          id="tb"
          texture="W_modal_T.tga"
          posparent="#posparent"
          posref="TM TM"
          scale="true"
          sizeref="w"
          w="-8"
          h="4" />
    <view type="bitmap"
          id="bb"
          texture="W_modal_B.tga"
          posparent="#posparent"
          posref="BM BM"
          scale="true"
          sizeref="w"
          w="-8"
          h="4" />
    <view type="bitmap"
          id="lb"
          texture="W_modal_L.tga"
          posparent="#posparent"
          posref="ML ML"
          scale="true"
          sizeref="h"
          h="-8"
          w="4" />
    <view type="bitmap"
          id="rb"
          texture="W_modal_R.tga"
          posparent="#posparent"
          posref="MR MR"
          scale="true"
          sizeref="h"
          h="-8"
          w="4" />
  </template>
  <!-- *************************** -->
  <!-- *  COMBO BOX DEFINITIONS  * -->
  <!-- *************************** -->
  <!-- the modal Menu opened on a combo box 's click -->
  <group type="menu"
         id="combo_box_select_menu"
         posref="BL TL"
         x="0"
         y="0"
         mouse_pos="false"
         space="2"
         shadow="false"
         color="255 255 255 128"
         shadow_color="0 0 0 255"
         color_over="255 255 255 255"
         shadow_color_over="0 0 0 255"
         color_grayed="0 0 0 255"
         shadow_color_grayed="155 155 155 255"
         fontsize="12"
         highlight_over="255 255 255 128"
         force_inside_screen="true"></group>
  <group type="menu"
         id="combo_box_measure_menu"
         posref="BL TL"
         x="0"
         y="0"
         active="false"
         mouse_pos="false"
         space="2"
         shadow="false"
         color="255 255 255 128"
         shadow_color="0 0 0 255"
         color_over="255 255 255 255"
         shadow_color_over="0 0 0 255"
         color_grayed="0 0 0 255"
         shadow_color_grayed="155 155 155 255"
         fontsize="12"
         highlight_over="255 255 255 128"
         force_inside_screen="true" />
  <!-- the common children definitions of a combo box -->
  <!-- keep is true because this template is used in the teditcmd template -->
  <template name="combo_box_def1"
            keep="true"
            render_layer="0">
    <!-- DECORATION -->
    <instance template="box_widget"
              render_layer="#render_layer"
              id="back"
              sizeref="wh"
              w="0"
              h="0" />
    <view type="bitmap"
          render_layer="#render_layer"
          id="arrow"
          posref="MR MR"
          x="-4"
          texture="W_arrow_down_2.tga" />
    <!-- SYSTEM -->
    <view type="text"
          id="text"
          render_layer="#render_layer"
          posref="ML ML"
          x="2" />
    <ctrl type="button"
          render_layer="#render_layer"
          button_type="push_button"
          id="select"
          sizeref="wh"
          w="0"
          h="0"
          col_over="255 255 255 90"
          tx_over="blank.tga"
          scale="true" />
  </template>
  <!-- ******************* -->
  <!-- *    STYLES       * -->
  <!-- ******************* -->
  <!-- Common Style of a Modal Container. user should define 
        - the "modal_parent" window
        - and the "on_enter" ActionHandler to support all "Modal Container"     aspects.
-->
  <style style="container_modal"
         type="container"
         movable="true"
         resizer="false"
         global_color="false"
         openable="false"
         opened="true"
         active="false"
         escapable="true"
         right_button="true" />
  <!-- Common Style for an OK Button. User should define:
        - "onclick_l" and "params_l"
        - x, y, posparent and posref
-->
  <style style="button_ok"
         type="text_button"
         id="ok"
         button_type="push_button"
         tx_normal="w_text_button_normal"
         tx_pushed="w_text_button_pushed"
         tx_over="w_text_button_over"
         global_color_normal="true"
         global_color_over="true"
         global_color_pushed="true"
         text_y="-2"
         fontsize="10"
         shadow="true"
         case_mode="%case_upper"
         wmargin="8" />
  <!-- Common Style for a Cancel Button. By default positioned according to the "ok" button. User should define:
        - "onclick_l" and "params_l"
-->
  <style style="button_cancel"
         type="text_button"
         id="cancel"
         button_type="push_button"
         tx_normal="w_text_button_normal"
         tx_pushed="w_text_button_pushed"
         tx_over="w_text_button_over"
         global_color_normal="true"
         global_color_over="true"
         global_color_pushed="true"
         text_y="-2"
         fontsize="10"
         shadow="true"
         case_mode="%case_upper"
         wmargin="8" />
  <!-- Group of two ok, cancel buttons
-->
  <template name="button_ok_cancel"
            id="ok_cancel"
            ok_text="uittOK"
            cancel_text="uittCancel"
            posparent="parent"
            posref="BM TM"
            onclick_ok=""
            onclick_ok_param=""
            onclick_cancel=""
            onclick_cancel_param=""
            x="0"
            y="0"
            keep="true"
            tooltip_ok=""
            avoid_resize_parent="false">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           child_resize_w="true"
           child_resize_h="true"
           x="#x"
           y="#y"
           avoid_resize_parent="#avoid_resize_parent">
      <ctrl style="button_ok"
            x="0"
            y="0"
            posref="TL TL"
            text_y="-2"
            onclick_l="#onclick_ok"
            params_l="#onclick_ok_param"
            hardtext="#ok_text"
            tooltip="#tooltip_ok" />
      <ctrl style="button_cancel"
            x="4"
            posparent="ok"
            text_y="-2"
            posref="TR TL"
            onclick_l="#onclick_cancel"
            params_l="#onclick_cancel_param"
            hardtext="#cancel_text" />
    </group>
  </template>
  <!-- Common Style for a Close Button.
-->
  <style style="button_close"
         type="button"
         id="close"
         button_type="push_button"
         posref="TR TR"
         x="0"
         y="0"
         tx_normal="W_close_1.tga"
         tx_pushed="W_close_1.tga"
         tx_over="W_button_12_over.tga"
         global_color_normal="false"
         global_color_pushed="false" />
  <!-- Common Style for a text Button. User should define:
        - id
        - hardtext
        - "onclick_l" and "params_l"
        - x, y, posparent and posref
-->
  <style style="text_button_16"
         type="text_button"
         button_type="push_button"
         tx_normal="w_text_button_normal"
         tx_pushed="w_text_button_pushed"
         tx_over="w_text_button_over"
         global_color_normal="true"
         global_color_over="true"
         global_color_pushed="true"
         text_y="-2"
         fontsize="10"
         shadow="true"
         case_mode="%case_upper"
         wmargin="8"
         text_color_normal="255 255 255 128"
         text_color_pushed="255 255 255 255"
         text_color_over="255 255 255 255" />
  <style style="text_button_header"
         type="text_button"
         button_type="push_button"
         tx_normal="w_text_button_normal"
         tx_pushed="w_text_button_pushed"
         tx_over="w_text_button_over"
         text_y="-2"
         fontsize="10"
         shadow="true"
         case_mode="%case_upper"
         wmargin="8"
         text_color_normal="255 255 255 128"
         text_color_pushed="255 255 255 255"
         text_color_over="255 255 255 255"
         global_color_normal="false"
         global_color_over="false"
         global_color_pushed="false"
         text_global_color_normal="false"
         text_global_color_pushed="false"
         text_global_color_over="false"
         text_header_color="true" />
  <style style="new_element_header"
         type="text_button"
         button_type="push_button"
         tx_normal="w_text_button_normal"
         tx_pushed="w_text_button_pushed"
         tx_over="w_text_button_over"
         global_color_normal="true"
         global_color_over="true"
         global_color_pushed="true"
         text_y="-2"
         fontsize="10"
         shadow="true"
         case_mode="%case_upper"
         wmargin="8"
         text_global_color_normal="true"
         text_global_color_pushed="true"
         text_global_color_over="true"
         text_color_normal="255 255 255 128"
         text_color_pushed="255 255 255 255"
         text_color_over="255 255 255 255"
         text_header_color="true" />
  <style style="new_element_content"
         type="text_button"
         button_type="push_button"
         tx_normal="w_text_button_normal"
         tx_pushed="w_text_button_pushed"
         tx_over="w_text_button_over"
         text_y="-2"
         fontsize="10"
         shadow="true"
         case_mode="%case_upper"
         wmargin="8"
         global_color_normal="true"
         global_color_over="true"
         global_color_pushed="true"
         text_global_color_normal="true"
         text_global_color_pushed="true"
         text_global_color_over="true"
         text_color_normal="255 255 255 128"
         text_color_pushed="255 255 255 255"
         text_color_over="255 255 255 255" />
  <style style="qh_button"
         type="text_button"
         button_type="radio_button"
         tx_normal="qh_off"
         tx_pushed="qh_on"
         tx_over="qh_off"
         wmin="208"
         wmargin="8"
         global_color_normal="true"
         global_color_over="true"
         global_color_pushed="false"
         color="255 255 255 128"
         col_over="255 255 255 0"
         col_pushed="255 128 0 192"
         text_y="-2"
         fontsize="12"
         shadow="true"
         text_color_normal="255 255 255 255"
         text_color_pushed="255 255 255 255"
         text_color_over="255 255 255 255"
         text_shadow_color_normal="0 0 0 255"
         text_shadow_color_pushed="0 0 0 255"
         text_shadow_color_over="0 0 0 255"
         text_global_color_normal="true"
         text_global_color_pushed="false"
         text_global_color_over="false" />
  <style style="defense_style_button"
         type="text_button"
         button_type="radio_button"
         tx_normal="qh_off"
         tx_pushed="qh_on"
         tx_over="qh_off"
         wmin="86"
         wmargin="8"
         global_color_normal="true"
         global_color_over="true"
         global_color_pushed="false"
         color="255 255 255 128"
         col_over="255 255 255 0"
         col_pushed="255 190 0 192"
         text_y="-3"
         fontsize="12"
         shadow="true"
         text_color_normal="255 255 255 160"
         text_color_pushed="255 255 255 255"
         text_color_over="255 255 255 255"
         text_shadow_color_normal="0 0 0 255"
         text_shadow_color_pushed="0 0 0 255"
         text_shadow_color_over="0 0 0 255"
         text_global_color_normal="true"
         text_global_color_pushed="false"
         text_global_color_over="false" />
  <style style="defense_button"
         type="button"
         button_type="radio_button"
         tx_normal="W_slot_item_selected.tga"
         tx_pushed="W_slot_item_selected.tga"
         tx_over="W_slot_item_selected.tga"
         color="255 255 255 0"
         col_over="255 255 255 255"
         col_pushed="255 190 0 255"
         global_color_normal="true"
         global_color_over="true"
         global_color_pushed="false" />
  <style style="quit_button"
         type="text_button"
         button_type="push_button"
         tx_normal="Quit_button_normal"
         tx_pushed="Quit_button_pushed"
         tx_over="Quit_button_over"
         wmargin="12"
         global_color_normal="false"
         global_color_over="false"
         global_color_pushed="false"
         color="255 255 255 255"
         col_over="255 255 255 255"
         col_pushed="255 255 255 255"
         text_y="-3"
         fontsize="14"
         shadow="true"
         text_color_pushed="255 255 255 255"
         text_color_over="255 255 255 255"
         text_shadow_color_normal="0 0 0 255"
         text_shadow_color_pushed="0 0 0 255"
         text_shadow_color_over="0 0 0 255"
         text_global_color_normal="false"
         text_global_color_pushed="false"
         text_global_color_over="false" />
  <!-- Common Style for a Tab Button. User should define:
        - id: eg "tab1"
        - posparent: eg "tab0"
        - hardtext
        - x="0" and posref="TL TL" for tab0
-->
  <style style="tab_button_16"
         type="tab_button"
         button_type="radio_button"
         x="-2"
         posref="TR TL"
         tx_normal="w_text_button_normal"
         tx_pushed="w_text_button_pushed"
         tx_over="w_text_button_over"
         global_color_normal="true"
         global_color_over="true"
         global_color_pushed="true"
         text_y="-2"
         fontsize="10"
         shadow="true"
         case_mode="%case_upper"
         wmargin="8"
         text_color_normal="255 255 255 128"
         text_color_pushed="255 255 255 255"
         text_color_over="255 255 255 255" />
  <style style="tab_button_new"
         type="tab_button"
         button_type="radio_button"
         x="0"
         posref="TR TL"
         tx_normal="w_tab_normal"
         tx_pushed="w_tab_pushed"
         tx_over="w_tab_over"
         global_color_normal="true"
         global_color_over="true"
         global_color_pushed="true"
         color="255 255 255 255"
         col_over="255 255 255 255"
         col_pushed="255 255 255 255"
         text_y="-4"
         fontsize="10"
         shadow="true"
         case_mode="%case_upper"
         wmargin="8"
         text_color_normal="255 255 255 128"
         text_color_pushed="255 255 255 255"
         text_color_over="255 255 255 255"
         text_global_color_normal="true"
         text_global_color_pushed="false"
         text_global_color_over="true" />
  <!-- **************** -->
  <!-- *  MESSAGE BOX * -->
  <!-- **************** -->
  <!-- Simple Message Box with just a OK button -->
  <group type="modal"
         id="message_box"
         exit_click_out="true"
         posref="MM MM"
         w="250"
         child_resize_h="true"
         child_resize_hmargin="46"
         on_enter="leave_modal"
         options="skin_modal">
    <view type="text"
          id="text"
          posref="TL TL"
          line_maxw="234"
          x="8"
          y="-12"
          w="0"
          h="0"
          color="255 255 255 255"
          fontsize="12"
          shadow="true"
          multi_line="true"
          multi_line_space="0"
          case_mode="%case_first_sentence_letter_up" />
    <ctrl style="button_ok"
          posref="BM BM"
          x="0"
          y="8"
          onclick_l="leave_modal"
          hardtext="uittOK"
          avoid_resize_parent="true" />
  </group>
  <!-- Message Box with just a OK/Browse Faq button -->
  <proc id="proc_browse_faq">
    <!--
        NB : do not leave the window here, this way the user can refer to the message in the help message box
        <action handler="leave_modal" />
        -->
    <action handler="browse_faq"
            params="" />
  </proc>
  <proc id="proc_message_box_with_help_ok">
    <action handler="leave_modal" />
    <!-- must leave modal first if another modal is to be displayed after this one -->
    <action handler=""
            params="" />
  </proc>
  <group type="modal"
         id="message_box_with_help"
         exit_click_out="false"
         posref="MM MM"
         w="250"
         child_resize_h="true"
         child_resize_hmargin="46"
         on_enter="proc"
         on_enter_params="proc_message_box_with_help_ok"
         on_deactive="proc"
         on_deactive_params="proc_message_box_with_help_ok"
         escapable="true"
         options="skin_modal">
    <view type="text"
          id="text"
          posref="TL TL"
          line_maxw="234"
          x="8"
          y="-12"
          w="0"
          h="0"
          color="255 255 255 255"
          fontsize="12"
          shadow="true"
          multi_line="true"
          multi_line_space="0"
          case_mode="%case_first_sentence_letter_up" />
    <ctrl style="button_ok"
          id="ok"
          posref="BM BL"
          x="2"
          y="8"
          onclick_l="proc"
          params_l="proc_message_box_with_help_ok"
          hardtext="uittOK"
          avoid_resize_parent="true" />
    <ctrl style="button_ok"
          id="browse_faq"
          posref="BM BR"
          x="-2"
          y="8"
          onclick_l="proc"
          params_l="proc_browse_faq"
          hardtext="uittBrowseFaq"
          avoid_resize_parent="true" />
  </group>
  <!-- Message Box with just a OK/Cancel button -->
  <proc id="proc_valid_message_box_ok">
    <action handler="leave_modal" />
    <!-- must leave modal first if another modal is to be displayed after this one -->
    <action handler=""
            params="" />
    <!-- Replaced with the user one -->
  </proc>
  <proc id="proc_valid_message_box_cancel">
    <action handler="leave_modal" />
    <!-- must leave modal first if another modal is to be displayed after this one -->
    <action handler=""
            params="" />
    <!-- Replaced with the user one -->
  </proc>
  <group type="modal"
         id="valid_message_box"
         exit_click_out="true"
         posref="MM MM"
         w="306"
         child_resize_h="true"
         child_resize_hmargin="46"
         on_enter="proc"
         on_enter_params="proc_valid_message_box_ok"
         options="skin_modal">
    <group id="icon_group"
           posref="TL TL"
           x="4"
           y="-8"
           w="24"
           h="24">
      <view type="bitmap"
            id="icon"
            posref="MM MM"
            texture=""
            global_color="false" />
    </group>
    <view type="text"
          id="text"
          posref="TL TL"
          line_maxw="270"
          x="32"
          y="-12"
          w="0"
          h="0"
          color="255 255 255 255"
          fontsize="12"
          shadow="true"
          multi_line_space="0"
          multi_line="true"
          case_mode="%case_first_sentence_letter_up" />
    <instance template="button_ok_cancel"
              posref="BM BM"
              x="0"
              y="8"
              onclick_ok="proc"
              onclick_ok_param="proc_valid_message_box_ok"
              onclick_cancel="proc"
              onclick_cancel_param="proc_valid_message_box_cancel"
              avoid_resize_parent="true" />
  </group>
  <!-- common Style for Message Box For Important Proposal feature (join PVP etc...) -->
  <style style="container_proposal"
         type="container"
         w="260"
         h="512"
         pop_max_h="512"
         resizer="false"
         active="false"
         savable="false"
         openable="false"
         opened="true"
         movable="true" />
  <!-- ********************************** -->
  <!-- * SERVER IMPORTANT MESSAGE BOX   * -->
  <!-- ********************************** -->
  <!-- Vars describing the message -->
  <variable entry="UI:TEMP:SERVER_POPUP:TITLE"
            type="sint32"
            value="0" />
  <!-- Change it to access the view text -->
  <define id="server_message_box_content_view_text"
          value="ui:interface:server_message_box:content:inside:limited_h:text" />
  <!-- The modal -->
  <group style="container_proposal"
         w="256"
         max_w="1024"
         pop_max_w="1024"
         max_h="700"
         pop_max_h="700"
         id="server_message_box"
         right_button="false"
         title="UI:TEMP:SERVER_POPUP:TITLE"
         title_class="text_dyn_string">
    <group id="header_opened"
           h="16"
           posref="TL TL" />
    <group id="content"
           child_resize_h="true"
           child_resize_hmargin="10">
      <!-- Description -->
      <group id="inside"
             sizeref="w"
             w="-6"
             posref="TL TL"
             y="-8"
             child_resize_h="true">
        <group id="limited_h"
               posref="TL TL"
               x="0"
               y="0"
               sizeref="w"
               w="0"
               child_resize_h="true"
               child_resize_hmargin="6"
               max_h="500">
          <view type="text"
                id="text"
                posref="MM MM"
                x="0"
                y="0"
                color="255 255 255 255"
                fontsize="10"
                shadow="true"
                multi_line="true"
                multi_line_space="0"
                global_color="false" />
        </group>
      </group>
      <!-- Choice -->
      <ctrl style="button_ok"
            id="ok"
            posref="BM TM"
            x="0"
            y="-8"
            posparent="inside"
            onclick_l="hide:server_message_box"
            hardtext="uittOK" />
    </group>
  </group>
  <tree node="server_message_box" />
  <!-- ********************* -->
  <!-- *  ITEM/BRICK HELP  * -->
  <!-- ********************* -->
  <!-- Max Help opened. "Infinity" -->
  <define id="MAX_HELP_WINDOW"
          value="8" />
  <!-- Variables for Sheet Help Widget -->
  <variable entry="UI:glob_var:help:$i:SHEET"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <variable entry="UI:glob_var:help:$i:QUALITY"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <variable entry="UI:glob_var:help:$i:QUANTITY"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <variable entry="UI:glob_var:help:$i:SLOT_TYPE"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <variable entry="UI:glob_var:help:$i:USER_COLOR"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <variable entry="UI:glob_var:help:$i:NAMEID"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <variable entry="UI:glob_var:help:$i:INFO_VERSION"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <variable entry="UI:glob_var:help:$i:ENCHANT"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <variable entry="UI:glob_var:help:$i:RM_CLASS_TYPE"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <variable entry="UI:glob_var:help:$i:RM_FABER_STAT_TYPE"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <variable entry="UI:glob_var:help:$i:PREREQUISIT_VALID"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <!-- Variables for Sheet Help Bricks Widget -->
  <template name="help_def_bricks"
            index="">
    <variable entry="UI:glob_var:help:$i:BRICKS:#index:SHEET"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
  </template>
  <vector template="help_def_bricks"
          index="$i"
          _size="64" />
  <!-- Same for requirement Bricks -->
  <template name="help_def_req_bricks"
            index="">
    <variable entry="UI:glob_var:help:$i:REQ_BRICKS:#index:SHEET"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:REQ_BRICKS:#index:LOCKED"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
  </template>
  <vector template="help_def_req_bricks"
          index="$i"
          _size="64" />
  <!-- Same for item list -->
  <template name="help_def_items"
            index="">
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:SHEET"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:QUALITY"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:QUANTITY"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:SLOT_TYPE"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:USER_COLOR"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:NAMEID"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:INFO_VERSION"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:ENCHANT"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:RM_CLASS_TYPE"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:RM_FABER_STAT_TYPE"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
    <variable entry="UI:glob_var:help:$i:BUILD_ITEMS:#index:PREREQUISIT_VALID"
              type="sint32"
              value="0"
              size="%MAX_HELP_WINDOW" />
  </template>
  <vector template="help_def_items"
          index="$i"
          _size="64" />
  <!-- Variables for Sheet Help: Mps -->
  <variable entry="UI:glob_var:help:$i:MP_ITEM_PART_CHOICE"
            type="sint32"
            value="0"
            size="%MAX_HELP_WINDOW" />
  <!-- Stat Craft Mp template -->
  <define id="MAX_STAT_MP_CRAFT"
          value="20" />
  <template name="template_mp_stat"
            id=""
            x="0"
            y="-2"
            posparent="text"
            posref="">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           x="#x"
           y="#y"
           w="250"
           h="16"
           active="false">
      <view type="text"
            id="text"
            line_maxw="180"
            posref="ML ML"
            over_extend_view_text="true" />
      <view type="bar"
            id="bar"
            posref="MR MR"
            mini="true"
            value="0"
            range="100" />
    </group>
  </template>
  <!-- Template for MP statistics (used in info and in botchat validation) -->
  <template name="template_info_mp_stats"
            id=""
            posparent=""
            dbcombo=""
            cb_handler=""
            cb_params="">
    <group id="mp_stats"
           sizeparent="parent"
           sizeref="w"
           w="-12"
           child_resize_h="true"
           child_resize_hmargin="8"
           posparent="#posparent"
           posref="BL TL"
           x="0"
           y="0">
      <!-- main combo to select the item part to watch -->
      <group type="combo_box"
             id="item_part_choice"
             w="200"
             h="20"
             value="#dbcombo"
             posref="TM TM"
             x="0"
             y="-4">
        <instance template="combo_box_def1" />
      </group>
      <link expr="@#dbcombo"
            action="#cb_handler"
            params="#cb_params" />
      <!-- The item part info Icon -->
      <view type="bitmap"
            id="icon"
            posparent="item_part_choice"
            posref="ML MR"
            scale="true"
            x="-2"
            y="0"
            w="24"
            h="24"
            global_color="false" />
      <!-- header text for this item part -->
      <view type="text"
            id="text"
            multi_line="true"
            multi_line_space="0"
            posref="TL TL"
            x="0"
            y="-32" />
      <!-- stats -->
      <vector template="template_mp_stat"
              id="stat$i"
              _size="%MAX_STAT_MP_CRAFT"
              _firstpos="BL TL"
              _xfirst="0"
              _yfirst="-6"
              _nextpos="BL TL" />
    </group>
  </template>
  <!-- There can be 2 list of bricks in the Action Help: phrase descritopn, and Brick requirements. (Used in info and botchat validation) -->
  <template name="template_info_list_brick"
            type=""
            id=""
            posparent=""
            param_deltax=""
            force_keep=""
            brickdb=""
            sizeref="w"
            child_resize_w="false"
            child_resize_wmargin="0"
            line_maxw="170"
            multi_line_maxw_only="false" 
            xcost="215"
            auto_grayed="false"
            global_color="true">
    <group type="#type"
           id="#id"
           sizeparent="parent"
           sizeref="#sizeref"
           w="-12"
           child_resize_w="#child_resize_w"
           child_resize_wmargin="#child_resize_wmargin"
           child_resize_h="true"
           child_resize_hmargin="8"
           posparent="#posparent"
           posref="BL TL"
           x="0"
           y="0"
           xitem="2"
           yitem="-2"
           xtext="32"
           ytext="-2"
           xcost="#xcost"
           ycost="-8"
           param_deltax="#param_deltax"
           hspace="4"
           array="false"
           value="#brickdb"
           selection="false"
           auto_grayed="#auto_grayed"
           gray_text_with_ctrl="#auto_grayed"
           dragable="false"
           nature="sbrick"
           brick_over="false"
           onclick_r="open_sbrick_help"
           params_r="force_keep=#force_keep"
           over_color="%bot_chat_sheet_selection_normal"
           over_col_pushed="%bot_chat_sheet_selection_pushed"
           over_col_over="%bot_chat_sheet_selection_over"
           color="255 255 255 255"
           global_color="#global_color"
           fontsize="8"
           shadow="true"
           multi_line="true"
           multi_line_maxw_only="#multi_line_maxw_only"
           multi_line_space="0"
           line_maxw="#line_maxw">
      <!-- the scroll -->
      <ctrl style="skin_scroll"
            id="scroll_row"
            posref="TL TL"
            y="-2" />
      <!-- the group to scroll NO SCROLL (caller scroll) -->
      <group id="list"
             sizeref="#sizeref"
             child_resize_w="#child_resize_w"
             posref="TL TL"
             max_h="10000"
             x="8"
             y="0"
             w="-8"
             h="0"
             global_color="#global_color" />
    </group>
  </template>
  <!-- There can be 1 list of items: items built by a buuilding  -->
  <template name="template_info_list_item"
            type=""
            id=""
            posparent=""
            force_keep=""
            itemdb=""
            auto_grayed="false">
    <group type="#type"
           id="#id"
           sizeparent="parent"
           sizeref="w"
           w="-12"
           child_resize_h="true"
           child_resize_hmargin="8"
           posparent="#posparent"
           posref="BL TL"
           x="0"
           y="0"
           xitem="2"
           yitem="-2"
           xtext="48"
           ytext="-2"
           hspace="4"
           array="false"
           value="#itemdb"
           selection="false"
           auto_grayed="#auto_grayed"
           gray_text_with_ctrl="#auto_grayed"
           use_quantity="false"
           dragable="false"
           nature="item"
           onclick_r="open_item_help"
           params_r="force_keep=#force_keep"
           over_color="%bot_chat_sheet_selection_normal"
           over_col_pushed="%bot_chat_sheet_selection_pushed"
           over_col_over="%bot_chat_sheet_selection_over"
           color="255 255 255 255"
           fontsize="8"
           shadow="true"
           multi_line="true"
           multi_line_space="0"
           line_maxw="150">
      <!-- the scroll -->
      <ctrl style="skin_scroll"
            id="scroll_row"
            posref="TL TL"
            y="-2" />
      <!-- the group to scroll NO SCROLL (caller scroll) -->
      <group id="list"
             sizeref="w"
             posref="TL TL"
             max_h="10000"
             x="8"
             y="0"
             w="-8"
             h="0" />
    </group>
  </template>
  <!-- template for mission requesite -->
  <template name="template_mission_prereq"
            id=""
            nb=""
            posparent=""
            posref=""
            x="0"
            y="0">
    <view type="text"
          id="text_#nb"
          multi_line="false"
          posparent="#posparent"
          posref="BL TR" />
    <view type="text_id"
          id="#id"
          posparent="#posparent"
          multi_line="true"
          multi_line_space="0"
          posref="BL TL" />
  </template>
  <proc id="active_sheet_help">
    <action handler="set"
            params="target_property=ui:interface:@0:content:scroll_text:text_list:char3d:scene:char:anim|value=0" />
    <action handler="set"
            params="target_property=ui:interface:@0:content:scroll_text:text_list:char3d:scene:camface:posz|value=add(0.1,getprop('ui:interface:@0:content:scroll_text:text_list:char3d:scene:char:headz'))" />
    <action handler="set"
            params="target_property=ui:interface:@0:content:scroll_text:text_list:char3d:scene:camface:tgtz|value=add(0.16,getprop('ui:interface:@0:content:scroll_text:text_list:char3d:scene:char:headz'))" />
  </proc>
  <!-- The Sheet (item/brick) Help Widget -->
  <!-- if you change w="296", change also the line_maxw of id="text" below -->
  <template name="sheet_help"
            id=""
            index="">
    <group type="container"
           id="#id"
           w="296"
           title_delta_max_w="-80"
           h="80"
           title=""
           global_color="false"
           options="layer0_info"
           opened="true"
           openable="false"
           movable="true"
           resizer="false"
           win_priority="%win_priority_high"
           active="false"
           savable="false"
           escapable="true"
           header_color="UI:SAVE:WIN:COLORS:INFOS"
           on_active="proc"
           on_active_params="active_sheet_help|#id"
           on_deactive="on_close_help"
           on_deactive_params="#index"
           y="700">
      <group id="header_closed"
             x="0"
             y="0"
             w="0"
             h="16"
             posref="TL TL"></group>
      <group id="header_opened"
             x="0"
             y="0"
             w="0"
             h="16"
             posref="TL TL">
        <!-- The INFO icon
                        <view type="bitmap" id="ico" texture="W_user_info.tga" posref="ML ML" x="0" y="0" global_color="false" />
                        -->
        <!-- The "PUNAISE" button -->
        <ctrl type="button"
              button_type="toggle_button"
              id="keep"
              posref="MR MR"
              x="-16"
              y="0"
              tx_normal="pin_off.tga"
              tx_pushed="pin_on.tga"
              tx_over="W_button_16_over.tga"
              global_color_normal="false"
              global_color_pushed="false"
              global_color_over="false"
              tooltip="uittKeepInfo"
              onclick_l="help_keep"
              params_l="#index" />
        <!--            
                        <ctrl style="text_button_16" button_type="toggle_button" id="keep" posref="MR MR" x="-16" y="1" wmargin="8" hardtext="uiKeepInfoButton" tooltip="uittKeepInfo" onclick_l="help_keep" params_l="#index" />
                        -->
      </group>
      <group id="content"
             x="0"
             y="0"
             w="0"
             child_resize_h="true"
             child_resize_hmargin="6"
             posref="TL TL">
        <!-- Item is in auto mode -->
        <ctrl type="sheet"
              id="ctrl_slot"
              use_slot_type_db_entry="true"
              nature="auto"
              value="UI:glob_var:help:#index"
              posref="TR TR"
              x="-4"
              y="-10"
              use_quantity="true" />
        <view type="text_id"
              id="creator"
              posparent="ctrl_slot"
              posref="BR TR"
              y="-2"
              dynamic_string="false"
              fontsize="12" />
        <view type="text"
              id="creator_header"
              posparent="creator"
              posref="ML MR"
              fontsize="12"
              hardtext="uiCreatorHeader"
              active="false" />
        <!-- the scroll text (with only one text) -->
        <group id="scroll_text"
               sizeref="w"
               posref="TL TL"
               w="0"
               y="-6"
               child_resize_h="true"
               child_resize_hmargin="8">
          <instance template="inner_thin_border_group" />
          <group id="minh"
                 posref="TL TL"
                 x="0"
                 y="0"
                 w="1"
                 h="42" />
          <group id="text_list"
                 posref="TL TL"
                 x="16"
                 y="-4"
                 sizeref="w"
                 w="-16"
                 child_resize_h="true"
                 max_h="392">
            <!-- the line_maxw is set up so the text does not override the Ctrl Sheet on the right (or not so much...) -->
            <view type="text"
                  id="text"
                  multi_line="true"
                  line_maxw="226"
                  multi_line_space="0"
                  posref="TL TL" />
            <!-- for item, pacts, .. -->
            <!-- For Phrases and title requirement only. 2 lists and a header for the second list -->
            <instance template="template_info_list_brick"
                      type="list_sheet_text"
                      id="list_brick_requirement"
                      force_keep="#index"
                      brickdb="UI:glob_var:help:#index:REQ_BRICKS"
                      posparent="text"
                      param_deltax="0"
                      auto_grayed="true" />
            <view type="text"
                  id="list_brick_header"
                  multi_line="true"
                  multi_line_space="0"
                  posparent="list_brick_requirement"
                  posref="BL TL"
                  y="-12" />
            <instance template="template_info_list_brick"
                      type="list_sheet_compo_brick"
                      id="list_brick"
                      force_keep="#index"
                      brickdb="UI:glob_var:help:#index:BRICKS"
                      posparent="list_brick_header"
                      param_deltax="13"
                      auto_grayed="false" />
            <!-- For raw materials only. group to display stats -->
            <instance template="template_info_mp_stats"
                      cb_handler="item_help_mp_change_item_part"
                      cb_params="#index"
                      posparent="text"
                      dbcombo="UI:glob_var:help:#index:MP_ITEM_PART_CHOICE" />
            <!-- For outpost building, list of items this building build -->
            <instance template="template_info_list_item"
                      type="list_sheet_text"
                      id="list_item"
                      force_keep="#index"
                      itemdb="UI:glob_var:help:#index:BUILD_ITEMS"
                      posparent="text" />
            <!-- For Cosmetic only 3D preview -->
            <group id="char3d"
                   posref="TL TL"
                   sizeref="w"
                   w="-16"
                   h="304"
                   x="0"
                   y="-46">
              <instance template="box_widget"
                        id="back"
                        posref="TL TL"
                        sizeref="wh"
                        w="0"
                        h="0"
                        x="0"
                        y="0"
                        inherit_gc_alpha="true" />
              <view type="bitmap"
                    id="black"
                    posparent="back"
                    posref="MM MM"
                    sizeref="wh"
                    w="-2"
                    h="-2"
                    inherit_gc_alpha="true"
                    scale="true"
                    texture="blank.tga"
                    color="0 0 0 80" />
              <scene3d id="scene"
                       sizeref="wh"
                       w="-2"
                       h="-2"
                       posparent="back"
                       posref="TL TL"
                       x="1"
                       y="-1"
                       curcam="camface"
                       curcs="env"
                       render_layer="-2"
                       user_interaction="true"
                       rotz_factor="0.017"
                       roty_factor="0.005"
                       roty_limit_min="-20"
                       roty_limit_max="15"
                       dist_factor="0.005"
                       dist_limit_min="4.0"
                       dist_limit_max="6.0"
                       ambient="128 96 64"
                       sun_ambient="0 0 0"
                       sun_diffuse="255 255 196"
                       sun_specular="0 0 0"
                       sun_direction="-1.0 1.0 -1.0">
                <character3d id="char"
                             dblink="UI:TEMP:CHAR3D"
                             pos="0.0 0.0 -1.75"
                             rot="0.0 0.0 0.0" />
                <camera id="camface"
                        fov="5"
                        pos="0.0 -5.0 0.0"
                        target="0.0 0.0 0"
                        roll="0" />
                <light id="back"
                       pos="0.0 28.2 1.6"
                       color="96 64 32"
                       near="1.0"
                       far="4.0" />
                <light id="lgt"
                       pos="0.0 25.3 2.48"
                       color="255 255 255"
                       near="1.0"
                       far="4.0" />
              </scene3d>
            </group>
            
            <!-- Item preview 3D window -->
            
            <group id="item_preview"
                   posref="TL TL"
                   sizeref="w"
                   w="200"
                   h="300"
                   x="0"
                   y="-60">
              
              <scene3d id="scene_item_preview" 
                       sizeref="wh"
                       w="-2"
                       h="-2"
                       posref="TL TL" 
                       x="1"
                       curcam="cam_item_preview"
                       user_interaction="true"
                       ambient="128 96 64"
                       sun_ambient="70 70 70"
                       sun_diffuse="255 255 196"
                       sun_specular="0 0 0"
                       sun_direction="-1.0 1.0 -1.0"
                       rotz_factor="0.017"
                       roty_factor="0.005"
                       dist_factor="0.2"
                       camz="10"
                       dist_limit_min="20.0"
                       dist_limit_max="80.0" >

                <character3d id="char"
                             dblink="UI:TEMP:CHAR3D"
                             pos="0.0 0.0 -1.8"
                             rot="0.0 0.0 -60.0"
                             anim="1" />
                <camera id="cam_item_preview"
                        fov="5" 
                        pos="0.0 -40.0 0.0"
                        target="0.0 0.0 -0.85" 
                        roll="0" />

                <light id="back" pos="0.0 28.2 1.6" color="96 64 32" near="1.0" far="4.0" />
                <light id="lgt" pos="0.0 25.3 2.48" color="255 255 255" near="1.0" far="4.0" />

              </scene3d>
              
            </group>
            
          </group>          
          <ctrl style="skin_scroll"
                id="sv"
                posref="TL TL"
                x="4"
                y="-4"
                target_stepy="14"
                target="text_list" />
        </group>
        <!-- the scroll text id (use for missions) -->
        <group id="scroll_text_id"
               posref="TL TL"
               w="0"
               y="-6"
               sizeref="w"
               child_resize_h="true"
               child_resize_hmargin="8">
          <instance template="inner_thin_border_group" />
          <group id="minh"
                 posref="TL TL"
                 x="0"
                 y="0"
                 w="1"
                 h="42" />
          <group id="text_list"
                 posref="TL TL"
                 x="12"
                 y="-4"
                 sizeref="w"
                 w="-64"
                 child_resize_h="true"
                 max_h="392">
            <view type="text"
                  id="text_title"
                  hardtext="uiMissionTitle"
                  multi_line="false"
                  posref="TL TL" />
            <view type="text_id"
                  id="text_title_id"
                  posparent="text_title"
                  multi_line="true"
                  multi_line_space="0"
                  x="10"
                  posref="BL TL" />
            <view type="text"
                  id="text_mission_description"
                  posparent="text_title_id"
                  x="-10"
                  hardtext="uiMissionDesc"
                  multi_line="false"
                  posref="BL TL" />
            <view type="text_id_formated"
                  id="text_id"
                  posparent="text_mission_description"
                  multi_line="true"
                  multi_line_space="0"
                  x="10"
                  posref="BL TL" />
            <!-- for item, pacts, .. -->
            <view type="text"
                  id="text_mission_prereq"
                  hardtext="uiMissionPrereq"
                  multi_line="false"
                  posparent="text_id"
                  x="-10"
                  posref="BL TL" />
            <!-- must do the first in special way -->
            <view type="text"
                  id="text_1"
                  multi_line="false"
                  posparent="text_mission_prereq"
                  posref="BL TL"
                  x="5" />
            <view type="text_id"
                  id="text_id_prereq_1"
                  posparent="text_1"
                  multi_line="true"
                  multi_line_space="0"
                  posref="TR TL" />
            <!-- next are relative each others -->
            <vector template="template_mission_prereq"
                    _size="15"
                    _firstindex="2"
                    id="text_id_prereq_$i"
                    nb="$i"
                    posparent="text_id_prereq_1"
                    _firstpos="BL TL"
                    _nextpos="BL TL" />
          </group>
          <ctrl style="skin_scroll"
                id="sv"
                posref="TL TL"
                x="4"
                y="-4"
                target="text_list" />
        </group>
      </group>
    </group>
    <tree node="#id" />
  </template>
  <!-- Instances -->
  <vector template="sheet_help"
          _size="%MAX_HELP_WINDOW"
          _firstpos=""
          _nextpos=""
          index="$i"
          id="sheet_help$i" />
  <!-- ***************** -->
  <!-- *  COMMON RULES * -->
  <!-- ***************** -->
  <define id="is_team_present"
          value="or(ne(@SERVER:GROUP:0:PRESENT,0),ne(@SERVER:GROUP:1:PRESENT,0),ne(@SERVER:GROUP:2:PRESENT,0),ne(@SERVER:GROUP:3:PRESENT,0),ne(@SERVER:GROUP:4:PRESENT,0),ne(@SERVER:GROUP:5:PRESENT,0),ne(@SERVER:GROUP:6:PRESENT,0),ne(@SERVER:GROUP:7:PRESENT,0))" />
  <define id="is_guild_present"
          value="ne(@SERVER:GUILD:NAME,0)" />
  <!-- ****************************** -->
  <!-- *  INVENTORIES COMMON STUFF  * -->
  <!-- ****************************** -->
  <!-- style of all free containers -->
  <style style="inv_container"
         type="container"
         w="350"
         h="310"
         resizer="true"
         pop_min_w="350"
         pop_min_h="110"
         pop_max_w="920"
         pop_max_h="1600"
         movable="true"
         active="false"
         opened="true"
         openable="false"
         global_color="false"
         global_color_over="true" />
  <style style="inv_container_guild"
         type="container"
         w="336"
         h="310"
         resizer="true"
         pop_min_w="336"
         pop_min_h="110"
         pop_max_w="920"
         pop_max_h="1600"
         movable="true"
         active="false"
         opened="true"
         openable="false"
         global_color="false"
         global_color_over="true" />
  <!-- template for the bulk and the weight -->
  <template name="tinv_nbslots_bulk_weight"
            id=""
            inv_branch_nb="256"
            inv_branch=""
            inv_bulk_max=""
            posparent="parent"
            posref="TL TL"
            x="0"
            y="0">
    <group id="#id"
           sizeref="w"
           h="16"
           posref="#posref">
      <group id="bulk_weight"
             w="128"
             h="16"
             posref="BR BR"
             posparent="#posparent">
        <view type="bitmap"
              id="weight"
              posref="MR MR"
              x="0"
              texture="W_weight.tga"
              global_color="false" />
        <view type="text"
              id="weight_txt"
              posparent="weight"
              posref="ML MR"
              y="-2"
              x="-2"
              color="255 255 255 255"
              global_color="false"
              shadow="true"
              fontsize="10" />
        <instance template="text_tt"
                  tooltip="uittInventoryWeight"
                  posparent="weight_txt" />
        <link expr="identity(getItemsWeight('#inv_branch',0,#inv_branch_nb),@#inv_branch)"
              target="weight_txt:hardtext" />
        <view type="bar"
              id="encombrement"
              mini="true"
              posref="MR MR"
              x="-48"
              range="#inv_bulk_max"
              color="%bulk_color" />
        <ctrl type="tooltip"
              id="encombrement_tt"
              posparent="encombrement"
              sizeref="wh"
              w="0"
              h="0"
              on_tooltip="get_tt_bulk"
              on_tooltip_params="dbbranch=#inv_branch|dbmax=#inv_bulk_max" />
        <link expr="identity(getItemsBulk('#inv_branch',0,#inv_branch_nb),@#inv_branch)"
              target="encombrement:value" />
      </group>
      <view type="text"
            id="slots_nb"
            posparent="bulk_weight"
            posref="BL BR"
            color="255 255 255 255"
            global_color="false"
            shadow="true"
            fontsize="10" />
      <ctrl type="tooltip"
            id="slots_tt"
            posparent="slots_nb"
            sizeref="wh"
            tooltip="uittInvSlots" />
      <link expr="identity(getInvSlotCounts('#inv_branch'),@#inv_branch)"
            target="slots_nb:hardtext" />
      <!-- uses identity(x,@branch) to add an observer on branch -->
    </group>
  </template>
  <!-- onClickR on a filter -->
  <proc id="pinv_item_filter">
    <!-- Reset all filter first -->
    <action handler="set"
            params="dblink=UI:SAVE:@0:FILTER_TP|value=0" />
    <action handler="set"
            params="dblink=UI:SAVE:@0:FILTER_MISSMP|value=0" />
    <action handler="set"
            params="dblink=UI:SAVE:@0:FILTER_MP|value=0" />
    <action handler="set"
            params="dblink=UI:SAVE:@0:FILTER_TOOL|value=0" />
    <action handler="set"
            params="dblink=UI:SAVE:@0:FILTER_WEAPON|value=0" />
    <action handler="set"
            params="dblink=UI:SAVE:@0:FILTER_ARMOR|value=0" />
    <!-- Set the one selected -->
    <action handler="set"
            params="dblink=@1|value=1" />
  </proc>
  <!-- template for the list of items FILTERS -->
  <template name="tinv_item_list_filter"
            id=""
            x="0"
            y="0"
            posref="BL BL"
            dblink=""
            texture=""
            tooltip=""
            inv_type="">
    <ctrl type="button"
          id="but_#id"
          button_type="toggle_button"
          posref="#posref"
          x="#x"
          y="#y"
          tx_normal="w_button_filter_off.tga"
          tx_pushed="w_button_filter_on.tga"
          tx_over=""
          onclick_l="set"
          params_l="dblink=#dblink|value=not(@#dblink)"
          onclick_r="proc"
          params_r="pinv_item_filter|#inv_type|#dblink"
          global_color_pushed="true"
          tooltip="#tooltip" />
    <view type="bitmap"
          id="bit_#id"
          posref="TL TL"
          posparent="but_#id"
          texture="#texture"
          global_color="false" />
    <link expr="@#dblink"
          target="but_#id:pushed" />
  </template>
  <!-- template for the mode 'icon' or 'text' (no right click) -->
  <template name="tinv_item_list_icon_swap"
            id=""
            x="0"
            y="0"
            posref="BL BL"
            dblink=""
            texture=""
            tooltip=""
            inv_type="">
    <ctrl type="button"
          id="but_#id"
          button_type="toggle_button"
          posref="#posref"
          x="#x"
          y="#y"
          tx_normal="w_button_filter_off.tga"
          tx_pushed="w_button_filter_on.tga"
          tx_over=""
          onclick_l="set"
          params_l="dblink=#dblink|value=not(@#dblink)"
          global_color_pushed="true"
          tooltip="#tooltip" />
    <view type="bitmap"
          id="bit_#id"
          posref="TL TL"
          posparent="but_#id"
          texture="#texture"
          global_color="false" />
    <link expr="@#dblink"
          target="but_#id:pushed" />
  </template>
  <!-- template for the list of items -->
  <template name="tinv_item_list"
            id=""
            animal_status=""
            inv_branch_nb="256"
            inv_branch=""
            inv_type=""
            posparent="parent"
            posref="TL TL"
            x="0"
            y="0"
            sizeparent="parent"
            sizeref="wh"
            w="0"
            h="0">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           x="#x"
           y="#y"
           sizeparent="#sizeparent"
           sizeref="#sizeref"
           w="#w"
           h="#h">
      <!-- Bag Type -->
      <!-- Bags : icon list -->
      <group type="list_icon_bag"
             id="bag_icons"
             array="false"
             sizeref="wh"
             w="0"
             h="-24"
             posref="TL TL"
             x="0"
             y="0"
             child_resize_h="false"
             value="#inv_branch"
             maxitem="#inv_branch_nb"
             inv_type="#inv_type"
             sort_type="UI:SAVE:#inv_type:SORT_TYPE"
             filter_armor="UI:SAVE:#inv_type:FILTER_ARMOR"
             filter_weapon="UI:SAVE:#inv_type:FILTER_WEAPON"
             filter_tool="UI:SAVE:#inv_type:FILTER_TOOL"
             filter_mp="UI:SAVE:#inv_type:FILTER_MP"
             filter_missmp="UI:SAVE:#inv_type:FILTER_MISSMP"
             filter_tp="UI:SAVE:#inv_type:FILTER_TP"
             wspace="2"
             hspace="2"
             startitem="0"
             selection_group="inventory_selection"
             auto_grayed="true"
             dragable="true"
             oncandrag="inv_can_drag"
             ondrag="inv_drag"
             params_drag="from_icon_list"
             oncandrop="inv_can_drop"
             ondrop="inv_drop"
             menu_r="ui:interface:item_menu_in_bag"
             instant_help="false"
             lmargin="10"
             rmargin="0"
             tmargin="1"
             bmargin="0"
             column_center="false"
             db_animal_status="#animal_status">
        <ctrl style="skin_scroll"
              id="scroll_row"
              posref="TL TL"
              target_stepy="44" />
      </group>
      <view type="bitmap"
            id="sep1"
            x="0"
            y="0"
            posparent="bag_icons"
            posref="BL TL"
            scale="true"
            h="2"
            sizeref="w"
            texture="W_line_hor.tga" />
      <link expr="eq(@UI:SAVE:#inv_type:ICON_LIST, 1)"
            target="bag_icons:active,sep1:active" />
      <!-- Bags : detailed list -->
      <group type="list_sheet_bag"
             id="bag_list"
             array="false"
             sizeref="wh"
             w="0"
             h="-34"
             posref="TL TL"
             x="0"
             y="-10"
             child_resize_h="false"
             value="#inv_branch"
             maxitem="#inv_branch_nb"
             inv_type="#inv_type"
             sort_type="UI:SAVE:#inv_type:SORT_TYPE"
             filter_armor="UI:SAVE:#inv_type:FILTER_ARMOR"
             filter_weapon="UI:SAVE:#inv_type:FILTER_WEAPON"
             filter_tool="UI:SAVE:#inv_type:FILTER_TOOL"
             filter_mp="UI:SAVE:#inv_type:FILTER_MP"
             filter_missmp="UI:SAVE:#inv_type:FILTER_MISSMP"
             filter_tp="UI:SAVE:#inv_type:FILTER_TP"
             hspace="2"
             xitem="2"
             yitem="-2"
             xtext="46"
             ytext="-2"
             selection_group="inventory_selection"
             selection="false"
             auto_grayed="true"
             dragable="true"
             oncandrag="inv_can_drag"
             ondrag="inv_drag"
             params_drag="from_text_list"
             oncandrop="inv_can_drop"
             ondrop="inv_drop"
             menu_r="ui:interface:item_menu_in_bag"
             instant_help="false"
             over_color="%bot_chat_sheet_selection_normal"
             over_col_pushed="%bot_chat_sheet_selection_pushed"
             over_col_over="%bot_chat_sheet_selection_over"
             color="255 255 255 255"
             fontsize="8"
             shadow="true"
             multi_line="true"
             multi_line_space="0"
             db_animal_status="#animal_status">
        <!-- the scroll -->
        <ctrl style="skin_scroll"
              id="scroll_row"
              posref="TL TL"
              target_stepy="44" />
        <!-- the group to scroll -->
        <group id="list"
               max_sizeref="h"
               max_sizeparent="parent"
               max_h="0"
               sizeref="w"
               posref="TL TL"
               x="8"
               y="0"
               w="-16" />
      </group>
      <view type="bitmap"
            id="sep2"
            x="0"
            y="0"
            posparent="bag_list"
            posref="BL TL"
            scale="true"
            h="2"
            sizeref="w"
            texture="W_line_hor.tga" />
      <link expr="eq(@UI:SAVE:#inv_type:ICON_LIST, 0)"
            target="bag_list:active,sep2:active" />
      <instance template="tinv_item_list_filter"
                id="filter_tp"
                x="-35"
                y="1"
                posref="BR BR"
                inv_type="#inv_type"
                dblink="UI:SAVE:#inv_type:FILTER_TP"
                texture="filter_tp.tga"
                tooltip="uittFilterTP" />
      <instance template="tinv_item_list_filter"
                id="filter_missmp"
                x="-60"
                y="1"
                posref="BR BR"
                inv_type="#inv_type"
                dblink="UI:SAVE:#inv_type:FILTER_MISSMP"
                texture="filter_mission.tga"
                tooltip="uittFilterMissMP" />
      <instance template="tinv_item_list_filter"
                id="filter_mp"
                x="-85"
                y="1"
                posref="BR BR"
                inv_type="#inv_type"
                dblink="UI:SAVE:#inv_type:FILTER_MP"
                texture="filter_mps.tga"
                tooltip="uittFilterMP" />
      <instance template="tinv_item_list_filter"
                id="filter_tool"
                x="-110"
                y="1"
                posref="BR BR"
                inv_type="#inv_type"
                dblink="UI:SAVE:#inv_type:FILTER_TOOL"
                texture="filter_tools.tga"
                tooltip="uittFilterTool" />
      <instance template="tinv_item_list_filter"
                id="filter_weapon"
                x="-135"
                y="1"
                posref="BR BR"
                inv_type="#inv_type"
                dblink="UI:SAVE:#inv_type:FILTER_WEAPON"
                texture="filter_weapon.tga"
                tooltip="uittFilterWeapon" />
      <instance template="tinv_item_list_filter"
                id="filter_armor"
                x="-160"
                y="1"
                posref="BR BR"
                inv_type="#inv_type"
                dblink="UI:SAVE:#inv_type:FILTER_ARMOR"
                texture="filter_armor.tga"
                tooltip="uittFilterArmor" />
      <!-- details -->
      <instance template="tinv_item_list_icon_swap"
                id="detail"
                x="-4"
                y="1"
                posref="BR BR"
                dblink="UI:SAVE:#inv_type:ICON_LIST"
                texture="details_on.tga"
                tooltip="uittDetail" />
      <link expr="ifthenelse(@UI:SAVE:#inv_type:ICON_LIST, 'details_off.tga', 'details_on.tga')"
            target="bit_detail:texture" />
    </group>
  </template>
  <!-- Link to trig brick action message. don't play when 0 (avoid flying text at startup) -->
  <link expr="@SERVER:FLAGS:CRITICAL"
        cond="not(eq(@SERVER:FLAGS:CRITICAL,0))"
        action="entity_flying_text"
        params="text=uiCriticalHit|entity=0|color=255 255 0 255" />
  <link expr="@SERVER:FLAGS:PARRY"
        cond="not(eq(@SERVER:FLAGS:PARRY,0))"
        action="entity_flying_text"
        params="text=uiParry|entity=0|color=255 255 0 255" />
  <link expr="@SERVER:FLAGS:DODGE"
        cond="not(eq(@SERVER:FLAGS:DODGE,0))"
        action="entity_flying_text"
        params="text=uiDodge|entity=0|color=255 255 0 255" />
  <!-- ****************************** -->
  <!-- *                  CHECK BOX                 * -->
  <!-- ****************************** -->
  <!-- A checkbox: toggle button with a text, linked to a database -->
  <template name="check_box"
            id=""
            posparent="parent"
            posref="TL TL"
            x="0"
            y="0"
            w="0"
            h="16"
            fontsize="10"
            hardtext=""
            dblink=""
            tooltip=""
            global_color="true">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           x="#x"
           y="#y"
           w="#w"
           h="#h"
           child_resize_w="true">
      <ctrl type="button"
            id="button"
            button_type="toggle_button"
            posref="ML ML"
            x="0"
            y="0"
            pushed="false"
            tx_normal="w_slot_on.tga"
            tx_pushed="w_opacity_on.tga"
            tx_over="w_slot_on.tga"
            color="255 255 255 255"
            col_pushed="255 255 255 255"
            col_over="255 255 255 0"
            onclick_l="set"
            params_l="dblink=#dblink|value=not(@#dblink)" />
      <link expr="@#dblink"
            target="button:pushed" />
      <view type="text"
            id="text"
            posparent="button"
            posref="MR ML"
            x="4"
            y="-3"
            color="255 255 255 255"
            fontsize="#fontsize"
            shadow="true"
            hardtext="#hardtext"
            global_color="#global_color" />
      <ctrl type="tooltip"
            id="tt"
            posref="TL TL"
            sizeref="wh"
            tooltip="#tooltip" />
    </group>
  </template>
  <!-- ***************************** -->
  <!-- *  HTML FORM SELECT WIDGET  * -->
  <!-- ***************************** -->
  <template name="html_form_select_widget"
            keep="true"
            id="select">
    <group type="combo_box"
           id="#id"
           w="100"
           x="0"
           y="0"
           child_resize_h="true"
           child_resize_hmargin="6"
           linked_to_db="false"
           posref="BL BL"
           on_change=""
           on_change_params="">
      <instance template="combo_box_def1" />
    </group>
  </template>
  <!-- ***************************** -->
  <!-- *  HTML TEXT BUTTON WIDGET  * -->
  <!-- ***************************** -->
  <template name="html_text_button"
            id=""
            text=""
            posparent="parent"
            posref="TL TL"
            onclick=""
            onclick_param=""
            x="0"
            y="0"
            keep="true"
            frozen="false">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           child_resize_w="true"
           child_resize_h="true"
           x="#x"
           y="#y">
      <ctrl style="text_button_16"
            id="b"
            onclick_l="#onclick"
            params_l="#onclick_param"
            hardtext="#text"
            frozen="#frozen" />
    </group>
  </template>
  <template name="frozen_html_text_button"
            id=""
            text=""
            posparent="parent"
            posref="TL TL"
            onclick=""
            onclick_param=""
            x="0"
            y="0"
            keep="true">
    <group id="#id"
           posparent="#posparent"
           posref="#posref"
           child_resize_w="true"
           child_resize_h="true"
           x="#x"
           y="#y">
      <ctrl style="text_button_16"
            id="b"
            onclick_l="#onclick"
            params_l="#onclick_param"
            hardtext="#text"
            frozen="true" />
    </group>
  </template>
  <!-- horizontal label/edit box template -->
  <template name="h_label_edit_box"
            keep="true"
            active="true"
            id=""
            h="20"
            x="0"
            y="0"
            posparent=""
            posref=""
            hardtext=""
            w="87"
            w_label=""
            w_box="50"
            fontsize="12"
            max_num_chars="6"
            entry_type="text"
            multi_line="false"
            onenter="lua"
            params=""
            onchange="lua"
            onchange_params=""
            on_focus_lost="lua"
            on_focus_lost_params="">
    <group id="#id"
           active="#active"
           x="#x"
           y="#y"
           w="#w"
           h="#h"
           posparent="#posparent"
           posref="#posref">
      <!-- label -->
      <group id="label"
             w="#w_label"
             h="20"
             x="0"
             y="0"
             posref="TL TL"
             posparent="parent">
        <view type="text"
              id="name_text"
              posref="BL BL"
              x="0"
              y="0"
              color="255 255 255 255"
              global_color="true"
              fontsize="#fontsize"
              shadow="true"
              hardtext="#hardtext" />
      </group>
      <!-- edit box -->
      <group type="edit_box"
             id="edit_box_group"
             w="#w_box"
             h="#h"
             x="5"
             y="0"
             posparent="label"
             posref="TR TL"
             onenter="#onenter"
             params="#params"
             onchange="#onchange"
             onchange_params="#onchange_params"
             on_focus_lost="#on_focus_lost"
             on_focus_lost_params="#on_focus_lost_params"
             max_num_chars="#max_num_chars"
             prompt=""
             enter_loose_focus="true"
             entry_type="#entry_type"
             reset_focus_on_hide="true"
             menu_r="">
        <instance template="box_widget"
                  id="back_edit_box"
                  posref="TL TL"
                  sizeref="w"
                  h="#h" />
        <view type="text"
              id="edit_text"
              x="4"
              y="-5"
              posref="TL TL"
              multi_line="#multi_line"
              fontsize="10"
              shadow="true"
              hardtext=""
              global_color="false" />
      </group>
    </group>
  </template>
  <!-- the common children definitions of a combo box -->
  <!-- keep is true because this template is used in the teditcmd template -->
  <template name="r2ed_combo_box"
            keep="true">
    <!-- DECORATION -->
    <instance template="box_widget"
              id="back"
              sizeref="wh"
              w="0"
              h="0" />
    <view type="bitmap"
          id="arrow"
          posref="MR MR"
          x="-4"
          texture="W_arrow_down_2.tga" />
    <!-- SYSTEM 
        <view type="text" id="text" posref="ML ML" x="2" />-->
    <group id="text_group"
           posparent="parent"
           posref="TL TL"
           sizeref="wh"
           x="0"
           w="-17"
           y="0"
           h="0">
      <view type="text"
            id="text"
            posref="ML ML"
            x="2"
            auto_clamp="true"
            over_extend_view_text="true"
            over_extend_parent_rect="true" />
    </group>
    <ctrl type="button"
          button_type="push_button"
          id="select"
          sizeref="wh"
          w="0"
          h="0"
          col_over="255 255 255 90"
          tx_over="blank.tga"
          scale="true" />
  </template>
  <!-- horizontal label/combo box template -->
  <template name="h_label_combo_box"
            keep="true"
            active="true"
            id=""
            x="0"
            y="0"
            w="195"
            w_label="95"
            w_combo="90"
            posparent=""
            posref=""
            hardtext=""
            on_change_params="">
    <group id="#id"
           active="#active"
           x="#x"
           y="#y"
           w="#w"
           h="20"
           posparent="#posparent"
           posref="#posref">
      <!-- label -->
      <group id="label"
             w="#w_label"
             h="20"
             x="0"
             y="0"
             posref="TL TL"
             posparent="parent">
        <view type="text"
              id="name_text"
              posref="BL BL"
              x="0"
              y="0"
              color="255 255 255 255"
              global_color="true"
              fontsize="12"
              shadow="true"
              hardtext="#hardtext" />
      </group>
      <!-- combo box -->
      <group type="combo_box"
             id="combo_box"
             w="#w_combo"
             h="20"
             x="0"
             y="0"
             posref="TR TL"
             posparent="label"
             linked_to_db="false"
             on_change="lua"
             on_change_params="#on_change_params">
        <instance template="r2ed_combo_box" />
      </group>
    </group>
  </template>
</interface_config>
