FILE(GLOB SRC *.cpp *.h *.def)

DECORATE_NEL_LIB("nel_drv_direct3d_win")
SET(NLDRV_D3D_LIB ${LIBNAME})
DECORATE_NEL_LIB("nel3d")
SET(NL3D_LIB ${LIBNAME})

ADD_LIBRARY(nel_drv_direct3d_win SHARED ${SRC})

INCLUDE_DIRECTORIES(${LIBXML2_INCLUDE_DIR} ${FREETYPE_INC} ${DXSDK_INCLUDE_DIR})

TARGET_LINK_LIBRARIES(nel_drv_direct3d_win nel3d ${LIBXML2_LIBRARIES} ${FREETYPE_LIB} ${DXSDK_D3DX9_LIBRARY} ${DXSDK_D3D9_LIBRARY} ${DXSDK_DINPUT_LIBRARY} ${DXSDK_GUID_LIBRARY})
SET_TARGET_PROPERTIES(nel_drv_direct3d_win PROPERTIES
  VERSION ${NL_VERSION}
  SOVERSION ${NL_VERSION_MAJOR}
  LINK_FLAGS "/NODEFAULTLIB:libcmt"
  COMPILE_FLAGS "/Yustddirect3d.h"
  DEBUG_POSTFIX "_d"
  RELEASE_POSTFIX "_r"
  PROJECT_LABEL "Driver, Video: Direct3D")
SET_SOURCE_FILES_PROPERTIES(stddirect3d.cpp PROPERTIES COMPILE_FLAGS "/Ycstddirect3d.h")
ADD_DEFINITIONS(/Ddriver_direct3d_EXPORTS)

ADD_DEFINITIONS(${LIBXML2_DEFINITIONS})

ADD_PRECOMPILED_HEADER(nel_drv_direct3d_win ${CMAKE_CURRENT_SOURCE_DIR}/stddirect3d.h)

INSTALL(TARGETS nel_drv_direct3d_win LIBRARY DESTINATION lib RUNTIME DESTINATION bin COMPONENT drivers3d)
IF(WITH_MAXPLUGIN)
  INSTALL(TARGETS nel_drv_direct3d_win RUNTIME DESTINATION maxplugin COMPONENT drivers3d)
ENDIF(WITH_MAXPLUGIN)
